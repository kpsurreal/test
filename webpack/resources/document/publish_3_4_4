-- 修改PB查询类型字段长度
ALTER TABLE `gmf_bms`.`pb_account_info` CHANGE `sec_qry_type` `sec_qry_type` VARCHAR( 10 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '0' COMMENT '券商查询 类型';

1 TB服务器 支持MySQL数据库操作，插件安装
    TB 机器运行 mysql-connector-net-6.9.9.msi

#表结构变更
ALTER TABLE `oms_v3`.`base_deal` ADD `deal_value_net` DECIMAL(16,3)  NOT NULL  COMMENT '全价成交金额'  AFTER `deal_value`;

CREATE TABLE `gmf_bms`.`tdx_account_info` (
`id`  int(11) NOT NULL AUTO_INCREMENT ,
`base_id`  int(11) NOT NULL ,
`sec_name`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`trade_host`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`trade_port`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`client_version`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`yyb_id`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`account_number`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`jy_account_number`  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`com_password`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`tx_password`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`sz_a_code`  varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`sh_a_code`  varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`need_tx_password`  tinyint(3) UNSIGNED NULL DEFAULT 1 ,
`config_state`  tinyint(3) UNSIGNED NULL DEFAULT 1 ,
`created_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
`updated_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
PRIMARY KEY (`id`),
INDEX `i_base_id` (`base_id`) USING BTREE 
)
ENGINE=InnoDB
DEFAULT CHARACTER SET=utf8 COLLATE=utf8_general_ci
AUTO_INCREMENT=1
ROW_FORMAT=COMPACT;

CREATE TABLE `gmf_bms`.`change_log` (
`id`  bigint(20) NOT NULL AUTO_INCREMENT ,
`user_id`  int(11) NULL DEFAULT NULL ,
`type`  tinyint(4) NULL DEFAULT NULL COMMENT '修改的值类别（1，tdx密码修改 ）' ,
`key_name`  varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '对应键值' ,
`value`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '对应修改后的值' ,
`desc`  varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '描述文本' ,
`created_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
`updated_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
PRIMARY KEY (`id`)
)
ENGINE=InnoDB
DEFAULT CHARACTER SET=utf8 COLLATE=utf8_general_ci
AUTO_INCREMENT=1
ROW_FORMAT=COMPACT;


CREATE TABLE `gmf_bms`.`pb_account_info` (
`id`  int(11) NOT NULL AUTO_INCREMENT ,
`base_id`  int(11) NOT NULL ,
`pb_type`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`server_name`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`send_q_name`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`reserved`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`receive_q_name`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`ssl`  varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`ssl_level`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`cert_user_name`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`cert_file`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`cert_pwd`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_pc`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_iip`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_ip`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_pi`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_mac`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_hd`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_pcn`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_cpu`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_ser_no`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_vol`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`vc_hostname`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`host`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`port`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`user_type`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`user_name`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`user_pwd`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`org_id`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`dept_id`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`fund_id`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`combi_id`  varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`trader_id`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`holder_code_sz`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`holder_code_sh`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`seat_id_sz`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`seat_id_sh`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,
`sec_qry_type`  varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '0' COMMENT '券商查询 类型' ,
`config_state`  tinyint(4) NOT NULL DEFAULT 1 ,
`created_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
`updated_at`  timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ,
PRIMARY KEY (`id`),
INDEX `i_base_id` (`base_id`) USING BTREE 
)
ENGINE=InnoDB
DEFAULT CHARACTER SET=utf8 COLLATE=utf8_general_ci
AUTO_INCREMENT=1
ROW_FORMAT=COMPACT;

#crontab定时任务
*/4 * * * * /usr/bin/php /data/www/gmf_oms/artisan portfolio:refresh >> /data/www/gmf_oms/storage/logs/portfolio_refresh.log 2>&1
30 23 * * * /usr/bin/php /data/www/gmf_oms/artisan portfolio:refresh --status=all >> /data/www/gmf_oms/storage/logs/portfolio_refresh.log 2>&1

#版本发布初始化操作
INSERT INTO `securities_status` (`securities_id`, `status_desc`, `oms_status`, `deal_flag`, `is_cancel`, `created_at`, `updated_at`)
VALUES
	('aijian', '废单', 0, 2, 0, now(), now()),
	('aijian', '已撤', 0, 1, 1, now(), now()),
	('aijian', '成交', 0, 1, 0, now(), now()),
	('aijian', '已成', 0, 1, 0, now(), now()),
	('aijian', '部撤', 0, 1, 1, now(), now()),
	('bohai', '撤单废单', 0, 2, 1, now(), now()),
	('bohai', '撤单成交', 0, 1, 1, now(), now()),
	('bohai', '普通成交', 0, 1, 0, now(), now()),
	('bohai', '内部撤单', 0, 1, 1, now(), now()),
	('bohai', '废单', 0, 2, 0, now(), now()),
	('caitong', '部撤', 0, 1, 1, now(), now()),
	('caitong', '废单', 0, 2, 0, now(), now()),
	('caitong', '已撤', 0, 1, 1, now(), now()),
	('caitong', '成交', 0, 1, 0, now(), now()),
	('caitong', '已成', 0, 1, 0, now(), now()),
	('changjiang', '废单', 0, 2, 0, now(), now()),
	('changjiang', '已成', 0, 1, 0, now(), now()),
	('changjiang', '已撤', 0, 1, 1, now(), now()),
	('changjiang', '部撤', 0, 1, 1, now(), now()),
	('changjiang', '成交', 0, 1, 0, now(), now()),
	('debang', '已成', 0, 1, 0, now(), now()),
	('debang', '成交', 0, 1, 0, now(), now()),
	('debang', '已撤', 0, 1, 1, now(), now()),
	('debang', '废单', 0, 2, 0, now(), now()),
	('debang', '部撤', 0, 1, 1, now(), now()),
	('diyi', '撤单成交', 0, 1, 1, now(), now()),
	('diyi', '普通成交', 0, 1, 0, now(), now()),
	('diyi', '内部撤单', 0, 1, 1, now(), now()),
	('diyi', '撤单废单', 0, 2, 1, now(), now()),
	('diyi', '废单', 0, 2, 0, now(), now()),
	('dongbei', '部撤', 0, 1, 1, now(), now()),
	('dongbei', '成交', 0, 1, 0, now(), now()),
	('dongbei', '废单', 0, 2, 0, now(), now()),
	('dongbei', '已撤', 0, 1, 1, now(), now()),
	('dongbei', '已成', 0, 1, 0, now(), now()),
	('dongguan', '成交', 0, 1, 0, now(), now()),
	('dongguan', '废单', 0, 2, 0, now(), now()),
	('dongguan', '已撤', 0, 1, 1, now(), now()),
	('dongguan', '已成', 0, 1, 0, now(), now()),
	('dongguan', '部撤', 0, 1, 1, now(), now()),
	('donghai', '3-非法委托', 0, 2, 0, now(), now()),
	('donghai', '7-部成部撤', 0, 1, 1, now(), now()),
	('donghai', '6-全部成交', 0, 1, 0, now(), now()),
	('donghai', '8-全部撤单', 0, 1, 1, now(), now()),
	('dongwu', '3-非法委托', 0, 2, 0, now(), now()),
	('dongwu', '7-部成部撤', 0, 1, 1, now(), now()),
	('dongwu', '8-全部撤单', 0, 1, 1, now(), now()),
	('dongwu', '6-全部成交', 0, 1, 0, now(), now()),
    ('donghai', '3-非法委托', 0, 2, 0, now(), now()),
    ('donghai', '7-部成部撤', 0, 1, 1, now(), now()),
    ('donghai', '8-全部撤单', 0, 1, 1, now(), now()),
    ('donghai', '6-全部成交', 0, 1, 0, now(), now()),
	('fangzheng', '部撤', 0, 1, 1, now(), now()),
	('fangzheng', '已成', 0, 1, 0, now(), now()),
	('fangzheng', '成交', 0, 1, 0, now(), now()),
	('fangzheng', '废单', 0, 2, 0, now(), now()),
	('fangzheng', '已撤', 0, 1, 1, now(), now()),
	('guangfa', '成交', 0, 1, 0, now(), now()),
	('guangfa', '废单', 0, 2, 0, now(), now()),
	('guangfa', '已撤', 0, 1, 1, now(), now()),
	('guangfa', '部撤', 0, 1, 1, now(), now()),
	('guangfa', '已成', 0, 1, 0, now(), now()),
	('guangzhou', '撤单废单', 0, 2, 1, now(), now()),
	('guangzhou', '废单', 0, 2, 0, now(), now()),
	('guangzhou', '普通成交', 0, 1, 0, now(), now()),
	('guangzhou', '撤单成交', 0, 1, 1, now(), now()),
	('guangzhou', '内部撤单', 0, 1, 1, now(), now()),
	('guohai', '已成', 0, 1, 0, now(), now()),
	('guohai', '部撤', 0, 1, 1, now(), now()),
	('guohai', '废单', 0, 2, 0, now(), now()),
	('guohai', '已撤', 0, 1, 1, now(), now()),
	('guohai', '成交', 0, 1, 0, now(), now()),
	('guojin', '已成', 0, 1, 0, now(), now()),
	('guojin', '废单', 0, 2, 0, now(), now()),
	('guojin', '成交', 0, 1, 0, now(), now()),
	('guojin', '已撤', 0, 1, 1, now(), now()),
	('guojin', '部撤', 0, 1, 1, now(), now()),
	('guolian', '已撤', 0, 1, 1, now(), now()),
	('guolian', '成交', 0, 1, 0, now(), now()),
	('guolian', '已成', 0, 1, 0, now(), now()),
	('guolian', '部撤', 0, 1, 1, now(), now()),
	('guolian', '废单', 0, 2, 0, now(), now()),
	('guotai', '成交', 0, 1, 0, now(), now()),
	('guotai', '已撤', 0, 1, 1, now(), now()),
	('guotai', '部撤', 0, 1, 1, now(), now()),
	('guotai', '废单', 0, 2, 0, now(), now()),
	('guotai', '已成', 0, 1, 0, now(), now()),
	('haitong', '部分撤单', 0, 1, 1, now(), now()),
	('haitong', '场内废单', 0, 2, 0, now(), now()),
	('haitong', '场外撤单', 0, 1, 1, now(), now()),
	('haitong', '场内撤单', 0, 1, 1, now(), now()),
	('haitong', '已成交', 0, 1, 0, now(), now()),
	('huaan', '部撤', 0, 1, 1, now(), now()),
	('huaan', '已撤', 0, 1, 1, now(), now()),
	('huaan', '已成', 0, 1, 0, now(), now()),
	('huaan', '成交', 0, 1, 0, now(), now()),
	('huaan', '废单', 0, 2, 0, now(), now()),
	('huatai', '废单', 0, 2, 0, now(), now()),
	('huatai', '部撤', 0, 1, 1, now(), now()),
	('huatai', '已撤', 0, 1, 1, now(), now()),
	('huatai', '已成', 0, 1, 0, now(), now()),
	('huatai', '成交', 0, 1, 0, now(), now()),
	('tianfeng', '废单', 0, 2, 0, now(), now()),
	('tianfeng', '成交', 0, 1, 0, now(), now()),
	('tianfeng', '已成', 0, 1, 0, now(), now()),
	('tianfeng', '已撤', 0, 1, 1, now(), now()),
	('tianfeng', '部撤', 0, 1, 1, now(), now()),
	('xinye', '已成', 0, 1, 0, now(), now()),
	('xinye', '成交', 0, 1, 0, now(), now()),
	('xinye', '废单', 0, 2, 0, now(), now()),
	('xinye', '部撤', 0, 1, 1, now(), now()),
	('xinye', '已撤', 0, 1, 1, now(), now()),
	('yinhe', '部撤', 0, 1, 1, now(), now()),
	('yinhe', '成交', 0, 1, 0, now(), now()),
	('yinhe', '废单', 0, 2, 0, now(), now()),
	('yinhe', '已成', 0, 1, 0, now(), now()),
	('yinhe', '已撤', 0, 1, 1, now(), now()),
	('zhongjian', '内部撤单', 0, 1, 1, now(), now()),
	('zhongjian', '普通成交', 0, 1, 0, now(), now()),
	('zhongjian', '撤单成交', 0, 1, 1, now(), now()),
	('zhongjian', '撤单废单', 0, 2, 1, now(), now()),
	('zhongjian', '废单', 0, 2, 0, now(), now()),
	('zhongxin', '成交', 0, 1, 0, now(), now()),
	('zhongxin', '废单', 0, 2, 0, now(), now()),
	('zhongxin', '部撤', 0, 1, 1, now(), now()),
	('zhongxin', '已成', 0, 1, 0, now(), now()),
	('zhongxin', '已撤', 0, 1, 1, now(), now());


