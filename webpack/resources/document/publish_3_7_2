#开发源代码分支
 /develop


3.7.1 创建机构临时版本 的 SQL
# 记得需要确认是否有执行 publish_3_7_0 中 CREATE TABLE `oms_v3`.`futures_ctp_users`
# 记得需要确认 product_base 新增 channel字段

#表结构变更
ALTER TABLE `oms_v3`.`otc_private_placement` ADD `share` DECIMAL(18,5)  NOT NULL  COMMENT '份额'  AFTER `volume`;

ALTER TABLE `oms_v3`.`otc_monetary_fund` ADD `volume` DECIMAL(18,5)  NOT NULL  AFTER `market_value`;
ALTER TABLE `oms_v3`.`otc_cash_swap` ADD `read_url` VARCHAR(300)  NOT NULL  DEFAULT ''  AFTER `total_assets`;
ALTER TABLE `oms_v3`.`otc_cash_swap` ADD `err_info` VARCHAR(2000)  NOT NULL  DEFAULT ''  AFTER `read_url`;
ALTER TABLE `oms_v3`.`otc_cash_swap` ADD `state` TINYINT(4)  NOT NULL  DEFAULT 1  AFTER `err_info`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `org_id` INT(11)  NOT NULL  COMMENT '机构ID'  AFTER `id`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `amac_price` DECIMAL(13,5)  NOT NULL  COMMENT '最新AMAC价格'  AFTER `amac_last_price`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `hold_volume` INT(11)  NOT NULL  COMMENT '持仓数量'  AFTER `amac_price`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `weight` DECIMAL(8,6)  NOT NULL  COMMENT '权重'  AFTER `hold_volume`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `modify_market_value` DECIMAL(16,3)  NOT NULL  COMMENT '市值'  AFTER `weight`;
ALTER TABLE `oms_v3`.`suspension_valuation` ADD `state` TINYINT(4)  NOT NULL  COMMENT '有效否'  AFTER `modify_market_value`;
ALTER TABLE `gmf_bms`.`product_group` ADD `status` TINYINT(4)  NOT NULL  DEFAULT 5  AFTER `volume`;
-- 新增产品组属性 buty
CREATE TABLE `oms_v3`.`product_attributes` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `group_id` int(11) NOT NULL COMMENT '产品组ID',
 `type` enum('base','group') COLLATE utf8_unicode_ci NOT NULL COMMENT '产品类型',
 `adjust_assets` decimal(16,3) NOT NULL COMMENT '调整净资产',
 `adjust_volume` decimal(16,3) NOT NULL COMMENT '调整份额',
 `remarks` varchar(300) COLLATE utf8_unicode_ci NOT NULL COMMENT '产品备注',
 `created_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
 `updated_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
 PRIMARY KEY (`id`),
 KEY `group_id` (`group_id`,`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;


#独立配置文件更新


#crontab定时任务
#定时更新停牌估值信息
15 8-21 * * * /usr/bin/php /data/www/gmf_oms/artisan product:store_suspension >> /data/www/gmf_oms/storage/logs/store_suspension.log 2>&1

#定时更新停牌估值信息
30 16-20 * * * /usr/bin/php /data/www/gmf_oms/artisan product:swap_read >> /data/www/gmf_oms/storage/logs/swap_read.log 2>&1


#版本发布初始化操作
OMS根目录执行
php artisan  user:set_permission
对平台用户初始化权限 先执行SQL获取所有平台用户
SELECT user_id FROM `gmf_bms`.`users_info` WHERE `user_type`=3;
php artisan  user:set_permission --user_id=USER_ID(SQL获取的用户ID)

