{"version":3,"sources":["oms/risk/risk_institutional_edition.js"],"names":["permissionArr","supportPage","product_ids","window","LOGIN_INFO","permission","push","role_permission","length","$","omsAlert","totals","allStockIdArr","jc","riskVue","common_stockPool","common_stockPool_v2","getStockPool","resolve","reject","ajax","url","success","code","msg","data","pop","forEach","e","Object","prototype","toString","call","error","promiseGetStockPool","Promise","Vue","component","template","props","methods","toMe","$emit","index","on","event","product_list","theme","org_info","then","el","isShowSet","selected_rules","union_selected_rules","current","navlist","select_all","totalsUnion","displayTotals","product_change_list","totalsCopy","JSON","parse","stringify","checkallstatus","setdozenarr","setsingle","independentSelected","independentSelectedData","independentSelectedDataNum","isRotate","inSelectedRisk","displayUnionRisk","productSelected","warnSelected","products","warntypes","value","label","multiple_select","isSlideDown","stockPool","beforeMount","that","keys","watch","newArr","oldArr","k","ruleDetailsArr","displayRuleDetails","risks","product_name","product_id","concat","prepareDisplay","doSaveTpl","startLoading","type","clearLoading","getInSelectedRisk","rtn","filter","risk_type","multiDeleteRule","trStr","ruleIdArr","change_select","rule_id","GetNameByRiskType","GetPreVal","pre_val","GetLimitVal","limit_val","GetLimitAction","limit_action","_this","html","confirm","title","content","closeIcon","confirmButton","cancelButton","id","join","getList","getListCo","multi_delete","arr","selectProduct","set","checkPermission","some","inObj","i","ruleDetailArr","pre_val_arr","limit_val_arr","limit_action_arr","displayRules","obj","name","pre","pool_name","operator","unit","str","options","option","limit","limit_actionInfo","action","tmpObj","assign","someFlag","tmpFlag","ele","element","status","arr1","flag","icon_status","sort","a","b","changeNav","v","checkall","setdozenfn","ischeck","splice","setdozengo","setsinglefn","refresh","productPreviewSilde","productPreviewEnsure","productPreviewCancel","changeindependentSelectedData","indexOf","display","num","required","placeHolder","addition","text","hideAction","inputReg","reg","mounted","vm","selectize","$el","delimiter","persist","placeholder","valueField","labelField","addPrecedence","sortField","render","escape","field_label","settings","isFinite","onChange","setValue","newOptions","Infinity","addOption","clearOptions","destroyed","off","destroy","mixins","numberMixin","colorMixin","show_risk_type_details","show_risk_descs_details","checkboxall","n","o","row","computed","product_type","risknum","values","risktypes","tranformtypes","risktypes_html","riskDetails","riskDetailsV2","riskDesc","desc","getLimitAction","showtypedetails","showdescsdetails","getActiveRulesArr","riskInfo","target","wholePosition","onePosition","placards","controTrade","onePositionCo","placardsCo","controTradeCo","entrustRevoke","unique","seen","Map","has","riskArr","checktocheck","decrease","reportMixin","dragOptions","animation","ghostClass","chgSort","order_by","order","field_sort","display_rules","map","typeStr","common_storage","setItem","onMove","relatedContext","draggedContext","relatedElement","draggedElement","fixed","onEnd","displayValue","sub_value","rule","format","Array","Function","args","slice","apply","checkPositive","parseFloat","checkNegative","riskDetailData","class","showOrder","selectAll","display_data","source_data","curEditRule","display_check_all","in_selected_risk","web_checked","risk_type_str","displayRiskType","VUECOMPONENT","rulesNeedShow","checkKeyDown","keyCode","test","key","preventDefault","chgSelectAll","$nextTick","chgSelectedRules","every","val","editRule","deleteRule","thisRule","resetEditRule","cancelEdit","saveEdit","tmpEditRule","undefined","isNaN","Number","isNormal","selected","showDescription","created","checkSubmitDisabled","addRule_preVal","addRule_limitVal","curDisplayRule","showRuleType","showProductName","getOptions","getStockOptions","getDisplayRulesData","showStockPool","boxWidth","columnClass","setTypeJunior","setTypeSenior","getStockPoolByCode","parseInt","getRulesDisplayByValue","pre_rule","doCustom","checkSelected","chgCurDisplayRuleByNum","addRule_actionValue","setSelected","localStorage","getItem","user_id","chgCurRulesByNum","$forceUpdate","getDisplayRulesNum","changeDescription","tmpArr","rules","curRules","rule_add","independent_selected","GetPoolNameById","GetPreValType","GetLimitValType","validPreVal","document","attr","searchStock","hide","stock_id","match","stock_name","show","slideUp","selectOneStock","customInput","append","parents","find","remove","empty","addClass","stock_id_arr","each","removeClass","close","failNotice","inputStockCode","last_suggest_timestamp","Date","valueOf","REQUEST_PREFIX","getJSON","done","res","slideDown","always"],"mappings":"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","file":"risk_institutional_edition.js","sourcesContent":["/**\n * 风控监控页面 - 机构版\n * Author: liuzeyafzy@gmail.com\n */\n//\nconst permissionArr = {\n  'PERMISSION_RISK_HANDLE': 24, //风控监控\n  'PERMISSION_PRODUCT_RISK': 26 //风控设置\n};\nlet supportPage = [];\nlet product_ids = [];\nif (window.LOGIN_INFO.permission[permissionArr['PERMISSION_RISK_HANDLE']]) {\n  supportPage.push(0);\n  product_ids = window.LOGIN_INFO.role_permission[permissionArr['PERMISSION_RISK_HANDLE']]\n}\nif (window.LOGIN_INFO.permission[permissionArr['PERMISSION_PRODUCT_RISK']]) {\n  supportPage.push(1);\n  supportPage.push(2);\n  product_ids = window.LOGIN_INFO.role_permission[permissionArr['PERMISSION_PRODUCT_RISK']]\n}\n\nif (0 == supportPage.length) {\n  $.omsAlert('权限异常');\n}\n\nvar totals = {};\nvar allStockIdArr = [];\nlet jc;\nvar riskVue\n\nvar common_stockPool = [];\nvar common_stockPool_v2 = common_stockPool;\nvar getStockPool = function(resolve, reject){\n  $.ajax({\n    url: '/rms-pub/stock_pool/get_list',\n    success: function({code, msg, data}){\n      while(common_stockPool.length > 0)\n      {\n        common_stockPool.pop();\n      }\n      data.forEach(e => {\n        common_stockPool.push(e);\n      })\n      if (Object.prototype.toString.call(resolve) == \"[object Function]\") {\n        resolve();\n      }\n    },\n    error: function(){\n      if (Object.prototype.toString.call(reject) == \"[object Function]\") {\n        reject();\n      }\n    }\n  });\n};\nvar promiseGetStockPool = new Promise(function(resolve, reject){\n  // 获取股票池\n  getStockPool(resolve, reject)\n})\n\n// 导航组件\nVue.component('risk-nav-li',{\n  template:`<li v-bind:class=\"{active:index==current}\" @click=\"toMe\"><slot></slot></li>`,\n  props:['index','current'],\n  data(){\n    return {\n    }\n  },\n  methods:{\n    toMe(){\n      this.$emit('change',this.index)\n    }\n  }\n});\n\n$(window).on('multi_load', function(event){\n  var product_list = event.product_list;\n  // var product_ids = event.product_ids;\n  let theme = window.LOGIN_INFO.org_info.theme;\n  promiseGetStockPool.then(function(){\n    riskVue = new Vue({\n      el:\"#risk\",\n      data:{\n        isShowSet: window.LOGIN_INFO.permission[permissionArr['PERMISSION_PRODUCT_RISK']] ? true : false,\n        theme:theme,\n        selected_rules: [], //选中的独立风控规则\n        union_selected_rules: [], //选中的联合风控规则\n        supportPage: supportPage,\n        current: supportPage[0]|0, // 当前导航索引，0，1，2，对应navlist数组索引\n        navlist:['风控监控','独立风控设置','联合风控设置'],\n        select_all:false,\n        totals: {},// 账户全部风控监控信息在totals之中,其他基于此数据的信息，在computed之中，\n        totalsUnion: {},\n        displayTotals: {},\n        product_change_list: [],\n        totalsCopy:JSON.parse(JSON.stringify(totals)),\n        checkallstatus:false,\n        setdozenarr:[],// 批量设置的product_id\n        setsingle:[],// 单个设置时候的product_id\n        independentSelected:[],// 依据批量设置或者单个设置来控制,内容为product_id;\n        independentSelectedData:{},//监视independentSelected生产的原始数据\n        independentSelectedDataNum:0,// 默认用户不选择交易单元进行设置\n        isRotate:false,// 刷新时候默认动画class不存在,刷新按钮选择依赖\n        inSelectedRisk:[],// [{},{},...,{}],处理得到的每个交易单元的详细风险数据\n        displayUnionRisk: [], //联合风控\n\n        // 交易单元选中列表\n        productSelected:[],//搜索框搜索结果列表\n        // 告警类型选中列表\n        warnSelected:[],\n\n        // 过滤，交易单元列表多选框的options\n        products:[],\n        // 过滤，告警类型列表多选框的options\n        warntypes:[{\n          value:1, // risk_type\n          label:'禁买股票池风控'\n        },{\n          value:2,\n          label:'净值仓位风控'\n        },{\n          value:3,\n          label:'个股仓位风控'\n        },{\n          value:4,\n          label:'举牌风控'\n        },{\n          value:5,\n          label:'对敲风控'\n        }],\n\n        multiple_select:[],\n\n        isSlideDown:false,// 继续选择与否\n        stockPool: common_stockPool,\n\n        // // 修改的规则\n        // curEditRule\n      },\n      beforeMount(){\n        let that = this;\n        that.products = [];\n        Object.keys(this.totals).forEach(function(e,index){\n          that.products.push({\n            value:e,\n            label:that.totals[e]['product_name']\n          })\n        })\n      },\n      watch:{\n        independentSelected: function(newArr, oldArr){\n          // 重置已经选择的交易单元是否选择，然后再根据目前的arr来添加\n          Object.keys(this.totals).forEach(e => {\n            this.totals[e]['checked'] = false;\n          })\n          newArr.forEach(k=>{\n            if (this.totals[k]) {\n              this.totals[k]['checked'] = true;\n            }\n          })\n\n          this.inSelectedRisk = [];\n          newArr.forEach(e => {\n            let ruleDetailsArr = this.displayRuleDetails(this.totals[e].risks, {\n              product_name: this.totals[e].product_name,\n              product_id: this.totals[e].product_id\n            });\n            this.inSelectedRisk = this.inSelectedRisk.concat(ruleDetailsArr);\n          })\n        },\n        productSelected: function(){\n          this.prepareDisplay();\n        },\n        warnSelected: function(){\n          this.prepareDisplay();\n        }\n      },\n      methods:{\n        doSaveTpl: function(){\n          // console.log(Vue.independentSelected);\n          let product_id = Vue.independentSelected;\n          $.startLoading('正在保存...');\n          $.ajax({\n            url: '/rms-pub/rule/save_tpl',\n            type: 'post',\n            data: {\n              product_id: product_id\n            },\n            success: function({code, msg, data}){\n              $.clearLoading();\n              if (0 == code) {\n                $.omsAlert('保存成功');\n              }else{\n                $.omsAlert(msg);\n              }\n            },\n            error: function(){\n              $.clearLoading();\n            }\n          });\n        },\n        getInSelectedRisk: function(){\n          var rtn = this.inSelectedRisk.filter(e => {\n            return 1 == e.risk_type || 2 == e.risk_type || 3 == e.risk_type || 4 == e.risk_type || 5 == e.risk_type;\n          });\n          return rtn;\n        },\n        multiDeleteRule(){\n          //不论是独立风控还是联合风控只要没有选择风控规则就给出提示\n          if ((1 == this.current && 0 == this.selected_rules.length) || (2 == this.current && 0 == this.union_selected_rules.length)) {\n            $.omsAlert('请选择风控规则');\n            return false;\n          }\n\n          let trStr = '';\n          var ruleIdArr = [];\n          var change_select = [];\n          if (1 == this.current) { //独立风控规则\n            change_select = this.selected_rules;\n          } else if (2 == this.current) { //联合风控规则\n            change_select = this.union_selected_rules;\n          }\n          change_select.forEach(e => {\n            ruleIdArr.push(e.rule_id);\n            trStr += `\n              <tr>\n                <td style=\"padding-left: 50px; width: 110px;\"><span class=\"content__product__name\">`+ e.product_name +`</span></td>\n                <td style=\"padding-left: 20px; width: 110px;\">`+ GetNameByRiskType(e.risk_type) +`</td>\n                <td>`+ GetPreVal(e.risk_type, e.pre_val) + GetLimitVal(e.risk_type, e.limit_val) + GetLimitAction(e.risk_type, e.limit_action) +`</td>\n              </tr>`;\n          })\n\n          var that = this;\n          var _this = this;\n          // GetNameByRiskType(type)\n          let html = `\n            <table>\n              <thead>\n                <tr>\n                  <td style=\"padding-left: 50px; width: 110px;\">交易单元</td>\n                  <td style=\"padding-left: 20px; width: 110px;\">风控类别</td>\n                  <td>风控规则</td>\n                </tr>\n              </thead>\n              <tbody>`+ trStr +`</tbody>\n            </table>\n          `;\n\n          $.confirm({\n            title: '删除确认',\n            content: html,\n            closeIcon: true,\n            confirmButton: '确认',\n            cancelButton: false,\n            confirm: function(){\n              $.startLoading('正在删除...');\n              $.ajax({\n                url: '/rms-pub/rule/delete',\n                type: 'post',\n                data: {\n                  id: ruleIdArr.join(',')\n                },\n                success: function({code, msg, data}){\n                  $.clearLoading();\n                  _this.selected_rules = [];\n                  _this.union_selected_rules = [];\n                  riskVue.getList();\n                  riskVue.getListCo();\n                  $.omsAlert('删除成功');\n                },\n                error: function(){\n                  $.clearLoading();\n                }\n              })\n            }\n          });\n        },\n        multi_delete: function(){\n          let arr = this.multi_delete;\n          if (0 == arr.length) {\n            $.omsAlert('请选择风控');\n            return;\n          }\n        },\n        selectProduct: function(id){\n          Vue.set(this.independentSelected, 0, id)\n          // this.independentSelected[0] = id;\n        },\n        checkPermission: function(id){\n          if (this.supportPage.some(e => {\n            return e == id;\n          })) {\n            return true;\n          }else{\n            return false;\n          }\n        },\n        displayRuleDetails(risks, inObj){\n          let _this = this;\n          let arr = [];\n          Object.keys(risks).forEach(function(e, i){\n            risks[e].forEach(function(el){\n              // if (1 == el.status) {\n                arr.push(el);\n              // }\n            })\n          });\n\n          let ruleDetailArr = [];\n\n          arr.forEach(function(e){\n            let pre_val_arr = [];\n            let limit_val_arr = [];\n            let limit_action_arr = [];\n\n            displayRules.forEach(function(el){\n              // 找到匹配的风控出来\n              // 接口处的是risk_type，而前端页面自定义的是type\n              if (e.risk_type == el.type) {\n                // 准备pre_val，limit_val、limit_action\n                el.pre_val.forEach(pre => {\n                  let obj = {};\n                  obj.name = pre.name;\n                  if ('select' == pre.type) {\n                    common_stockPool.forEach(stockPool => {\n                      if (e.pre_val[0] == stockPool.id) {\n                        obj.value = stockPool.pool_name;\n                      }\n                    })\n                  }else if('input' == pre.type){\n                    obj.value = pre.operator + e.pre_val[0] + pre.unit;\n                  }else if('select2' == pre.type){\n                    let str = '';\n                    pre.options.forEach(option => {\n                      if (e.pre_val[0] == option.value) {\n                        str = option.label;\n                      }\n                    });\n                    obj.value = str;\n                  }\n\n                  pre_val_arr.push(obj);\n                });\n\n                el.limit_val.forEach(limit => {\n                  let obj = {};\n                  obj.name = limit.name;\n                  if ('select' == limit.type) {\n                    common_stockPool.forEach(stockPool => {\n                      if (e.limit_val[0] == stockPool.id) {\n                        obj.value = stockPool.pool_name;\n                      }\n                    })\n                  }else if('input' == limit.type){\n                    obj.value = limit.operator + e.limit_val[0] + limit.unit;\n                  }\n\n                  limit_val_arr.push(obj);\n                });\n\n                let obj = {};\n                obj.name = el.limit_actionInfo.name;\n                el.limit_action.forEach(action => {\n                  if (e.limit_action == action.type) {\n                    obj.value = action.name;\n                  }\n                })\n                limit_action_arr.push(obj);\n              }\n            });\n\n            // 这里千万记得第一个参数是空对象，因为assign会修改第一个参数，导致所有的都是同一份数据。\n            var tmpObj = Object.assign({}, inObj, {\n              risk_type: e.risk_type,\n              rule_id: e.rule_id,\n              pre_val: e.pre_val,\n              limit_val: e.limit_val,\n              limit_action: e.limit_action,\n\n              pre_val_arr: pre_val_arr,\n              limit_val_arr: limit_val_arr,\n              limit_action_arr: limit_action_arr\n            })\n\n            ruleDetailArr.push(tmpObj);\n          })\n\n          return ruleDetailArr;\n          // console.log(ruleDetailArr);\n        },\n        getListCo: function(){\n          var _this = this;\n          $.ajax({\n            url: '/rms-pub/rule/get_list_co',\n            success: function({code, msg, data}){\n              if (0 == code) {\n                _this.totalsUnion = data;\n\n                _this.displayUnionRisk = [];\n\n                let ruleDetailsArr = _this.displayRuleDetails(_this.totalsUnion, {\n                  product_name: '所有交易单元',\n                  product_id: '-1'\n                });\n                _this.displayUnionRisk = _this.displayUnionRisk.concat(ruleDetailsArr);\n\n                // _this.prepareUnionDisplay();\n              }else{\n                $.omsAlert(msg)\n              }\n            },\n            error: function(e){\n              $.omsAlert('网络异常')\n            }\n          })\n        },\n        getList: function(){\n          var _this = this;\n          this.isRotate = true;\n          $.ajax({\n            url: '/rms-pub/rule/get_risk',\n            data: {\n              product_id: product_ids.join(',')\n            },\n            success: function({code, msg, data}){\n              if (0 == code) {\n                _this.totals = data;\n\n                _this.products = [];\n                Object.keys(_this.totals).forEach(function(e,index){\n                  _this.products.push({\n                    value:e,\n                    label:_this.totals[e]['product_name']\n                  });\n                });\n\n                _this.prepareDisplay();\n              }else{\n                $.omsAlert(msg);\n              }\n              _this.isRotate = false;\n            },\n            error: function(e){\n              $.omsAlert('网络异常');\n              _this.isRotate = false;\n            }\n          });\n        },\n        prepareDisplay:function(){\n          // displayTotals productSelected warnSelected\n          var rtn = {};\n          Object.keys(this.totals).forEach(e => {\n            let someFlag = this.warnSelected.some(el => {\n              var tmpFlag = false;\n              Object.keys(this.totals[e].risks).forEach(ele => {\n                if (this.totals[e].risks[ele].some(element => {\n                    if (1 == element.status) {\n                      return element.risk_type == el;\n                    }\n                })) {\n                  tmpFlag = true;\n                }\n              });\n              return tmpFlag;\n              // return el == this.totals[e].\n            });\n\n            if (this.productSelected.some(el => {\n              return el == e;\n            }) && (someFlag || this.warnSelected.length == 0)) {\n              rtn[e] = this.totals[e];\n            }\n          });\n\n          this.displayTotals = rtn;\n          this.independentSelected = JSON.parse(JSON.stringify(this.independentSelected));\n          //新添加交易单元排序 放在数组 product_change_list中\n          var arr = [];//触警的交易单元\n          var arr1 = [];//所有交易单元\n          var _this = this;\n          for (var value in rtn) {\n            rtn[value].flag = 0;\n            rtn[value].icon_status = 0; //区分交易单元左上角的标签 1是触警交易单元 0是正常交易单元\n            Object.keys(rtn[value].risks).forEach(function(e, i){\n              rtn[value].risks[e].forEach(function(el){\n                if (1 == el.status) {\n                  rtn[value].flag += 1; //设置一个参数方便后面进行排序\n                  rtn[value].icon_status = 1; //区分交易单元左上角的标签 1是触警交易单元\n                }\n              })\n            });\n            arr.push(rtn[value]); //先获取到所有的交易单元\n          }\n\n          arr.sort(function (a, b) { //给交易单元进行排序,触警的交易单元在前面\n            return b.flag - a.flag;\n          })\n\n          this.product_change_list = arr; //排序之后的交易单元\n        },\n        changeNav(v){ // 导航栏切换\n          this.current = v;\n        },\n        checkall(){ // 全选\n          this.checkallstatus = !this.checkallstatus;\n        },\n        setdozenfn(ischeck,product_id){ // 只保存选中的交易单元的product_id\n          if(ischeck){ // add\n            this.setdozenarr.push(product_id);\n          }else{ //del\n            for(let i = this.setdozenarr.length - 1 ; i >= 0 ; i--){\n              if(this.setdozenarr[i]==product_id){\n                this.setdozenarr.splice(i,1);\n              }\n            }\n          }\n        },\n        setdozengo(){ // 将选中的product_id 数组传递独立风险控制,并且tabq切换\n          if(this.setdozenarr.length < 1){\n            $.omsAlert('请先勾选交易单元');\n            return;\n          }\n          this.independentSelected = JSON.parse(JSON.stringify(this.setdozenarr));\n          this.changeNav(1);\n        },\n        setsinglefn(product_id){\n          this.setsingle = [];\n          this.setsingle.push(product_id);\n          this.independentSelected = JSON.parse(JSON.stringify(this.setsingle));\n          this.changeNav(1);\n        },\n        refresh(){// 风控监控页面刷新\n          this.getList();\n\n          // this.isRotate = true;\n          // let that = this;\n          // // 这里用定时器来模拟ajax异步操作,更新totals,以及其副本即可\n          // setTimeout(function(){\n          //   that.totals = totals;\n          //   that.totalsCopy = JSON.parse(JSON.stringify(totals))\n          //   that.isRotate = false;\n          // },1000)\n        },\n        productPreviewSilde(){ // 风控设置收起与展开\n          this.isSlideDown = !this.isSlideDown;\n          // console.log(\"clicked more\",this.isSlideDown)\n        },\n        productPreviewEnsure(){// 独立风控设置  确定选择交易单元\n          this.isSlideDown = !this.isSlideDown;\n          let that = this;\n\n          Object.keys(that.totals).forEach((e)=>{\n            that.totals[e]['checked'] = false;\n          })\n          that.independentSelected.forEach(k=>{\n            that.totals[k]['checked'] = true;\n          })\n\n          // // 下面会进行具体数据操作，那么需要保障所操纵的数据是最新的，用ajax重新刷新totals\n          // this.$nextTick(function(){\n          //   // that.totals = totals;\n          //   // 因数据刷新没有绑定选择的状态，需要在此处添加\n          //   Object.keys(that.totals).forEach((e)=>{\n          //     that.totals[e]['checked'] = false;\n          //   })\n          //   that.independentSelected.forEach(k=>{\n          //     that.totals[k]['checked'] = true;\n          //   })\n          // });\n        },\n        // 独立风控设置 取消交易单元选择\n        // 有一个bug，取消之后，this.independentSelected依旧是被修改的状态，不会恢复\n        productPreviewCancel(){\n          this.isSlideDown = !this.isSlideDown;\n        },\n        // 修改选中的交易单元\n        changeindependentSelectedData(product_id){\n          if(this.independentSelected.indexOf(product_id) < 0){\n            this.independentSelected.push(product_id)\n          }else{\n            let index = this.independentSelected.indexOf(product_id);\n            if(index>=0){\n              this.independentSelected.splice(index,1)\n              // console.log(product_id,JSON.parse(JSON.stringify(this.independentSelected)))\n            }\n          }\n\n        },\n      },\n    });\n\n    riskVue.getList();\n    riskVue.getListCo();\n  })\n\n});\n\n/**\n* 修改、添加列表时候显示不同的内容,自定义准备数据\n*/\nlet displayRules = [\n  {\n    name: '禁买股票池风控',\n    display: true,\n    num: 0,\n    type: 1,\n    pre_val: [{\n      name: '证券属于',\n      type: 'select',\n      value: '-1',\n      required: true,\n      placeHolder: '请选择股票池',\n      addition: [{\n        text: '自定义股票池',\n        action: 'addCustomStockPool'\n      }]\n    }],\n    limit_val: [], // 无限制条件\n    hideAction: true,\n    limit_actionInfo: {\n      name: '预警操作',\n      required: false,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n    //   type: 0,\n    //   name: '预警提醒'\n    // },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '净值仓位风控',\n    display: true,\n    num: 0,\n    type: 2,\n    pre_val: [{\n      // 单位净值\n      name: '单位净值',\n      type: 'input',\n      value: '',\n      operator: '<', // 运算符，显示在内容前\n      placeHolder: '请输入数字',\n      unit: '', // 数量单位\n      inputReg: /^\\d{1,4}\\.?\\d{0,4}$/,\n      reg: '^[1-9]/d*/./d*|0/./d*[1-9]/d*$' // 正则表达式的字符串，使用的时候记得new RegExp()\n    }],\n    limit_val: [{\n      // 最大仓位限制\n      name: '仓位',\n      type: 'input',\n      operator: '>',\n      value: '',\n      placeHolder: '请输入数字',\n      unit: '%',\n      inputReg: /^\\d{1,4}\\.?\\d{0,2}$/,\n      reg: '/^\\d*$/'\n    }],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '个股仓位风控',\n    display: true,\n    num: 0,\n    type: 3,\n    pre_val: [{\n      name: '证券属于',\n      type: 'select',\n      value: '-1',\n      required: true,\n      placeHolder: '请选择股票池',\n      addition: [{\n        text: '自定义股票池',\n        action: 'addCustomStockPool'\n      }]\n    }],\n    limit_val: [{\n      name: '个股仓位',\n      type: 'input',\n      value: '',\n      operator: '≥',\n      placeHolder: '请输入数字',\n      unit: '%',\n      inputReg: /^\\d{1,4}\\.?\\d{0,2}$/,\n      reg: '^[1-9]/d*/./d*|0/./d*[1-9]/d*$'\n    }],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '举牌风控',\n    display: true,\n    num: 0,\n    type: 4,\n    pre_val: [{\n      name: '监控内容',\n      type: 'select2',\n      value: '-4',\n      required: true,\n      placeHolder: '请选择监控内容',\n      options: [{\n        label: '个股持仓数量／总股本',\n        value: '-4'\n      }]\n    }],\n    limit_val: [{\n      name: '',\n      type: 'input',\n      value: '',\n      operator: '≥',\n      placeHolder: '请输入数字',\n      unit: '%',\n      inputReg: /^\\d{1,4}\\.?\\d{0,2}$/,\n      reg: '^[1-9]/d*/./d*|0/./d*[1-9]/d*$'\n    }],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '对敲风控',\n    display: true,\n    num: 0,\n    type: 5,\n    pre_val: [{\n      name: '监控内容',\n      type: 'select2',\n      value: '-5',\n      required: true,\n      placeHolder: '请选择监控内容',\n      options: [{\n        label: '提交委托与未成交委托反向',\n        value: '-5'\n      }]\n    }],\n    limit_val: [],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '个股仓位风控',\n    display: true,\n    num: 0,\n    type: 6,\n    pre_val: [{\n      name: '证券属于',\n      type: 'select',\n      value: '-1',\n      required: true,\n      placeHolder: '请选择股票池',\n      addition: [{\n        text: '自定义股票池',\n        action: 'addCustomStockPool'\n      }]\n    }],\n    limit_val: [{\n      name: '个股仓位',\n      type: 'input',\n      value: '',\n      operator: '≥',\n      placeHolder: '请输入数字',\n      unit: '%',\n      inputReg: /^\\d{1,4}\\.?\\d{0,2}$/,\n      reg: '^[1-9]/d*/./d*|0/./d*[1-9]/d*$'\n    }],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '举牌风控',\n    display: true,\n    num: 0,\n    type: 7,\n    pre_val: [{\n      name: '监控内容',\n      type: 'select2',\n      value: '-4',\n      required: true,\n      placeHolder: '请选择监控内容',\n      options: [{\n        label: '个股持仓数量／总股本',\n        value: '-4'\n      }]\n    }],\n    limit_val: [{\n      name: '',\n      type: 'input',\n      value: '',\n      operator: '≥',\n      placeHolder: '请输入数字',\n      unit: '%',\n      inputReg: /^\\d{1,4}\\.?\\d{0,2}$/,\n      reg: '^[1-9]/d*/./d*|0/./d*[1-9]/d*$'\n    }],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n\n  {\n    name: '对敲风控',\n    display: true,\n    num: 0,\n    type: 8,\n    pre_val: [{\n      name: '监控内容',\n      type: 'select2',\n      value: '-5',\n      required: true,\n      placeHolder: '请选择监控内容',\n      options: [{\n        label: '提交委托与未成交委托反向',\n        value: '-5'\n      }]\n    }],\n    limit_val: [],\n    limit_actionInfo: {\n      name: '预警操作',\n      required: true,\n      value: '0',\n      placeHolder: '请选择预警类型'\n    },\n    limit_action: [{\n      type: 0,\n      name: '预警提醒'\n    },{\n      type: 1,\n      name: '禁止'\n    }]\n  },\n];\n\n// 复制插件\nVue.component('selectize-stock-pool', {\n  props: ['options', 'value'],\n  template: `\n    <select>\n      <slot></slot>\n    </select>\n  `,\n  mounted: function () {\n    var vm = this;\n    var selectize = $(this.$el).selectize({\n      delimiter: ',',\n      persist: true,\n      placeholder: '请选择股票池',\n      valueField: 'id',\n      labelField: 'pool_name',\n      addPrecedence: true,\n      sortField: [],\n      render: {\n        'option': function(data, escape) {\n          var field_label = this.settings.labelField;\n          // 需要做一个判断，因为需要支持用户点击后新增股票池。\n          if (!isFinite(data.id)) {\n            return '<div class=\"option\" style=\"border-top: 1px dashed #000;\">' + escape(data[field_label]) + '</div>';\n          }else{\n            return '<div class=\"option\">' + escape(data[field_label]) + '</div>';\n          }\n        }\n      },\n      onChange: function(v){\n        // \"自定义股票池\"被选中时，不修改父组件的值，同时恢复子组件中selectize的值。仅触发父组件函数显示“自定义股票池”\n        if (!isFinite(v)) {\n          vm.$emit('show_stock_pool', v);\n          this.setValue(vm.value);\n        }else{\n          vm.$emit('input', v);\n        }\n      }\n    })[0].selectize;\n    // selectize.clearOptions(true);\n    var newOptions = this.options.concat({\n      pool_name: '自定义股票池',\n      id: Infinity\n    })\n    // selectize.addOption(this.options);\n    selectize.addOption(newOptions);\n    selectize.setValue(this.value);\n    selectize = null;\n  },\n  watch: {\n    value: function (value) {\n      // update value\n      $(this.$el).selectize()[0].selectize.setValue(value);\n    },\n    options: function (options) {\n      // // update options\n      var value = this.value;\n      var selectize = $(this.$el).selectize()[0].selectize;\n      selectize.clearOptions(true);\n      var newOptions = this.options.concat({\n        pool_name: '自定义股票池',\n        id: Infinity\n      })\n      // selectize.addOption(this.options);\n      selectize.addOption(newOptions);\n      selectize.setValue(value);\n      selectize = null;\n    }\n  }\n  ,\n  destroyed: function () {\n    $(this.$el).off().selectize()[0].selectize.destroy();\n  }\n});\n\nVue.component('risk-monitoring-row',{\n  mixins: [numberMixin, colorMixin],\n  props:['row','checkboxall', 'isShowSet'],// row:totols 中的每一行的信息, isShowSet 根据用户权限判断是否出现设置按钮\n  template:`\n    <div class=\"risk-monitoring_row\" style=\"padding-left:0;\">\n      <div class=\"risk-monitor_td_first ellipsis\" style=\"width:12%;text-align:left;\">\n        <span v-bind:class=\"[1 == row.icon_status?'icon-alert':'icon-normal']\" style=\"top:0;left:0;\">\n          <label class=\"icon-style\" v-text=\"product_type\"></label>\n        </span>\n        <input v-if=\"false\" type=\"checkbox\" :checked=\"ischeck\" style=\"margin-right:5px\" @click=\"checktocheck\">\n        <span v-text=\"row.product_name\" :title=\"row.product_name\" style=\"padding-left:30px;\"></span>\n      </div>\n      <div class=\"risk-monitor_td al risk_ellispis\" style=\"width:7%;text-align:left;padding-left:30px;\">\n        {{row.name}}\n      </div>\n      <div class=\"risk-monitor_td al\" style=\"width:7%;text-align:right;\" v-bind:class=\"rmgColor(row.net_value, 1)\">\n        {{numeralNumber(row.net_value, 4)}}\n      </div>\n      <div class=\"risk-monitor_td ac\" style=\"width:11%;text-align:right;padding-right:50px;\">\n        {{numeralPercent(row.position)}}\n      </div>\n      <div class=\"risk-monitor_td ac\" style=\"width:10%;text-align:right;padding-right:50px;\">\n        {{numeralNumber(row.total_assets, 2)}}\n      </div>\n      <div class=\"risk-monitor_td ac\" style=\"width:7%;text-align:right;\">\n        {{risknum}}\n      </div>\n      <div class=\"risk-monitor_td al\" style=\"width:15%;position:relative;text-align:left;\" @mouseover=\"showtypedetails\" @mouseout=\"showtypedetails\" >\n        <div class=\"risk-monitor_short risk_ellispis\" style=\"padding-left:50px;width:190px;text-overflow:ellipsis;overflow:hidden;\">\n          {{risktypes}}\n        </div>\n        <div class=\"risk-monitor_shadow\" v-show=\"show_risk_type_details\" style=\"left:9%;\">\n          {{risktypes_html}}\n        </div>\n      </div>\n      <div class=\"risk-monitor_td ac\" style=\"width:25%;position:relative;text-align:left;\" @mouseover=\"showdescsdetails\" @mouseout=\"showdescsdetails\">\n        <div class=\"risk-monitor_short risk_ellispis\" style=\"padding-left:20px;\">\n          <template v-if=\"riskDesc.length > 0\">\n          <div v-for=\"(singleDesc, descIndex) in riskDesc\" class=\"risk_ellispis__single\">\n            <span v-if=\"1 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发独立风控：股票属于' + singleDesc.pool_name + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"2 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + '基金当前仓位为' + numeralPercent(singleDesc.position) + '，触发独立风控：基金预估净值<' + numeralNumber(singleDesc.net_value_rule, 4) + ' 基金仓位>' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"3 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 基金持有总仓位=' + numeralPercent(singleDesc.position) + '，触发独立风控：基金持有' + singleDesc.stock_name + ' 仓位≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"4 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 个股持仓数量/总股本=' + numeralPercent(singleDesc.position) + '，触发独立风控：个股持仓数量/总股本≥' + singleDesc.factor + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"5 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发独立风控：提交委托与未成交委托反向' + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"6 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 基金持有总仓位=' + numeralPercent(singleDesc.position) + '，触发联合风控：基金持有'+ singleDesc.stock_name + ' 仓位≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"7 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 个股持仓数量/总股本=' + numeralPercent(singleDesc.position) + '，触发联合风控：个股持仓数量/总股本≥' + singleDesc.factor + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"8 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发联合风控：提交委托与未成交委托反向' + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"10 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': 全天委托笔数=' + singleDesc.entrust_total + '，全天撤单笔数/全天委托笔数=' + numeralPercent(singleDesc.position) + '，触发独立风控：全天委托笔数≥' + singleDesc.entrust_rule + '，全天撤单笔数/全天委托笔数≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action)  }}\n            </span>\n          </div>\n          </template>\n          <template v-else>\n          - -\n          </template>\n        </div>\n        <!-- 鼠标放在此处显示提示信息 -->\n        <div class=\"risk-monitor_shadow al\"  v-show=\"show_risk_descs_details\" style=\"width:82%;\">\n\n          <div v-for=\"(singleDesc, descIndex) in riskDesc\">\n            <span v-if=\"1 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发独立风控：股票属于' + singleDesc.pool_name + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"2 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + '基金当前仓位为' + numeralPercent(singleDesc.position) + '，触发独立风控：基金预估净值<' + numeralNumber(singleDesc.net_value_rule, 4) + ' 基金仓位>' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"3 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 基金持有总仓位=' + numeralPercent(singleDesc.position) + '，触发独立风控：基金持有' + singleDesc.stock_name + ' 仓位≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"4 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 个股持仓数量/总股本=' + numeralPercent(singleDesc.position) + '，触发独立风控：个股持仓数量/总股本≥' + singleDesc.factor + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"5 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发独立风控：提交委托与未成交委托反向' + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"6 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 基金持有总仓位=' + numeralPercent(singleDesc.position) + '，触发联合风控：基金持有'+ singleDesc.stock_name + ' 仓位≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"7 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 个股持仓数量/总股本=' + numeralPercent(singleDesc.position) + '，触发联合风控：个股持仓数量/总股本≥' + singleDesc.factor + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"8 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': ' + singleDesc.stock_id + ' ' + singleDesc.stock_name + ' 触发联合风控：提交委托与未成交委托反向' + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action) }}\n            </span>\n            <span v-if=\"10 == singleDesc.risk_type\">\n              {{(descIndex + 1) + ': 全天委托笔数=' + singleDesc.entrust_total + '，全天撤单笔数/全天委托笔数=' + numeralPercent(singleDesc.position) + '，触发独立风控：全天委托笔数≥' + singleDesc.entrust_rule + '，全天撤单笔数/全天委托笔数≥' + numeralPercent(singleDesc.factor) + ' ' + getLimitAction(singleDesc.risk_type, singleDesc.limit_action)  }}\n            </span>\n          </div>\n\n        </div>\n      </div>\n      <div style=\"flex: 1;text-align: right;padding-right:20px;\">\n        <div v-if=\"false\" class=\"risk-monitor_td_btn\" @click=\"decrease\">\n          <span class=\"risk-monitor_decrease\">降仓</span>\n        </div>\n        <div v-if=\"isShowSet\" class=\"risk-monitor_td_btn\" @click=\"set\">\n          <span class=\"risk-monitor_increase\">设置</span>\n        </div>\n      </div>\n    </div>\n  `,\n  mounted(){\n    // console.log(this.row)\n  },\n  data(){\n    return {\n      show_risk_type_details:false,\n      show_risk_descs_details:false,\n      ischeck:false\n    }\n  },\n  watch:{\n    checkboxall:function(n,o){ // 根元素，全选与非全选\n      this.ischeck = n;\n    },\n    ischeck:function(n,o){\n      this.$emit('setdozen',n,this.row.product_id);\n    }\n  },\n  computed:{\n    product_type: function () {\n      return  1 == this.row.icon_status ? '触警': '正常';\n    },\n    // 风控条数,status == 1 为触发，status == 0 为不触发\n    risknum(){\n      let n = 0;\n      let _this = this;\n\n      Object.values(_this.row.risks).forEach(function(e){\n        e.forEach(function(el){\n          // 测试已经与交易单元确认，这里展示的是配置的风控，而不是触警的风控\n          // if (1 == el.status) {\n            n++;\n          // }\n        })\n      })\n\n      return n;\n    },\n    // 触发风险类别，一般字符串\n    risktypes(){\n      return this.tranformtypes(true);\n    },\n    // 触发风险类别，弹框形式\n    risktypes_html(){\n      return this.tranformtypes(false);\n    },\n    riskDetails(){\n      return this.displayRuleDetails();\n      // let ruleDetailArr = this.displayRuleDetails();\n    },\n    riskDetailsV2(){\n      let _this = this;\n      let arr = [];\n      Object.keys(this.row.risks).forEach(function(e, i){\n        _this.row.risks[e].forEach(function(el){\n          if (1 == el.status) {\n            arr.push(el);\n          }\n        })\n      });\n\n      return arr;\n    },\n    riskDesc(){\n      let _this = this;\n      let arr = [];\n      Object.values(this.row.desc).forEach(function(e){\n        arr.push(e);\n      });\n      return arr;\n    }\n  },\n  methods:{\n    getLimitAction: function(type, limit_action){\n      // GetLimitAction(type, limit_action);\n      if (0 == limit_action) {\n        return '预警提醒';\n      }\n      if (1 == limit_action) {\n        return '禁止';\n      }\n    },\n    showtypedetails(){\n      // 没有内容的数据鼠标移入不展示详情浮窗\n      if (this.risktypes === '- -') {\n        return;\n      }\n      this.show_risk_type_details = !this.show_risk_type_details;\n    },\n    showdescsdetails(){\n      // 没有内容的数据鼠标移入不展示详情浮窗\n      if (this.riskDesc.length <= 0) {\n        return;\n      }\n      this.show_risk_descs_details = !this.show_risk_descs_details;\n    },\n    // 获取已触发风控的风控数组\n    getActiveRulesArr(){\n      let _this = this;\n      let arr = [];\n      const riskInfo = {\n        target:'禁买股票池风控',\n        wholePosition:'净值仓位风控',\n        onePosition:'个股仓位风控',\n        placards:'举牌风控',\n        controTrade:'对敲风控',\n        onePositionCo:'个股仓位风控',\n        placardsCo:'举牌风控',\n        controTradeCo:'对敲风控',\n        entrustRevoke: '频繁报撤风控'\n      };\n\n      Object.keys(this.row.risks).forEach(function(e, i){\n        if (_this.row.risks[e].some(function(el){\n          return 1 == el.status;\n        })) {\n          arr.push(riskInfo[e]);\n        }\n      });\n\n      return arr;\n    },\n    unique: function(arr) {\n      const seen = new Map()\n      return arr.filter((a) => !seen.has(a) && seen.set(a, 1))\n    },\n    // flag 为true 时显示普通文本，为false显示弹出框文本\n    tranformtypes(flag){\n      var riskArr = this.getActiveRulesArr();\n      riskArr = this.unique(riskArr);\n      let str = '';\n\n      if (riskArr.length == 0) {\n        str = '- -';\n      }else{\n        str = riskArr.join('、');\n      }\n\n      return str;\n    },\n    // 给定risks结构，计算出所有的风控\n    displayRuleDetails(){\n      let _this = this;\n      let arr = [];\n      Object.keys(this.row.risks).forEach(function(e, i){\n        _this.row.risks[e].forEach(function(el){\n          if (1 == el.status) {\n            arr.push(el);\n          }\n        })\n      });\n\n      let ruleDetailArr = [];\n\n      arr.forEach(function(e){\n        let pre_val_arr = [];\n        let limit_val_arr = [];\n        let limit_action_arr = [];\n\n        displayRules.forEach(function(el){\n          // 找到匹配的风控出来\n          // 接口处的是risk_type，而前端页面自定义的是type\n          if (e.risk_type == el.type) {\n            // 准备pre_val，limit_val、limit_action\n            el.pre_val.forEach(pre => {\n              let obj = {};\n              obj.name = pre.name;\n              if ('select' == pre.type) {\n                common_stockPool.forEach(stockPool => {\n                  if (e.pre_val[0] == stockPool.id) {\n                    obj.value = stockPool.pool_name;\n                  }\n                })\n              }else if('input' == pre.type){\n                obj.value = pre.operator + e.pre_val[0] + pre.unit;\n              }else if('select2' == pre.type){\n                let str = '';\n                pre.options.forEach(option => {\n                  if (e.pre_val[0] == option.value) {\n                    str = option.label;\n                  }\n                });\n                obj.value = str;\n              }\n\n              pre_val_arr.push(obj);\n            });\n\n            el.limit_val.forEach(limit => {\n              let obj = {};\n              obj.name = limit.name;\n              if ('select' == limit.type) {\n                common_stockPool.forEach(stockPool => {\n                  if (e.limit_val[0] == stockPool.id) {\n                    obj.value = stockPool.pool_name;\n                  }\n                })\n              }else if('input' == limit.type){\n                obj.value = limit.operator + e.limit_val[0] + limit.unit;\n              }\n\n              limit_val_arr.push(obj);\n            });\n\n            let obj = {};\n            obj.name = el.limit_actionInfo.name;\n            el.limit_action.forEach(action => {\n              if (e.limit_action == action.type) {\n                obj.value = action.name;\n              }\n            })\n            limit_action_arr.push(obj);\n          }\n        });\n\n        ruleDetailArr.push({\n          risk_type: e.risk_type,\n          pre_val: e.pre_val,\n          limit_val: e.limit_val,\n          limit_action: e.limit_action,\n          rule_id: e.rule_id,\n          status: e.status,\n          pre_val_arr: pre_val_arr,\n          limit_val_arr: limit_val_arr,\n          limit_action_arr: limit_action_arr\n        });\n      })\n\n      return ruleDetailArr;\n      // console.log(ruleDetailArr);\n    },\n    checktocheck(){ // 选中checkbox,选中自己，发送事件\n      this.ischeck = !this.ischeck;\n    },\n    decrease(){  // 降仓跳转,跳转到委托管理页面,待完善\n      // console.log(this.row.product_id)\n\n    },\n    set(){  // 设置，跳转到独立风控页面，并勾选(只设置单选项)\n      this.$emit('setsingle',this.row.product_id)\n    }\n  }\n});\n\n// 页面混合，vue的语法\nlet reportMixin = {\n  // mounted: function(){\n  //   // 切换菜单时，会触发mounted事件，\n  //   let sortData = '';\n  //   common_storage.getItem(this.typeStr, (rtn) => {\n  //     if (0 == rtn.code) {\n  //       this.order = rtn.data.order;\n  //       this.order_by = rtn.data.order_by;\n  //       // display_rules 根据保存的field_sort进行排序\n  //       // rtn.data.field_sort 从尾到头遍历，一旦匹配则unshift添加到display_rules数组前面，且删除原来那个元素。（注意，display_rules长度及元素位置在变化，所以应该从0开始计数）\n  //       for (let i = rtn.data.field_sort.length - 1; i >= 0; i--) {\n  //         for (let j = 0, length = this.display_rules.length; j < length; j++) {\n  //           if (this.display_rules[j].id == rtn.data.field_sort[i]) {\n  //             let obj = this.display_rules[j];\n  //             this.display_rules.splice(j, 1);\n  //             this.display_rules.unshift(obj);\n  //           }\n  //         }\n  //       }\n\n  //       // // console.log('typeStr: ' + this.typeStr);\n  //       // this.$emit('order', {\n  //       //   order: this.order,\n  //       //   order_by: this.order_by,\n  //       //   typeStr: this.typeStr,\n  //       //   display_rules: this.display_rules\n  //       // });\n  //     }\n\n  //     this.$emit('order', {\n  //       order: this.order,\n  //       order_by: this.order_by,\n  //       typeStr: this.typeStr,\n  //       display_rules: this.display_rules\n  //     });\n\n  //   });\n\n  // },\n  computed: {\n    // 可拖动插件的入参\n    dragOptions () {\n      return  {\n        animation: 0,\n        // group: 'description',\n        // disabled: !this.editable,\n        ghostClass: 'ghost'\n      };\n    }\n  },\n  methods: {\n    chgSort: function(id){\n      if (id == this.order_by) {\n        if (this.order == 'asc') {\n          this.order = 'desc';\n        }else if(this.order == 'desc'){\n          this.order = '';\n        }else{\n          this.order = 'asc'\n        }\n      }else{\n        this.order_by = id;\n        this.order = 'asc';\n      }\n      // 用户切换排序命令，需要保存新的排序\n      let obj = {};\n      obj.field_sort = this.display_rules.map(function(e){\n        return e.id\n      });\n      obj.order_by = this.order_by;\n      obj.order = this.order;\n\n      this.$emit('order', {order: this.order,\n        order_by: this.order_by,\n        typeStr: this.typeStr,\n        display_rules: this.display_rules\n      });\n      common_storage.setItem(this.typeStr, obj);\n    },\n    onMove: function({relatedContext, draggedContext}){\n      const relatedElement = relatedContext.element;\n      const draggedElement = draggedContext.element;\n      return (!relatedElement || !relatedElement.fixed) && !draggedElement.fixed\n    },\n    onEnd: function(){\n      // 用户切换表格排序，需要保存新的排序\n      let obj = {};\n      obj.field_sort = this.display_rules.map(function(e){\n        return e.id\n      });\n      obj.order_by = this.order_by;\n      obj.order = this.order;\n      common_storage.setItem(this.typeStr, obj);\n    },\n    displayValue: function(sub_value, rule){\n      let value = sub_value[rule.id];\n      if ((rule.format != '') && (rule.format instanceof Array) && (this[rule.format[0]] instanceof Function)) {\n        // value = this[rule.format].call(this, value, )\n        let args = [value].concat(rule.format.slice(1))\n        value = this[rule.format[0]].apply(this, args);\n\n      }\n      if (rule.unit) {\n        return value + rule.unit;\n      }else{\n        return value;\n      }\n    },\n    checkPositive: function(num){\n      return parseFloat(num) > 0;\n    },\n    checkNegative: function(num){\n      return parseFloat(num) < 0;\n    }\n  }\n};\nlet riskDetailData = {\n  typeStr: 'risk_detail_data',\n  order: '',\n  order_by: '',\n  display_rules: [{\n    id: 'product_name',\n    label: '交易单元',\n    format: '',\n    class: 'left20 width250'\n  }, {\n    id: 'risk_type_str',\n    label: '风控类别',\n    showOrder: true,\n    format: '',\n    class: 'left20 width250'\n  }, {\n    id: 'risk_rule',\n    label: '风控规则',\n    format: '',\n    class: 'left20'\n  }]\n}\nVue.component('vue-risk-detail', {\n  mixins: [reportMixin],\n  props: ['in_selected_risk', 'independent_selected', 'current'],// in_selected_risk是风控数据，independent_selected是选中的交易单元，independent_selected主要是为了解决列表为空的显示\n  template: `\n  <table class=\"newweb-common-grid\">\n    <thead>\n      <tr>\n        <th>\n          <input type=\"checkbox\" v-model=\"selectAll\" @change=\"chgSelectAll()\" />\n        </th>\n        <th v-for=\"rule in display_rules\" v-bind:class=\"rule.class\">\n          <span>{{rule.label}}</span>\n          <a v-if=\"rule.showOrder\" class=\"icon-sortBy\" v-on:click=\"chgSort(rule.id)\">\n            <i class=\"icon-asc\" :class=\"{active: (order_by == rule.id && order == 'asc')}\"></i>\n            <i class=\"icon-desc\" :class=\"{active: (order_by == rule.id && order == 'desc')}\"></i>\n          </a>\n        </th>\n        <th></th>\n      </tr>\n    </thead>\n    <tbody v-if=\"display_data && display_data.length > 0\">\n      <template v-for=\"row in display_data\">\n        <tr>\n          <td>\n            <input type=\"checkbox\" v-model=\"row.web_checked\" @change=\"chgSelectedRules()\" />\n          </td>\n          <td v-for=\"rule in display_rules\" v-if=\"rule.id != 'risk_rule'\" v-bind:class=\"rule.class\" :title=\"displayValue(row, rule)\" style=\"text-overflow: ellipsis;overflow: hidden;white-space: nowrap;\">\n            {{displayValue(row, rule)}}\n          </td>\n          <td v-for=\"rule in display_rules\" v-if=\"rule.id == 'risk_rule'\" class=\"left20\">\n            <div v-for=\"pre_val in row.pre_val_arr\" style=\"margin-right: 5px;\">\n              <span>{{pre_val.name}}</span>\n              <span style=\"color: rgb(33, 150, 243)\">{{pre_val.value}}</span>\n            </div>\n            <div v-for=\"limit_val in row.limit_val_arr\" style=\"margin-right: 5px;\">\n              <span>{{limit_val.name}}</span>\n              <span style=\"color: rgb(33, 150, 243)\">{{limit_val.value}}</span>\n            </div>\n            <div v-for=\"limit_action in row.limit_action_arr\" style=\"margin-right: 5px;\">\n              <span style=\"color: rgb(244, 67, 54);\">{{limit_action.value}}</span>\n            </div>\n          </td>\n          <td>\n            <a class=\"details_list_btn_modify\" @click=\"editRule(row, row.rule_id, row.risk_type)\">修改</a>\n            <a class=\"details_list_btn_del\" @click=\"deleteRule(row.rule_id, row.risk_type)\">删除</a>\n          </td>\n        </tr>\n        <tr v-if=\"row.rule_id == curEditRule.rule_id\" style=\"height: 84px;\">\n          <td colspan=\"999\" style=\"background: #F7F7F7;\">\n            <template v-for=\"rule in rulesNeedShow\" v-if=\"rule.type == row.risk_type\">\n              <!-- Begin：pre_val条件 -->\n              <template v-for=\"(val, index) in rule.pre_val\">\n                <label class=\"rules-label\">\n                  <span v-text=\"val.name\"></span>\n                  <template v-if=\"'input' == val.type\">\n                    <div class=\"rules_input\" style=\"display: inline-block;\">\n                      <span v-text=\"val.operator\"></span>\n                      <input :placeholder=\"val.placeHolder\" type=\"text\" v-model=\"curEditRule.pre_val[index]\" @keydown=\"checkKeyDown($event, val.inputReg, curEditRule.pre_val[index]);return false;\" />\n                      <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                    </div>\n                  </template>\n                  <template v-if=\"'select' == val.type\">\n                    <select :value=\"val.value\" v-model=\"curEditRule.pre_val[index]\">\n                      <option v-if=\"val.required\" disabled=\"disabled\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                      <option v-if=\"!val.required\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                      <option v-for=\"(v, i) in stockPool\" v-text=\"v.pool_name\" :value=\"v.id\"></option>\n                    </select>\n                  </template>\n                  <template v-if=\"'select2' == val.type\">\n                    <select style=\"font-size: 12px;\" :value=\"val.value\" v-model=\"curEditRule.pre_val[index]\">\n                      <option v-for=\"option in val.options\" v-text=\"option.label\" :value=\"option.value\"></option>\n                    </select>\n                  </template>\n                </label>\n              </template>\n              <!-- End：pre_val条件 -->\n\n              <!-- Begin：limit_val条件 -->\n              <template v-for=\"(val, index) in rule.limit_val\">\n                <label class=\"rules-label\">\n                  <span v-text=\"val.name\"></span>\n                  <template v-if=\"'input' == val.type\">\n                    <div class=\"rules_input\" style=\"display: inline-block;\">\n                        <span v-text=\"val.operator\"></span>\n                        <input type=\"text\" :placeholder=\"val.placeHolder\" v-model=\"curEditRule.limit_val[index]\" @keydown=\"checkKeyDown($event, val.inputReg, curEditRule.limit_val[index]);return false;\" />\n                        <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                    </div>\n                  </template>\n                  <template v-if=\"'select' == val.type\">\n                    <select :value=\"val.value\" v-model=\"curEditRule.limit_val[index]\">\n                        <option v-if=\"val.required\" disabled=\"disabled\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                        <option v-if=\"!val.required\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                        <option v-for=\"(v, i) in stockPool\" v-text=\"v.pool_name\" :value=\"v.id\"></option>\n                    </select>\n                  </template>\n                </label>\n              </template>\n              <!-- End：limit_val条件 -->\n\n              <!-- Begin：limit_actionInfo条件 -->\n              <label v-if=\"rule.hideAction !== true\" class=\"rules-label\">{{rule.limit_actionInfo.name}}\n                <select :value=\"rule.limit_actionInfo.value\" v-model=\"curEditRule.limit_action\">\n                  <option v-if=\"rule.limit_actionInfo.required\" disabled=\"disabled\" value=\"default\" v-text=\"rule.limit_actionInfo.placeHolder\"></option>\n                  <option v-if=\"!rule.limit_actionInfo.required\" value=\"default\" v-text=\"rule.limit_actionInfo.placeHolder\"></option>\n                  <option v-for=\"(val, index) in rule.limit_action\" v-text=\"val.name\" :value=\"val.type\"></option>\n                </select>\n              </label>\n              <!-- End：limit_actionInfo条件 -->\n\n              <div class=\"btnDiv\" style=\"float: right;\">\n                <a class=\"ui-btn btn-save\" v-on:click=\"saveEdit()\">保存</a>\n                <a class=\"ui-btn btn-cancel\" v-on:click=\"cancelEdit()\">取消</a>\n              </div>\n            </template>\n          </td>\n        </tr>\n      </template>\n    </tbody>\n    <tbody v-if=\"display_data && Object.keys(display_data).length == 0 && 0 == independent_selected.length\">\n      <tr>\n        <td class=\"left30\" colspan=\"99\" style=\"justify-content: flex-start;\">暂未添加任何风控</td>\n      </tr>\n    </tbody>\n    <tbody v-if=\"display_data && Object.keys(display_data).length == 0 && 0 != independent_selected.length\">\n      <tr>\n        <td class=\"left30\" colspan=\"99\" style=\"justify-content: flex-start;\">暂未添加任何风控</td>\n      </tr>\n    </tbody>\n  </table>\n  `,\n  data(){\n    return Object.assign({\n      selectAll: false,\n      displayRules: displayRules,\n      stockPool: common_stockPool,\n      display_data: [],\n      source_data: [],\n      curEditRule: {\n        product_id: '',\n        rule_id: '',\n        risk_type: '',\n        pre_val: [],\n        limit_val: [],\n        limit_action: 0\n      },\n      display_check_all: [], //联合风控设置选中的风控规则\n    }, riskDetailData)\n    // return riskDetailData;\n  },\n  watch: {\n    in_selected_risk: function(){\n      this.source_data = this.in_selected_risk.map(e => {\n        e.web_checked = false;\n        e.risk_type_str = this.displayRiskType(e.risk_type);\n        return e;\n      });\n\n      var arr = JSON.parse(JSON.stringify(this.source_data));\n      this.display_data = VUECOMPONENT.sort(arr, this.order, this.order_by);\n    },\n    order: function(){\n      var arr = JSON.parse(JSON.stringify(this.source_data));\n      this.display_data = VUECOMPONENT.sort(arr, this.order, this.order_by);\n    },\n    order_by: function(){\n      var arr = JSON.parse(JSON.stringify(this.source_data));\n      this.display_data = VUECOMPONENT.sort(arr, this.order, this.order_by);\n    }\n  },\n  computed: {\n    // display_data(){\n    //   return this.in_selected_risk.map(e => {\n    //     e.web_checked = false;\n    //     return e;\n    //   });\n    // },\n    rulesNeedShow(){\n      var rtn = [];\n      // var tmpType = parseInt(this.curentRuleType);\n      this.displayRules.forEach(function(e){\n        rtn.push(e);\n      });\n\n\n\n      return rtn;\n    },\n  },\n  methods: {\n    checkKeyDown: function(e, reg, value){\n      if (8 == e.keyCode) {\n        return;\n      }\n\n      if (/\\S/.test(e.key)) {\n        if (reg.test(value + e.key)) {\n          // value = value + e.key;\n          return true;\n        }\n        e.preventDefault();\n        return false;\n      }\n      e.preventDefault();\n      return false;\n    },\n    chgSelectAll: function(){\n      var _this = this;\n      let arr = []; //独立风控\n      this.$nextTick(() => {\n        this.display_data.forEach(e => { //独立风控\n          e.web_checked = _this.selectAll;\n          if (true == e.web_checked) {\n            arr.push(e);\n          }\n        });\n        if (1 == _this.current) {\n          this.$emit('chg_select_rules', arr); //独立风控\n          return;\n        }\n        if (2 == _this.current) {\n          this.$emit('union_select_rules', arr); //联合风控\n          return;\n        }\n      })\n    },\n    chgSelectedRules: function(){\n      let arr = [];\n      this.display_data.forEach(e => {\n        if (e.web_checked) {\n          arr.push(e);\n        }\n      });\n      // console.log(arr);\n\n      if (this.display_data.length > 0 && this.display_data.every(e => {\n        return e.web_checked == true;\n      })) {\n        this.selectAll = true;\n      }else{\n        this.selectAll = false;\n      }\n      if (1 == this.current) {\n        this.$emit('chg_select_rules', arr); //独立风控\n        return;\n      }\n      if (2 == this.current) {\n        this.$emit('union_select_rules', arr); //联合风控\n        return;\n      }\n    },\n    displayRiskType(val){\n      let rtn = '';\n      displayRules.forEach(e => {\n        if (e.type == val) {\n          rtn = e.name;\n        }\n      });\n      return rtn;\n    },\n    editRule(row, id, type){\n      var _this = this;\n      this.curEditRule.rule_id = id;\n      this.curEditRule.risk_type = type;\n      this.curEditRule.product_id = row.product_id;\n\n      this.curEditRule.pre_val = row.pre_val;\n      this.curEditRule.limit_val = row.limit_val;\n      this.curEditRule.limit_action = row.limit_action;\n    },\n    deleteRule(id, type){\n      // GetNameByRiskType(type)\n      var thisRule;\n      this.in_selected_risk.forEach(e => {\n        if (e.rule_id == id) {\n          thisRule = e;\n        }\n      });\n\n      var that = this;\n      // GetNameByRiskType(type)\n      let html = `\n        <table>\n          <thead>\n            <tr>\n              <td style=\"padding-left: 50px; width: 110px;\">交易单元</td>\n              <td style=\"padding-left: 20px; width: 110px;\">风控类别</td>\n              <td>风控规则</td>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td style=\"padding-left: 50px; width: 110px;\">`+ thisRule.product_name +`</td>\n              <td style=\"padding-left: 20px; width: 110px;\">`+ GetNameByRiskType(thisRule.risk_type) +`</td>\n              <td>`+ GetPreVal(type, thisRule.pre_val) + GetLimitVal(type, thisRule.limit_val) + GetLimitAction(type, thisRule.limit_action) +`</td>\n            </tr>\n          </tbody>\n        </table>\n      `;\n\n      $.confirm({\n        title: '删除确认',\n        content: html,\n        closeIcon: true,\n        confirmButton: '确认',\n        cancelButton: false,\n        confirm: function(){\n          $.startLoading('正在删除...');\n          $.ajax({\n            url: '/rms-pub/rule/delete',\n            type: 'post',\n            data: {\n              id: id\n            },\n            success: function({code, msg, data}){\n              $.clearLoading();\n              riskVue.getList();\n              riskVue.getListCo();\n              $.omsAlert('删除成功');\n            },\n            error: function(){\n              $.clearLoading();\n            }\n          })\n        }\n      });\n    },\n    resetEditRule: function(){\n      this.curEditRule={\n        product_id: '',\n        rule_id: '',\n        risk_type: '',\n        pre_val: [],\n        limit_val: [],\n        limit_action: 0\n      };\n    },\n    cancelEdit: function(){\n      this.resetEditRule();\n    },\n    saveEdit: function(){\n      var tmpEditRule = this.curEditRule;\n\n      var pre_val_arr = tmpEditRule.pre_val.filter(function(e){\n        return e != undefined;\n      });\n      var pre_val = pre_val_arr.join(',');\n      var limit_val_arr = tmpEditRule.limit_val.filter(function(e){\n        return e != undefined;\n      });\n      var limit_val = limit_val_arr.join(',');\n      var status = true;\n      if (pre_val_arr.length < tmpEditRule.pre_val.length || limit_val_arr.length < tmpEditRule.limit_val.length) {\n        status = false;\n      }\n\n      pre_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      });\n      limit_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      })\n      if (false == status) {\n        $.omsAlert('请输入正确的数字');\n        return;\n      }\n\n      // console.log(this.curEditRule);\n\n      var _this = this;\n      $.startLoading('正在修改...');\n      $.ajax({\n        url: '/rms-pub/rule/modify',\n        type: 'post',\n        data: {\n          id: tmpEditRule.rule_id,\n          product_id: tmpEditRule.product_id,\n          risk_type: tmpEditRule.risk_type,\n          pre_val: tmpEditRule.pre_val.join(','),\n          limit_val: tmpEditRule.limit_val.join(',') || '-1',\n          limit_action: tmpEditRule.limit_action\n        },\n        success: function({code, msg, data}){\n          $.clearLoading();\n          if (0 == code) {\n            riskVue.getList();\n            riskVue.getListCo();//保存之后刷新修改的数据\n            $.omsAlert('修改成功');\n            _this.resetEditRule();\n          }else{\n            $.omsAlert('修改失败，请重试。');\n          }\n        },\n        error: function(){\n          $.clearLoading();\n        }\n      })\n    },\n  }\n})\n\n// 风控规则说明 点击展开面板\nVue.component('vue-risk-description', {\n  props: ['cur_display_rule'],\n  template: `\n    <div>\n      <img class=\"risk__description--img\" :src=\"'/omsv2/images/oms_client/risk-description-' + cur_display_rule.type + '.png'\">\n    </div>\n  `,\n})\n\n// 新增风控\nVue.component('vue-single-addrisk',{\n  props:['independent_selected', 'display_rules_arr', 'products', 'in_selected_risk'],//productId list\n  template:`\n    <div class=\"risk_rules\" id=\"risk_rules\">\n      <div class=\"junior_rules\">\n        <ul>\n          <template v-for=\"display_type in display_rules_arr\">\n            <li v-if=\"display_type == display.type\" v-for=\"(display, i) in displayRules\" v-on:mouseup=\"setSelected(display.type)\">\n               <label :class=\"[{selected: checkSelected(display.type)}]\">\n                   <span class=\"rules_name\">{{display.name}}</span>\n                   <input class=\"rules_selected\" name=\"rules_selected\" type=\"radio\" />\n                   <span class=\"rules_status\">已设置：{{ getDisplayRulesNum(display.type) }}条</span>\n               </label>\n            </li>\n          </template>\n        </ul>\n        <template v-if=\"0 >= selected\">\n          <p class=\"empty-text\">\n             请先选择风控类别\n          </p>\n        </template>\n        <template v-else>\n          <div class=\"rules_describe\">\n            <div class=\"rules_describe_title\" :class=\"[{displayed: showDescription}]\">\n              <span class=\"rules_describe_span\">风控规则说明</span>\n              <span class=\"rules_describe_display\" v-on:click=\"changeDescription\">{{showDescription?'收起':'展开'}}<i></i></span>\n            </div>\n\n            <vue-risk-description :cur_display_rule=\"curDisplayRule\" class=\"rules_describe_content\" :class=\"[{displayed: showDescription}]\"></vue-risk-description>\n          </div>\n\n          <div class=\"rules_add\" style=\"display: block;\">\n            <!-- 新增规则选择 -->\n            <template v-for=\"(val, index) in curDisplayRule.pre_val\">\n              <label>{{val.name}}\n                <template v-if=\"'input' == val.type\">\n                  <div class=\"rules_input\">\n                    <span v-text=\"val.operator\"></span>\n                    <input :placeholder=\"val.placeHolder\" type=\"text\" :value=\"val.value\" v-model=\"addRule_preVal[index]\" @keydown=\"checkKeyDown($event, val.inputReg, addRule_preVal[index]);return false;\" />\n                    <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                  </div>\n                </template>\n                <template v-if=\"'select' == val.type\">\n                  <div class=\"rules_select\">\n                    <selectize-stock-pool :options=\"stockPool\" v-model=\"addRule_preVal[index]\" v-on:show_stock_pool=\"showStockPool\" >\n                    </selectize-stock-pool>\n                  </div>\n                </template>\n                <template v-if=\"'select2' == val.type\">\n                  <select style=\"font-size: 12px;\" :value=\"val.value\" v-model=\"addRule_preVal[index]\">\n                    <option v-for=\"option in val.options\" v-text=\"option.label\" :value=\"option.value\"></option>\n                  </select>\n                </template>\n              </label>\n            </template>\n            <template v-for=\"(val, index) in curDisplayRule.limit_val\">\n              <label>{{val.name}}\n                <template v-if=\"'input' == val.type\">\n                  <div class=\"rules_input\">\n                    <span v-text=\"val.operator\"></span>\n                    <input type=\"text\" :placeholder=\"val.placeHolder\" :value=\"val.value\" v-model=\"addRule_limitVal[index]\" @keydown=\"checkKeyDown($event, val.inputReg, addRule_limitVal[index]);return false;\" />\n                    <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                  </div>\n                </template>\n                <template v-if=\"'select' == val.type\">\n                  <select :value=\"val.value\" v-model=\"addRule_limitVal[index]\">\n                    <option v-if=\"val.required\" disabled=\"disabled\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                    <option v-if=\"!val.required\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                    <option v-for=\"(v, i) in stockPool\" v-text=\"v.pool_name\" :value=\"v.id\"></option>\n                  </select>\n                </template>\n              </label>\n            </template>\n            <label v-if=\"curDisplayRule.hideAction !== true\">{{curDisplayRule.limit_actionInfo.name}}\n              <select :value=\"addRule_actionValue\" v-model=\"addRule_actionValue\">\n                <option v-if=\"curDisplayRule.limit_actionInfo.required\" disabled=\"disabled\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n                <option v-if=\"!curDisplayRule.limit_actionInfo.required\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n                <option v-for=\"(val, index) in curDisplayRule.limit_action\" v-text=\"val.name\" :value=\"val.type\"></option>\n               </select>\n             </label>\n          </div>\n\n          <h3 class=\"vue-common-title\" style=\"margin-left: 30px; margin-top: 30px;\">新增风控预览</h3>\n          <div class=\"rules_added\" style=\"min-height: initial;padding: 0;\">\n            <table class=\"newweb-common-grid\">\n              <thead>\n                <tr>\n                  <th class=\"left20 width250\">交易单元</th>\n                  <th class=\"left20 width250\">风控类别</th>\n                  <th class=\"left20\">风控规则</th>\n                  <th></th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"product in independent_selected\">\n                  <td class=\"left20 width250\" style=\"text-overflow: ellipsis;overflow: hidden;white-space: nowrap;\">{{showProductName(product)}}</td>\n                  <td class=\"left20 width250\">{{showRuleType(curDisplayRule.type)}}</td>\n                  <td class=\"left20\">\n                    <div class=\"risk_details_text\">\n                      <template v-if=\"undefined !== addRule_preVal[index]\" v-for=\"(val, index) in curDisplayRule.pre_val\">\n                        <span v-if=\"curDisplayRule.hideAction !== true\" v-text=\"val.name\"></span>\n                        <template v-if=\"'input' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"val.operator + ' ' + addRule_preVal[index] + val.unit\"></span>\n                          <span>，</span>\n                        </template>\n                        <template v-if=\"'select' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"getStockPoolByCode(addRule_preVal[index])\"></span>\n                          <span v-if=\"curDisplayRule.hideAction !== true\">，</span>\n                        </template>\n                        <template v-if=\"'select2' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"getRulesDisplayByValue(val, addRule_preVal[index])\"></span>\n                          <span v-if=\"curDisplayRule.hideAction !== true\">，</span>\n                        </template>\n                      </template>\n                      <template v-if=\"undefined !== addRule_limitVal[index]\" v-for=\"(val, index) in curDisplayRule.limit_val\">\n                        <span v-text=\"val.name\"></span>\n                        <template v-if=\"'input' == val.type\">\n                            <span style=\"color: #2196F3;\" v-text=\"val.operator + ' ' + addRule_limitVal[index] + val.unit\"></span>\n                            <span>，</span>\n                        </template>\n                        <template v-if=\"'select' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"rule.limit_val[addRule_limitVal[index]]\"></span>\n                          <span>，</span>\n                        </template>\n                      </template>\n                      <template v-if=\"'' !== addRule_actionValue\">\n                        <template v-if=\"curDisplayRule.hideAction !== true && false\">\n                          <span>提交指令及委托时</span>\n                          <span>，</span>\n                        </template>\n                        <template v-for=\"(val, index) in curDisplayRule.limit_action\">\n                          <span v-if=\"val.type == addRule_actionValue\" v-text=\"val.name\" style=\"color:#F44336;margin-right: 20px;\"></span>\n                        </template>\n                      </template>\n                      <span style=\"color:#a29e9e;\">（新增规则预览）</span>\n                    </div>\n                  </td>\n                  <td></td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div class=\"rules_btns\" style=\"text-align:right\">\n            <a v-bind:class=\"{'disabled': checkSubmitDisabled()}\" class=\"ui-btn add\" v-on:click=\"rule_add\" style=\"margin-right:45px\">确认添加</a>\n          </div>\n        </template>\n      </div>\n    </div>\n  `,\n  data(){\n    return {\n      isNormal: true,\n      selected: 0,\n      showDescription: true,\n\n      selected: 0,\n      value: 0,\n      options: [\n        { id: 1, text: 'Hello' },\n        { id: 2, text: 'World' }\n      ],\n      // 股票池\n      stockPool: common_stockPool,\n      addRule_preVal: new Array(10),\n      addRule_limitVal: new Array(10),\n      addRule_actionValue: 1,\n      //显示规则，不同的风控规则显示不同的内容\n      displayRules: displayRules,\n      curDisplayRule: {},\n      //实际规则，包含很多种类型\n      rules: [],\n      // 当前选中类型下的规则，由rules和selected得到，只是为了减少计算量\n      curRules: [],\n    }\n  },\n  created(){\n    // $(document).on('keydown', '.rules_input>input', function (e) {\n    //   if (8 == e.keyCode) {\n    //     return;\n    //   }\n    //   if (/\\S/.test(e.key)) {\n    //     if (/^\\d+\\.?\\d{0,3}$/.test($(this).val() + e.key)) {\n    //       return true;\n    //     }\n    //     return false;\n    //   }\n    //   return false;\n    // });\n  },\n  methods: {\n    checkKeyDown: function(e, reg, value){\n      if (8 == e.keyCode) {\n        return;\n      }\n\n      if (/\\S/.test(e.key)) {\n        if (reg.test(value + e.key)) {\n          // value = value + e.key;\n          return true;\n        }\n        e.preventDefault();\n        return false;\n      }\n      e.preventDefault();\n      return false;\n    },\n    checkSubmitDisabled: function(){\n      let that = this;\n      var pre_val_arr = this.addRule_preVal.filter(function(e){\n        return e != undefined;\n      });\n      var pre_val = pre_val_arr.join(',');\n      var limit_val_arr = this.addRule_limitVal.filter(function(e){\n        return e != undefined;\n      });\n      var limit_val = limit_val_arr.join(',');\n      var status = true;\n      if (pre_val_arr.length < this.curDisplayRule.pre_val.length || limit_val_arr.length < this.curDisplayRule.limit_val.length) {\n        status = false;\n      }\n      pre_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      });\n      limit_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      })\n      return !status;\n    },\n    showRuleType: function(type){\n      let str = '';\n      this.displayRules.forEach(function(e){\n        if (e.type == type) {\n          str = e.name;\n        }\n      });\n      return str;\n    },\n    showProductName: function(id){\n      let name = '';\n      this.products.forEach(function(e){\n        if (e.value == id) {\n          name = e.label;\n        }\n      });\n      return name;\n    },\n    getOptions: function(v){\n      var rtn = [];\n      v.forEach(function(e){\n        rtn.push({\n          id: e.type,\n          text: e.name\n        });\n      });\n      return rtn;\n    },\n    getStockOptions: function(v){\n      var rtn = [];\n      v.forEach(function(e){\n        rtn.push({\n          id: e.id,\n          text: e.pool_name\n        });\n      });\n      return rtn;\n    },\n    getDisplayRulesData: function(){\n      return this.curDisplayRule;\n      // var rtn = {};\n      // var selected = this.selected;\n      // this.displayRules.forEach(function(e){\n      //   if (selected == e.type) {\n      //     rtn = e;\n      //   }\n      // });\n      // return rtn;\n    },\n    showStockPool: function(){\n      allStockIdArr = [];\n      var html = `\n      <div class=\"custom-stock-pool\">\n        <div class=\"custom-stock-pool-add\">\n          <div class=\"stock-input\">\n            <input class=\"custom-stock-pool-input\" placeHolder=\"请输入证券代码或名称\" />\n            <ul class=\"custom-stock-suggest\">\n            </ul>\n            <span class=\"custom-stock-suggested\"></span>\n          </div>\n          <span class=\"custom-stock-add\" style=\"display:none;\">添加</span>\n        </div>\n        <div class=\"custom-stock-pool-display\">\n          <ul style=\"height: 170px; display: block; overflow-y: scroll; overflow-x: hidden;\">\n\n          </ul>\n          <div class=\"stock-empty\">\n            <a><i></i>清空选择</a>\n          </div>\n        </div>\n        <div class=\"custom-stock-pool-info\">\n          <input class=\"custom-stock-pool-name\" maxlength=\"20\" placeholder=\"请输入新建股票池名称(不得超过20个字)\" />\n          <span class=\"error-tip hidden\"></span>\n        </div>\n        <div class=\"custom-stock-pool-btn\">\n          <a class=\"ui-btn btn-save\">确定</a>\n        </div>\n      </div>\n      `;\n      jc = $.confirm({\n        title: '自定义股票池',\n        boxWidth: '680px',\n        content: html,\n        closeIcon: true,\n        columnClass: 'custom-stockpool-width',\n        confirmButton: false,\n        cancelButton: false\n      });\n    },\n    setTypeJunior: function(){\n      this.isNormal = true;\n    },\n    setTypeSenior: function(){\n      this.isNormal = false;\n    },\n    getStockPoolByCode: function(i){\n      var rtn = '';\n      this.stockPool.forEach(function(e){\n        if (parseInt(e.id) == parseInt(i)) {\n          rtn = e.pool_name;\n        }\n      });\n      return rtn;\n    },\n    getRulesDisplayByValue: function(pre_rule, value){\n      var rtn = '';\n      pre_rule.options.forEach(e => {\n        if (e.value == value) {\n          rtn = e.label;\n        }\n      })\n      return rtn;\n    },\n    getStockPool: function(){\n      getStockPool();\n    },\n    doCustom: function(){\n      // 无用\n    },\n    checkSelected: function(i){\n      return this.selected == i;\n    },\n    chgCurDisplayRuleByNum: function(i){\n      // 修改当前显示规则模版\n      var rtn = {};\n      var selected = i;\n      this.displayRules.forEach(function(e){\n        if (selected == e.type) {\n          rtn = e;\n        }\n      });\n      this.curDisplayRule = rtn;\n\n      // 修改下发值记录默认值\n      this.addRule_preVal = new Array(10);\n      this.addRule_limitVal = new Array(10);\n      this.addRule_actionValue = 1;\n\n      let _this = this;\n      this.curDisplayRule.pre_val.forEach(function(e, index){\n        // _this.addRule_preVal[index] = e.value;\n        _this.addRule_preVal.splice(index, 1, e.value);\n      });\n\n      this.curDisplayRule.limit_val.forEach(function(e, index){\n        // _this.addRule_limitVal[index] = e.value;\n        _this.addRule_limitVal.splice(index, 1, e.value);\n      });\n    },\n    setSelected: function(i){\n      this.selected = i;\n      if ('true' == localStorage.getItem('user_id_' + window.LOGIN_INFO.user_id + '.rules_displayed_' + i)) {\n        this.showDescription = false;\n      } else {\n        localStorage.setItem('user_id_' + window.LOGIN_INFO.user_id + '.rules_displayed_' + i, 'true');\n        this.showDescription = true;\n      }\n      this.chgCurDisplayRuleByNum(i);\n      this.chgCurRulesByNum(i);\n      this.$forceUpdate();\n    },\n    getDisplayRulesNum: function(type){\n      var rtn = 0;\n      this.in_selected_risk.forEach(function(e){\n        if (type == e.risk_type) {\n          rtn++;\n        }\n      });\n      return rtn;\n    },\n    changeDescription: function(){\n      this.showDescription = !this.showDescription;\n      return this.showDescription;\n    },\n    chgCurRulesByNum: function(i){\n      let that = this;\n      var tmpArr = [];\n      Object.keys(that.rules).forEach(function(e){\n        Object.values(that.rules[e]).forEach(function(el){\n          if (el.risk_type == i) {\n            tmpArr.push(el);\n          }\n        })\n      });\n      this.curRules = tmpArr;\n    },\n    rule_add: function(){\n      let that = this;\n      let _this = this;\n      if (this.checkSubmitDisabled()) {\n        return false;\n      }\n      var pre_val_arr = this.addRule_preVal.filter(function(e){\n        return e != undefined;\n      });\n      var pre_val = pre_val_arr.join(',');\n      var limit_val_arr = this.addRule_limitVal.filter(function(e){\n        return e != undefined;\n      });\n      var limit_val = limit_val_arr.join(',');\n      var status = true;\n      if (pre_val_arr.length < this.curDisplayRule.pre_val.length || limit_val_arr.length < this.curDisplayRule.limit_val.length) {\n        status = false;\n      }\n      pre_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      });\n      limit_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,4})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      })\n      // // 针对禁买股票池的特殊处理\n      // if (1 == this.curDisplayRule.type && false == status) {\n      //   $.omsAlert('请选择股票池');\n      //   return;\n      // }\n      // if (false == status) {\n      //   $.omsAlert('请输入正确的数字');\n      //   return;\n      // }\n      $.startLoading();\n      $.ajax({\n        url: '/rms-pub/rule/add',\n        type: 'post',\n        data: {\n          product_id: this.independent_selected.join(','),\n          risk_type: this.curDisplayRule.type,\n          pre_val: pre_val,\n          limit_val: limit_val || '-1',\n          limit_action: this.addRule_actionValue\n        },\n        success: function({code, msg, data}){\n          $.clearLoading()\n          if (0 == code) {\n            riskVue.getList();\n\n            // $('.junior_rules label.selected').click();\n            $.omsAlert('添加成功');\n            // productRules.setSelected(productRules.selected);\n\n            _this.setSelected(_this.selected)\n            // let oldSelected = _this.selected;\n            // _this.selected = 0;\n            // _this.$nextTick(function(){\n            //   _this.selected = oldSelected;\n            // })\n            // _this.addRule_preVal = new Array(10)\n            // _this.addRule_limitVal = new Array(10)\n            // _this.addRule_actionValue = 1\n          }else{\n            $.omsAlert(msg);\n          }\n        },\n        error: function(){\n          $.clearLoading()\n          $.omsAlert('网络异常')\n        }\n      })\n    }\n  },\n\n});\n\nVue.component('vue-combined-addrisk',{\n  props:['independent_selected', 'display_rules_arr', 'products', 'in_selected_risk'],//productId list\n  template:`\n    <div class=\"risk_rules\" id=\"risk_rules\">\n      <div class=\"junior_rules\">\n        <ul>\n          <template v-for=\"display_type in display_rules_arr\">\n            <li v-if=\"display_type == display.type\" v-for=\"(display, i) in displayRules\" v-on:mouseup=\"setSelected(display.type)\">\n               <label :class=\"[{selected: checkSelected(display.type)}]\">\n                   <span class=\"rules_name\">{{display.name}}</span>\n                   <input class=\"rules_selected\" name=\"rules_selected\" type=\"radio\" />\n                   <span class=\"rules_status\">已设置：{{ getDisplayRulesNum(display.type) }}条</span>\n               </label>\n            </li>\n          </template>\n        </ul>\n        <template v-if=\"0 >= selected\">\n          <p class=\"empty-text\">\n             请先选择风控类别\n          </p>\n        </template>\n        <template v-else>\n          <div class=\"rules_describe\">\n            <div class=\"rules_describe_title\" :class=\"[{displayed: showDescription}]\">\n              <span class=\"rules_describe_span\">风控规则说明</span>\n              <span class=\"rules_describe_display\" v-on:click=\"changeDescription\">{{showDescription?'收起':'展开'}}<i></i></span>\n            </div>\n\n            <vue-risk-description :cur_display_rule=\"curDisplayRule\" class=\"rules_describe_content\" :class=\"[{displayed: showDescription}]\"></vue-risk-description>\n          </div>\n\n          <div class=\"rules_add\" style=\"display: block;\">\n            <!-- 新增规则选择 -->\n            <template v-for=\"(val, index) in curDisplayRule.pre_val\">\n              <label>{{val.name}}\n                <template v-if=\"'input' == val.type\">\n                  <div class=\"rules_input\">\n                    <span v-text=\"val.operator\"></span>\n                    <input :placeholder=\"val.placeHolder\" type=\"text\" :value=\"val.value\" v-model=\"addRule_preVal[index]\" @keydown=\"checkKeyDown($event, val.inputReg, addRule_preVal[index]);return false;\" />\n                    <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                  </div>\n                </template>\n                <template v-if=\"'select' == val.type\">\n                  <div class=\"rules_select\">\n                    <selectize-stock-pool :options=\"stockPool\" v-model=\"addRule_preVal[index]\" v-on:show_stock_pool=\"showStockPool\" >\n                    </selectize-stock-pool>\n                  </div>\n                </template>\n                <template v-if=\"'select2' == val.type\">\n                  <select style=\"font-size: 12px;\" :value=\"val.value\" v-model=\"addRule_preVal[index]\">\n                    <option v-for=\"option in val.options\" v-text=\"option.label\" :value=\"option.value\"></option>\n                  </select>\n                </template>\n              </label>\n            </template>\n            <template v-for=\"(val, index) in curDisplayRule.limit_val\">\n              <label>{{val.name}}\n                <template v-if=\"'input' == val.type\">\n                  <div class=\"rules_input\">\n                    <span v-text=\"val.operator\"></span>\n                    <input type=\"text\" :placeholder=\"val.placeHolder\" :value=\"val.value\" v-model=\"addRule_limitVal[index]\" @keydown=\"checkKeyDown($event, val.inputReg, addRule_limitVal[index]);return false;\" />\n                    <span class=\"rules_input_unit\" v-text=\"val.unit\"></span>\n                  </div>\n                </template>\n                <template v-if=\"'select' == val.type\">\n                  <select :value=\"val.value\" v-model=\"addRule_limitVal[index]\">\n                    <option v-if=\"val.required\" disabled=\"disabled\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                    <option v-if=\"!val.required\" value=\"default\" v-text=\"val.placeHolder\"></option>\n                    <option v-for=\"(v, i) in stockPool\" v-text=\"v.pool_name\" :value=\"v.id\"></option>\n                  </select>\n                </template>\n              </label>\n            </template>\n            <label v-if=\"curDisplayRule.hideAction !== true\">{{curDisplayRule.limit_actionInfo.name}}\n              <!-- <select2 :options=\"getOptions(curDisplayRule.limit_action)\" v-model=\"addRule_actionValue\">\n                <option v-if=\"curDisplayRule.limit_actionInfo.required\" disabled=\"disabled\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n                <option v-if=\"!curDisplayRule.limit_actionInfo.required\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n              </select2> -->\n              <select :value=\"addRule_actionValue\" v-model=\"addRule_actionValue\">\n                <option v-if=\"curDisplayRule.limit_actionInfo.required\" disabled=\"disabled\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n                <option v-if=\"!curDisplayRule.limit_actionInfo.required\" value=\"default\" v-text=\"curDisplayRule.limit_actionInfo.placeHolder\"></option>\n                <!-- <template> -->\n                <option v-for=\"(val, index) in curDisplayRule.limit_action\" v-text=\"val.name\" :value=\"val.type\"></option>\n                <!-- </template> -->\n               </select>\n             </label>\n          </div>\n\n          <h3 class=\"vue-common-title\" style=\"margin-left: 30px; margin-top: 30px;\">新增风控预览</h3>\n          <div class=\"rules_added\" style=\"min-height: initial;padding: 0;\">\n            <table class=\"newweb-common-grid\">\n              <thead>\n                <tr>\n                  <th class=\"left20 width250\">交易单元</th>\n                  <th class=\"left20 width250\">风控类别</th>\n                  <th class=\"left20\">风控规则</th>\n                  <th></th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"product in independent_selected\">\n                  <td class=\"left20 width250\" style=\"text-overflow: ellipsis;overflow: hidden;white-space: nowrap;\">{{showProductName(product)}}</td>\n                  <td class=\"left20 width250\">{{showRuleType(curDisplayRule.type)}}</td>\n                  <td class=\"left20\">\n                    <div class=\"risk_details_text\">\n                      <template v-if=\"undefined !== addRule_preVal[index]\" v-for=\"(val, index) in curDisplayRule.pre_val\">\n                        <span v-if=\"curDisplayRule.hideAction !== true\" v-text=\"val.name\"></span>\n                        <template v-if=\"'input' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"val.operator + ' ' + addRule_preVal[index] + val.unit\"></span>\n                          <span>，</span>\n                        </template>\n                        <template v-if=\"'select' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"getStockPoolByCode(addRule_preVal[index])\"></span>\n                          <span v-if=\"curDisplayRule.hideAction !== true\">，</span>\n                        </template>\n                        <template v-if=\"'select2' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"getRulesDisplayByValue(val, addRule_preVal[index])\"></span>\n                          <span v-if=\"curDisplayRule.hideAction !== true\">，</span>\n                        </template>\n                      </template>\n                      <template v-if=\"undefined !== addRule_limitVal[index]\" v-for=\"(val, index) in curDisplayRule.limit_val\">\n                        <span v-text=\"val.name\"></span>\n                        <template v-if=\"'input' == val.type\">\n                            <span style=\"color: #2196F3;\" v-text=\"val.operator + ' ' + addRule_limitVal[index] + val.unit\"></span>\n                            <span>，</span>\n                        </template>\n                        <template v-if=\"'select' == val.type\">\n                          <span style=\"color: #2196F3;\" v-text=\"rule.limit_val[addRule_limitVal[index]]\"></span>\n                          <span>，</span>\n                        </template>\n                      </template>\n                      <template v-if=\"'' !== addRule_actionValue\">\n                        <template v-if=\"curDisplayRule.hideAction !== true && false\">\n                          <span>提交指令及委托时</span>\n                          <span>，</span>\n                        </template>\n                        <template v-for=\"(val, index) in curDisplayRule.limit_action\">\n                          <span v-if=\"val.type == addRule_actionValue\" v-text=\"val.name\" style=\"color:#F44336;margin-right: 20px;\"></span>\n                        </template>\n                      </template>\n                      <span style=\"color:#a29e9e;\">（新增规则预览）</span>\n                    </div>\n                  </td>\n                  <td></td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div class=\"rules_btns\" style=\"text-align:right\">\n            <a v-bind:class=\"{'disabled': checkSubmitDisabled()}\" class=\"ui-btn add\" v-on:click=\"rule_add\" style=\"margin-right:45px\">确认添加</a>\n          </div>\n        </template>\n      </div>\n    </div>\n  `,\n  data(){\n    return {\n      isNormal: true,\n      selected: 0,\n      showDescription: true,\n\n      selected: 0,\n      value: 0,\n      options: [\n        { id: 1, text: 'Hello' },\n        { id: 2, text: 'World' }\n      ],\n      // 股票池\n      stockPool: common_stockPool,\n      addRule_preVal: new Array(10),\n      addRule_limitVal: new Array(10),\n      addRule_actionValue: 1,\n      //显示规则，不同的风控规则显示不同的内容\n      displayRules: displayRules,\n      curDisplayRule: {},\n      //实际规则，包含很多种类型\n      rules: [],\n      // 当前选中类型下的规则，由rules和selected得到，只是为了减少计算量\n      curRules: []\n    }\n  },\n  created(){\n    // $(document).on('keydown', '.rules_input>input', function (e) {\n    //   if (8 == e.keyCode) {\n    //     return;\n    //   }\n    //   if (/\\S/.test(e.key)) {\n    //     if (/^\\d+\\.?\\d{0,3}$/.test($(this).val() + e.key)) {\n    //       return true;\n    //     }\n    //     return false;\n    //   }\n    //   return false;\n    // });\n  },\n  methods: {\n    checkKeyDown: function(e, reg, value){\n      if (8 == e.keyCode) {\n        return;\n      }\n\n      if (/\\S/.test(e.key)) {\n        if (reg.test(value + e.key)) {\n          // value = value + e.key;\n          return true;\n        }\n        e.preventDefault();\n        return false;\n      }\n      e.preventDefault();\n      return false;\n    },\n    checkSubmitDisabled: function(){\n      let that = this;\n      var pre_val_arr = this.addRule_preVal.filter(function(e){\n        return e != undefined;\n      });\n      var pre_val = pre_val_arr.join(',');\n      var limit_val_arr = this.addRule_limitVal.filter(function(e){\n        return e != undefined;\n      });\n      var limit_val = limit_val_arr.join(',');\n      var status = true;\n      if (pre_val_arr.length < this.curDisplayRule.pre_val.length || limit_val_arr.length < this.curDisplayRule.limit_val.length) {\n        status = false;\n      }\n      pre_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,3})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      });\n      limit_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,3})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      })\n      return !status;\n    },\n    showRuleType: function(type){\n      let str = '';\n      this.displayRules.forEach(function(e){\n        if (e.type == type) {\n          str = e.name;\n        }\n      });\n      return str;\n    },\n    showProductName: function(id){\n      let name = '';\n      this.products.forEach(function(e){\n        if (e.value == id) {\n          name = e.label;\n        }\n      });\n\n      if ('' == name && -1 == id) {\n        name = '全部交易单元'\n      }\n      return name;\n    },\n    getOptions: function(v){\n      var rtn = [];\n      v.forEach(function(e){\n        rtn.push({\n          id: e.type,\n          text: e.name\n        });\n      });\n      return rtn;\n    },\n    getStockOptions: function(v){\n      var rtn = [];\n      v.forEach(function(e){\n        rtn.push({\n          id: e.id,\n          text: e.pool_name\n        });\n      });\n      return rtn;\n    },\n    getDisplayRulesData: function(){\n      return this.curDisplayRule;\n      // var rtn = {};\n      // var selected = this.selected;\n      // this.displayRules.forEach(function(e){\n      //   if (selected == e.type) {\n      //     rtn = e;\n      //   }\n      // });\n      // return rtn;\n    },\n    showStockPool: function(){\n      allStockIdArr = [];\n      var html = `\n      <div class=\"custom-stock-pool\">\n        <div class=\"custom-stock-pool-add\">\n          <div class=\"stock-input\">\n            <input class=\"custom-stock-pool-input\" placeHolder=\"请输入证券代码或名称\" />\n            <ul class=\"custom-stock-suggest\">\n            </ul>\n            <span class=\"custom-stock-suggested\"></span>\n          </div>\n          <span class=\"custom-stock-add\" style=\"display:none;\">添加</span>\n        </div>\n        <div class=\"custom-stock-pool-display\">\n          <ul style=\"height: 170px; display: block; overflow-y: scroll; overflow-x: hidden;\">\n\n          </ul>\n          <div class=\"stock-empty\">\n            <a><i></i>清空选择</a>\n          </div>\n        </div>\n        <div class=\"custom-stock-pool-info\">\n          <input class=\"custom-stock-pool-name\" maxlength=\"20\" placeholder=\"请输入新建股票池名称(不得超过20个字)\" />\n          <span class=\"error-tip hidden\"></span>\n        </div>\n        <div class=\"custom-stock-pool-btn\">\n          <a class=\"ui-btn btn-save\">确定</a>\n        </div>\n      </div>\n      `;\n      jc = $.confirm({\n        title: '自定义股票池',\n        boxWidth: '680px',\n        content: html,\n        closeIcon: true,\n        columnClass: 'custom-stockpool-width',\n        confirmButton: false,\n        cancelButton: false\n      });\n    },\n    setTypeJunior: function(){\n      this.isNormal = true;\n    },\n    setTypeSenior: function(){\n      this.isNormal = false;\n    },\n    getStockPoolByCode: function(i){\n      var rtn = '';\n      this.stockPool.forEach(function(e){\n        if (parseInt(e.id) == parseInt(i)) {\n          rtn = e.pool_name;\n        }\n      });\n      return rtn;\n    },\n    getRulesDisplayByValue: function(pre_rule, value){\n      var rtn = '';\n      pre_rule.options.forEach(e => {\n        if (e.value == value) {\n          rtn = e.label;\n        }\n      })\n      return rtn;\n    },\n    getStockPool: function(){\n      getStockPool();\n    },\n    doCustom: function(){\n      // 无用\n    },\n    checkSelected: function(i){\n      return this.selected == i;\n    },\n    chgCurDisplayRuleByNum: function(i){\n      // 修改当前显示规则模版\n      var rtn = {};\n      var selected = i;\n      this.displayRules.forEach(function(e){\n        if (selected == e.type) {\n          rtn = e;\n        }\n      });\n      this.curDisplayRule = rtn;\n\n      // 修改下发值记录默认值\n      this.addRule_preVal = new Array(10);\n      this.addRule_limitVal = new Array(10);\n      this.addRule_actionValue = 1;\n\n      let _this = this;\n      this.curDisplayRule.pre_val.forEach(function(e, index){\n        // _this.addRule_preVal[index] = e.value;\n        _this.addRule_preVal.splice(index, 1, e.value);\n      });\n\n      this.curDisplayRule.limit_val.forEach(function(e, index){\n        // _this.addRule_limitVal[index] = e.value;\n        _this.addRule_limitVal.splice(index, 1, e.value);\n      });\n    },\n    setSelected: function(i){\n      this.selected = i;\n      if ('true' == localStorage.getItem('user_id_' + window.LOGIN_INFO.user_id + '.rules_displayed_' + i)) {\n        this.showDescription = false;\n      } else {\n        localStorage.setItem('user_id_' + window.LOGIN_INFO.user_id + '.rules_displayed_' + i, 'true');\n        this.showDescription = true;\n      }\n      this.chgCurDisplayRuleByNum(i);\n      this.chgCurRulesByNum(i);\n      this.$forceUpdate();\n    },\n    getDisplayRulesNum: function(type){\n      var rtn = 0;\n      this.in_selected_risk.forEach(function(e){\n        if (type == e.risk_type) {\n          rtn++;\n        }\n      });\n      return rtn;\n    },\n    changeDescription: function(){\n      this.showDescription = !this.showDescription;\n      return this.showDescription;\n    },\n    chgCurRulesByNum: function(i){\n      let that = this;\n      var tmpArr = [];\n      Object.keys(that.rules).forEach(function(e){\n        Object.values(that.rules[e]).forEach(function(el){\n          if (el.risk_type == i) {\n            tmpArr.push(el);\n          }\n        })\n      });\n      this.curRules = tmpArr;\n    },\n    rule_add: function(){\n      let that = this;\n      if (this.checkSubmitDisabled()) {\n        return false;\n      }\n      var pre_val_arr = this.addRule_preVal.filter(function(e){\n        return e != undefined;\n      });\n      var pre_val = pre_val_arr.join(',');\n      var limit_val_arr = this.addRule_limitVal.filter(function(e){\n        return e != undefined;\n      });\n      var limit_val = limit_val_arr.join(',');\n      var status = true;\n      if (pre_val_arr.length < this.curDisplayRule.pre_val.length || limit_val_arr.length < this.curDisplayRule.limit_val.length) {\n        status = false;\n      }\n      pre_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,3})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      });\n      limit_val_arr.forEach(function(e){\n        if (isNaN(Number(e)) || false == /^\\-?\\d+(\\.\\d{1,3})?$/.test(e) || '' == e) {\n          status = false;\n        }\n      })\n      // // 针对禁买股票池的特殊处理\n      // if (1 == this.curDisplayRule.type && false == status) {\n      //   $.omsAlert('请选择股票池');\n      //   return;\n      // }\n      // if (false == status) {\n      //   $.omsAlert('请输入正确的数字');\n      //   return;\n      // }\n      $.startLoading()\n      $.ajax({\n        url: '/rms-pub/rule/add_co',\n        type: 'post',\n        data: {\n          // product_id: this.productId,\n          risk_type: this.curDisplayRule.type,\n          pre_val: pre_val,\n          limit_val: limit_val || '-1',\n          limit_action: this.addRule_actionValue\n        },\n        success: function({code, msg, data}){\n          $.clearLoading();\n          if (0 == code) {\n            riskVue.getListCo();\n\n            // $('.junior_rules label.selected').click();\n            $.omsAlert('添加成功');\n            // productRules.setSelected(productRules.selected);\n          }else{\n            $.omsAlert(msg);\n          }\n        },\n        error: function(){\n          $.clearLoading();\n          $.omsAlert('网络异常')\n        }\n      })\n    }\n  },\n\n});\n\n\n\n/**\n * 用到的老版本的函数\n */\nfunction GetNameByRiskType(type){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == e.type) {\n      rtn = e.name;\n    }\n  });\n  return rtn;\n};\n\nfunction GetPreVal(type, pre_val){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == Number(e.type)) {\n      e.pre_val.forEach(function(el, index){\n        if ('select' == el.type) {\n          rtn += el.name + '<span style=\"margin-left: 5px;margin-right: 5px;color:#2196F3;\">' + GetPoolNameById(pre_val[index]) + '</span>，';\n        }else if('input' == el.type){\n          rtn += el.name + '<span style=\"margin-left: 5px;margin-right: 5px;color:#2196F3;\">' + (el.operator||'') + pre_val[index] + (el.unit||'') + '</span>，';\n        } else if ('select2' == el.type) {\n          rtn += el.name + '<span style=\"margin-left: 5px;margin-right: 5px;color:#2196F3;\">' + (el.options[index].label||'') + (el.unit||'') + '</span>，';\n        }\n      });\n    }\n  });\n  return rtn;\n}\n\nfunction GetLimitVal(type, limit_val){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == e.type) {\n      e.limit_val.forEach(function(el, index){\n        rtn += el.name + '<span style=\"margin-left: 5px;margin-right: 5px;color:#2196F3;\">' + (el.operator||'') + limit_val[index] + (el.unit||'') + '</span>，';\n      });\n    }\n  });\n  return rtn;\n}\n\n\nfunction GetLimitAction(type, limit_action){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == e.type) {\n      e.limit_action.forEach(function(el){\n        if (el.type == limit_action) {\n          rtn += '<span style=\"color:#F44048\">' + el.name + '</span>';\n        }\n      })\n    }\n  });\n  return rtn;\n}\n\n\nfunction GetPreValType(type, index){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == e.type) {\n      rtn = e.pre_val[index].type;\n    }\n  });\n  return rtn;\n}\n\n\n\nfunction GetLimitValType(type, index){\n  type = Number(type);\n  var rtn = '';\n  displayRules.forEach(function(e){\n    if (type == e.type) {\n      if (e.limit_val[index] == undefined) {\n        rtn = 'select';\n      }else{\n        rtn = e.limit_val[index].type;\n      }\n    }\n  });\n  return rtn;\n}\n\n\nfunction GetPoolNameById(id){\n  var rtn = '';\n  common_stockPool.forEach(function(e){\n    if (Number(e.id) == Number(id)) {\n      rtn = e.pool_name;\n    }\n  });\n\n  return rtn;\n}\n\n\n\n/**\n * 老代码jq部分\n */\nvar validPreVal;\n$(document).on('keydown', '.rules_input>input', function (e) {\n  validPreVal = $(this).val();\n}).on('keyup', '.rules_input>input', function (e) {\n  validPreVal = undefined;\n});\n\n$(document).on('keyup', '.custom-stock-pool-input', function(e){\n  $(this).attr('data-id', '').attr('data-name', '');\n  searchStock($(this));\n});\n$(document).on('focus', '.custom-stock-pool-input', function(e){\n  $('.custom-stock-suggested').hide();\n  var stock_id = $(this).attr('data-id');\n  stock_id && $(this).val(stock_id.match(/\\d*/)[0]);\n\n  searchStock($('.custom-stock-pool-input'));\n}).on('blur', '.custom-stock-pool-input', function(e){\n  // 焦点离开时，如果stock_id以及保存了，那么显示正确的stock_name\n  // 所以，当stock_id不正确时，需要清空stock_id\n  var stock_id = $(this).attr('data-id');\n  var stock_name = $(this).attr('data-name');\n  if ('' != stock_id) {\n    $(this).val(stock_id);\n    $('.custom-stock-suggested').html(stock_name).show();\n  }\n\n}).on('blur', '.stock-input', function(e){\n  // blur与click事件顺序问题，已将click修改为mousedown\n  $('.custom-stock-suggest').slideUp(200);\n});\n$(document).on('mousedown', '.custom-stock-suggest>li', function(){\n  selectOneStock(this);\n\n  var customInput = $('.custom-stock-pool-input')\n  var stock_id = customInput.attr('data-id');\n  var stock_name = customInput.attr('data-name');\n  if ('' == stock_id || '' == stock_name) {\n    return;\n  }\n  customInput.attr('data-id', '').attr('data-name', '').val('');\n  $('.custom-stock-suggested').html('');\n  if (allStockIdArr.some(function(e){\n    return e == stock_id;\n  })) {\n    return;\n  }\n  allStockIdArr.push(stock_id);\n  $('.custom-stock-pool-display>ul').append('<li><span class=\"stock-name\" data-id=\"'+ stock_id +'\">'+ stock_id.match(/\\d*/)[0] + ' &nbsp; ' + stock_name +'</span><span class=\"btn-del\">删除</span></li>');\n});\n$(document).on('click', '.btn-del', function(){\n  var stock_id = $(this).parents('li').find('.stock-name').attr('data-id');\n  allStockIdArr = allStockIdArr.filter(function(e){\n    return e != stock_id;\n  });\n  $(this).parents('li').remove();\n});\n$(document).on('click', '.stock-empty>a', function(){\n  allStockIdArr = [];\n  $('.custom-stock-pool-display>ul').empty();\n});\n\n$(document).on('focus', '.custom-stock-pool-name', function(){\n  $('.custom-stock-pool-info>.error-tip').html('').addClass('hidden');\n});\n\n$(document).on('click', '.btn-save', function(){\n  var stock_id_arr = [];\n  $('.custom-stock-pool-display>ul>li').each(function(index, e){\n    stock_id_arr.push($(e).find('.stock-name').attr('data-id'));\n  });\n  if (0 == stock_id_arr.length) {\n    $('.custom-stock-pool-info>.error-tip').html('请先添加证券').removeClass('hidden');\n    return;\n  }\n\n  var pool_name = $('.custom-stock-pool-name').val();\n  if ('' == pool_name) {\n    $('.custom-stock-pool-info>.error-tip').html('请输入股票池名称').removeClass('hidden');\n    return;\n  }\n  if (pool_name.length > 20) {\n    $('.custom-stock-pool-info>.error-tip').html('股票池名称不得超过20个字').removeClass('hidden');\n    return;\n  }\n\n  $.ajax({\n    url: '/rms-pub/stock_pool/add',\n    type: 'post',\n    data: {\n      stock_id: stock_id_arr.join(','),\n      pool_name: pool_name\n    },\n    success: function({msg, code, data}){\n      if (0 == code) {\n        getStockPool();\n        jc.close();\n        $.omsAlert('自定义股票池成功');\n      }else{\n        $('.custom-stock-pool-info>.error-tip').html(msg).removeClass('hidden');\n      }\n    },\n    error: function(){\n      $.failNotice();\n    }\n  })\n});\n\nfunction searchStock(_this){\n  var inputStockCode = $(_this).val();\n  var last_suggest_timestamp = new Date().valueOf();\n  $('.custom-stock-pool-input').attr('last_suggest_timestamp',last_suggest_timestamp);\n  $('.stock-input').addClass('loading');\n  var str = (window.REQUEST_PREFIX||'')+'/oms/helper/code_genius?stock_code='+inputStockCode;\n  $.getJSON(str).done(function(res){\n    if( last_suggest_timestamp!=$('.custom-stock-pool-input').attr('last_suggest_timestamp') ){return;}\n    if(res.code==0 || res.code==1123124){\n      var html = '';\n      res.data.forEach(function(e){\n        html += '<li data-id=\"' + e.stock_id +'\" data-name=\"'+ e.stock_name +'\">' + e.stock_id + ' &nbsp; ' + e.stock_name + '</li>';\n      });\n      $('.custom-stock-suggest').html(html).slideDown(300);\n\n      // 当只有一个符合条件时，默认选中该项。\n      if(1 == res.code.length){\n        selectOneStock($('.custom-stock-suggest>li'));\n      }\n    }else{\n        $.omsAlert('获取建议证券列表失败！',false,300);\n    }\n  }).always(function(){\n    if( last_suggest_timestamp!=$('.custom-stock-pool-input').attr('last_suggest_timestamp') ){return;}\n    $('.stock-input').removeClass('loading');\n  });\n}\n\nfunction selectOneStock(_this){\n  // 用户选择时，记录正确的stock_id和stock_name\n  var stock_id = $(_this).attr('data-id');\n  var stock_name = $(_this).attr('data-name');\n  $('.custom-stock-pool-input').attr('data-id', stock_id).attr('data-name', stock_name).val(stock_id);\n  $('.custom-stock-suggested').html(stock_name).show();\n  $('.custom-stock-suggest').slideUp(200);\n}\n"]}