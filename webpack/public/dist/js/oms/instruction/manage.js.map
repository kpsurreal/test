{"version":3,"sources":["oms/instruction/manage.js"],"names":["orginfo_theme","window","LOGIN_INFO","org_info","theme","entrust_last_updated_timestamp","tradeFlow","Vue","data","curActive","checkedProductList","stock_id","stock_detail","trade_mode","trade_price","add_ins_method","watch","methods","chgCurActive","val","chgCheckedProduct","arr","checkData","chgStockId","id","tradeControllor","$refs","resetAllNum","shgStockDetail","chgTradeMode","chgTradePrice","chgInsMethod","instructionManagePage","setChecked","setSubmitData","instructionManageData","typeStr","order","order_by","display_rules","type","disabledMapping","hideChildren","label","format","class","preControl","trueClass","falseClass","preShow","subClass","btnId","btnClickFn","productListData","position_query_arr","uri","REQUEST_PREFIX","gridDataStr","withMultiIcon","classFormat","showTotal","component","props","template","title","gridData","positionGrid","product_list","checked_count","totalData","query_arr","loadingNum","computed","curQueryInfo","_this","rtn","forEach","e","activeGridList","ele","web_checked","product","product_id","obj","stock_name","product_name","name","cost_price","latest_price","total_amount","enable_sell_volume","market_value","today_earning","earning","earning_ratio","weight","exchange_text","push","VUECOMPONENT","sort","rtn2","parseFloat","$","trigger","position","chgSort","doRowClick","row","stock","stock_code","direction","doFollow","doTrade","checkShow","do_hide","numeralNumber","arg","num","undefined","str","i","numeral","numeralPercent","signNumeralNumber","noSign","toString","replace","signNumeralPercent","rgColor","middle","displayValue","sub_value","rule","value","Array","Function","args","concat","slice","apply","unit","displayClass","loadOrderList","get","product_ids","res","code","risk_position","last_loading_timestamp","Date","valueOf","loadingStatus","getJSON","done","position_realtime","needRefresh","positions","pullValue","profit_of_today","PRODUCTS","runtime","Object","keys","length","profit_of_today_v2","redeem_fee","manage_fee","other_fee","total_assets","profit_rate_of_day_v2","timestamp","always","mixins","numberMixin","showUnfinished","showFinished","ajax_manage_list","rulesData","showAborted","readyShowList","showManageList","handler","every","disabled","gridHead","deep","beforeMount","loadManageList","checkDisplay","status","multiCancel","ins_id","ajax","url","ins_id_arr","success","msg","omsAlert","error","err","count","ins_status_arr","list","chgAll","event","$nextTick","filter","tmpShowArr","tmpCheckedArr","showChildren","instruction","some","el","gathering","product_name_list","join","deal_direction_name","price","quote_type","price_str","ins_volume","target_position","total_asset_ratio","current_position","current_volume","current_cost_price","progress","created_at","creator_name","fund_manager_name","status_name","operation","sub_list","children","isChild","showProductList","ajax_product_list","extend","net_assets","operator_uid","operator_name","net_value","net_profite","profit_rate","security","balance_amount","enable_cash","ajaxProductList","doCancel","loadList","org_info_theme","curMarket","displayRevertNum","showBoard","hide","show","chgShowBoard","$emit","chgCurMarket","change","click","attr","chgActive","index","omsUpdateLocalJsonData","stock_input_type_id","lockStatus","trade_model","mounted","on","cur_active","ask1_price","bid1_price","common_storage","getItem","user_id","addClass","chgLockStatus","dstValue","setItem","colorMixin","ajaxStockDetail","showTipFlag","tag","volume","ajaxTimes","loadInterval","is_loading","loadData","clearInterval","setInterval","getTipStr","indexCopy","Number","getStyle","showTip","hideTip","priceClick","tmpStockId","commonAjax","then","catch","time","code_000001","code_399001","code_399006","indexs","loadStockIndexs","res_data","index_stock","moment","trading_unit","detail_arr","trade_number_method","buy_or_sell","display_arr","trade_direction","multi_num","allDstPosition","allChgPosition","checkKeyDown","reg","keyCode","test","key","preventDefault","chg_amount","dst_position","chg_position","refreshDisplay","checkSubmitDisabled","flag","riskRtn","showOrHide","multiProductsSubmit","htmlArr","typeStr1","typeStr2","ins_price","stop_top","stop_down","totalAmount","totalMoney","toFixed","html","confirmHtml","is_trade_day","location","search","includes","confirm","content","keyboardEnabled","closeIcon","confirmButton","cancelButton","isLoading","startLoading","product_id_arr","post","quote_price","ignore_tips","checkResults","clearLoading","fail","result","setTimeout","btnType","entrustStatus","style","temp","limit_action","color","contentChild","tableData","entrust_price","status_text","btn_submit","self","$parent","close","btn_cancel","prototype","$confirm","chgMultiNum","chgAllDstPosition","chgAllChgPosition","chgRowDstPosition","chgRowChgPosition","all_market_value","stock_position_num","stock_entrust_num","stock_total_share","total_share_capital","stock_all_position_num","stock_all_entrust_num","stock_entrust_buy_num","stock_entrust_sell_num","stock_all_entrust_buy_num","stock_all_entrust_sell_num","entrust_info","cancel_status","entrust","amount","deal","riskCheck","checkRules","surged_limit","decline_limit","gap_position","Math","max","the_stock_position","floor","ceil","last_price","min","real_position_total_amount","chgRowChgAmount","display_title","leftWidth","wholeWidth","chgMenu","setWidth","intervalMap","Map","loadRiskRulesInfo","Promise","resolve","reject","getRulesData","parseInt","random","loadStockPoolInfo","getStockPoolData","loadFeeRulesInfo","getFeeData","loadInsInfo","loadRuntimeFn","set","unuse_cache","JSON","parse","stringify","call","failNotice","bind","loadRuntimeInfo","loadEntrustFn","loadEntrustInfo","all","last_order_create_nav_index","omsGetLocalJsonData","is","me","css","section_height","section","find","first","navigator","userAgent","container","closest","side_nav","scroll_reable_transition","strategy_scrollbar_full","ghost_section","appendTo","resize","clearTimeout","removeClass","side_nav_status","left","width","side_nav_width","scrollX","tmpWidth","outerWidth","height","last_updated_timestamp","updated_timestamp"],"mappings":"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","file":"manage.js","sourcesContent":["/**\n * 指令管理页面\n * Author: liuzeyafzy@gmail.com\n */\nvar orginfo_theme = window.LOGIN_INFO.org_info.theme;//机构版／专户版枚举值 专户版为3，机构版为非3.\nvar entrust_last_updated_timestamp = 0;\n\n/**\n * 交易流程使用的vue，其不参与页面显示，但他是整个交易流程。//附，使用中发现一个问题，root组件内部不能使用tradeFlow，只有Vue.component定义的组件能够使用\n * 他的数据来自于各个组件的关键数据，他的数据决定了目前处于交易的哪一个步骤，\n *\n */\nvar tradeFlow = new Vue({\n  data: {\n    curActive: '', // single-buy; single-sell\n    // 选中的产品信息\n    checkedProductList: [],\n    // 股票id，示例：“601288.SH”\n    stock_id: '',\n    stock_detail: {},\n    // form_data: {},\n    trade_mode: 1,\n    trade_price: '',\n    add_ins_method: 3,\n  },\n  watch: {\n  },\n  methods: {\n    // Begin: 外部调用，获取提交时需要的数据\n    chgCurActive: function(val){\n      this.curActive = val\n    },\n    chgCheckedProduct: function(arr){\n      this.checkedProductList = arr;\n      this.checkData();\n    },\n    chgStockId: function(id){\n      this.stock_id = id;\n      this.trade_price = '';\n      tradeControllor.$refs['trade-preview'] && tradeControllor.$refs['trade-preview'].resetAllNum()\n      this.checkData();\n    },\n    shgStockDetail: function(val){\n      this.stock_detail = val;\n      this.checkData();\n    },\n    chgTradeMode: function(val){\n      this.trade_mode = val;\n      this.checkData();\n    },\n    chgTradePrice: function(val){\n      this.trade_price = val;\n      this.checkData();\n    },\n    chgInsMethod: function(val){\n      this.add_ins_method = val;\n      this.checkData();\n    },\n    // End: 外部调用，获取提交时需要的数据\n    // Begin: 内部处理\n    // 检查数据是否ok，ok则全部交给\n    checkData: function(){\n      // // TODO 如果数据不足的情况下，进行提示。理解错误，不要进行提示并返回。预览那边就需要得到这些数据。因为数据不足的时候，预览也要这些数据。\n      // if ('' == this.stock_id || 0 == Object.keys(this.stock_detail).length || '' == this.trade_price || 0 == this.checkedProductList.length) {\n      // }\n\n      // 将数据提交给持仓模块\n      instructionManagePage.$refs['product-position'] && instructionManagePage.$refs['product-position'].setChecked({\n        checkedProductList: this.checkedProductList\n      })\n\n      // 将数据提交给预览模块\n      tradeControllor.$refs['trade-preview'] && tradeControllor.$refs['trade-preview'].setSubmitData({\n        checkedProductList: this.checkedProductList,\n        stock_id: this.stock_id,\n        stock_detail: this.stock_detail,\n        // form_data: this.form_data,\n        trade_mode: this.trade_mode,\n        trade_price: this.trade_price,\n        add_ins_method: this.add_ins_method,\n      })\n    },\n    // End: 内部处理\n  }\n});\n\n/**\n * 想要做一个表格单元格，能够支持目前所有的业务类型。后续新增的业务类型(type)可以往里面加。目前支持：\n * text               文本类型，最常见的情形\n * checkbox           多选框类型，常见于表格第一列，不可以给表格的其他部分使用，因为表头单元格对这个checkbox也做了处理（要给其他的列使用，那意思是表头是文字，内容是多选框，请自行添加checkboxV2）\n * percent            百分比类型，支持多参数多颜色显示百分比。\n */\n// 指令管理表格数据\nlet instructionManageData = {\n  typeStr: '',\n  order: '',\n  order_by: '',\n  display_rules: [{\n    type: 'checkbox',\n    id: 'web_checked',\n    disabledMapping: 'disabled',\n    hideChildren: true,\n    label: '',\n    format: '',\n    class: 'left10 width45'\n  },{\n    type: 'text',\n    id: 'stock_id',\n    label: '证券代码',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'stock_name',\n    label: '证券名称',\n    format: '',\n    class: 'left10',\n  },{\n    type: 'text',\n    id: 'product_name',\n    label: 3 == orginfo_theme ? '产品账户' : '交易单元',\n    format: '',\n    class: 'left10',\n    preControl: {\n      id: 'showChildren',\n      class: 'control-btn',\n      trueClass: 'control-btn__hide',\n      falseClass: 'control-btn__display'\n    }\n  },{\n    type: 'text',\n    id: 'fund_manager_name',\n    label: '基金经理',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'deal_direction_name',\n    label: '买卖标记',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'price_str',\n    label: '价格',\n    // format: ['numeralNumber', 3],\n    class: 'right10'\n  },{\n    type: 'text',\n    id: 'ins_volume',\n    label: '指令数量',\n    format: ['numeralNumber', 0],\n    class: 'right10'\n  },{\n    type: 'text',\n    id: 'target_position',\n    label: '目标仓位',\n    format: ['numeralPercent', 2],\n    class: 'right10'\n  },{\n    type: 'text',\n    id: 'total_asset_ratio',\n    label: '总资产比例',\n    format: ['numeralPercent', 2],\n    class: 'right10'\n  },{\n    type: 'text',\n    id: 'latest_price',\n    label: '最新价',\n    format: ['numeralNumber', 3],\n    class: 'right10'\n  },{\n    type: 'text',\n    id: 'current_position',\n    label: '当前持仓',\n    format: ['addParenthese', 'numeralPercent', 2],\n    preShow: {\n      type: 'text',\n      id: 'current_volume',\n      format: ['numeralNumber', 0]\n    },\n    class: 'right10 ',\n    subClass: 'colorYellow'\n  },{\n    type: 'text',\n    id: 'current_cost_price',\n    label: '当前持仓成本',\n    format: ['numeralNumber', 3],\n    class: 'right10'\n  },{\n    type: 'percent',\n    id: 'progress',\n    label: '完成进度',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'creator_name',\n    label: '创建人',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'created_at',\n    label: '创建时间',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'text',\n    id: 'status_name',\n    label: '指令状态',\n    format: '',\n    class: 'left10'\n  },{\n    type: 'btn',\n    id: 'status',\n    label: '操作',\n    format: ['displayStatus'],\n    btnId: 'ins_id',\n    btnClickFn: 'doCancel',\n    class: 'left10 width100'\n  }]\n};\n\nlet productListData = {\n  typeStr: '',\n  order: '',\n  order_by: '',\n  display_rules: [{\n    type: 'checkbox',\n    id: 'web_checked',\n    hideChildren: true,\n    label: '',\n    format: '',\n    class: 'left20 width45'\n  },{\n    type: 'text',\n    id: 'name',\n    label: '全选', // 产品账户\n    format: '',\n    class: 'left20'\n  },{\n    type: 'text',\n    id: 'operator_name',\n    label: '基金经理',\n    format: '',\n    class: 'left20'\n  },{\n    type: 'text',\n    id: 'net_value',\n    label: 3 == orginfo_theme ? '当日净值' : '基金预估净值',\n    format: ['numeralNumber', 4],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'position',\n    label: 3 == orginfo_theme ? '仓位' : '基金预估仓位',\n    format: ['numeralPercent'],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'total_assets',\n    label: 3 == orginfo_theme ? '资产总值' : '基金净资产',\n    format: ['numeralNumber', 2],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'security',\n    label: 3 == orginfo_theme ? '持仓市值' : '交易单元持仓',\n    format: ['numeralNumber', 2],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'balance_amount',\n    label: 3 == orginfo_theme ? '资金余额' : '交易单元余额',\n    format: ['numeralNumber', 2],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'enable_cash',\n    label: 3 == orginfo_theme ? '可用资金' : '交易单元可用',\n    format: ['numeralNumber', 2],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'net_profite',\n    label: 3 == orginfo_theme ? '总盈亏' : '交易单元盈亏',\n    format: ['numeralNumber', 2],\n    class: 'right20'\n  },{\n    type: 'text',\n    id: 'profit_rate',\n    label: 3 == orginfo_theme ? '总盈亏率' : '交易单元盈亏率',\n    format: ['numeralPercent'],\n    class: 'right20'\n  }]\n};\n\nvar position_query_arr = [{\n  id: 'position',\n  uri: window.REQUEST_PREFIX + '/oms/api/multi_position_realtime',\n  order: '',\n  order_by: '',\n  gridDataStr: 'positionGrid',\n  display_rules: [{\n    id: 'stock_id',\n    label: '证券代码',\n    withMultiIcon: true,\n    format: '',\n    class: ''\n  },{\n    id: 'stock_name',\n    label: '证券名称',\n    format: '',\n    class: 'cell-left'\n  },{\n    id: 'product_name',\n    label: 3 == orginfo_theme ? '持仓策略' : '持仓交易单元',\n    format: '',\n    class: 'cell-left'\n  },{\n    id: 'cost_price',\n    label: '成本价',\n    format: ['numeralNumber', 3],\n    class: 'cell-right'\n  },{\n    id: 'latest_price',\n    label: '最新价',\n    format: ['numeralNumber', 3],\n    classFormat: ['rgColor', 'earning'],\n    class: 'cell-right'\n  },{\n    id: 'total_amount',\n    label: '持仓数量',\n    format: ['numeralNumber', 0],\n    class: 'cell-right'\n  },{\n    id: 'enable_sell_volume',\n    label: '可卖数量',\n    format: ['numeralNumber', 0],\n    class: 'cell-right'\n  },{\n    id: 'market_value',\n    label: '市值',\n    format: ['numeralNumber', 2],\n    showTotal: true,\n    classFormat: ['rgColor', 'earning'],\n    class: 'cell-right'\n  },{\n  //   id: 'today_earning',\n  //   label: '当日盈亏',\n  //   format: ['signNumeralNumber', 2],\n  //   classFormat: ['rgColor', 'earning'],\n  //   class: 'cell-right'\n  // },{\n    id: 'earning',\n    label: '浮动盈亏',\n    format: ['signNumeralNumber', 2],\n    showTotal: true,\n    classFormat: ['rgColor', 'earning'],\n    class: 'cell-right'\n  },{\n    id: 'earning_ratio',\n    label: '浮盈率',\n    format: ['signNumeralPercent', 2],\n    classFormat: ['rgColor', 'earning_ratio'],\n    class: 'cell-right'\n  },{\n    id: 'weight',\n    label: '所占仓位',\n    showTotal: true,\n    format: ['numeralPercent', 2],\n    class: 'cell-right'\n  // },{\n  //   id: 'exchange_text',\n  //   label: '交易市场',\n  //   format: '',\n  //   hide_flag: 3 == orginfo_theme ? true : false,\n  //   class: 'cell-right'\n  }]\n}];\n\n//当前持仓\nVue.component('vue-product-position', {\n  props: [],\n  template: `\n    <section class=\"order-list new-design\">\n      <a id=\"anchor-position\" style=\"position: relative;top:-65px;display: block;height: 0;width:0;\"></a>\n      <div class=\"hd\">\n        <span class=\"section-title\">当前持仓</span>\n\n        <a class=\"oms-btn gray refresh-btn loading-loading right\" v-bind:class=\"{'loading': loadingNum > 0}\" href=\"javascript:;\" v-on:click=\"loadOrderList\"><i class=\"oms-icon refresh\"></i>刷新</a>\n        <span v-if=\"1 == checked_count\" class=\"right\" style=\"font-size:16px;font-weight:600;color:#000;\">\n          当前仓位\n          <span style=\"padding-left: 5px;\" v-text=\"numeralPercent(totalData.weight)\"></span>\n        </span>\n      </div>\n      <table class=\"oms-table loading-loading nothing-nothing\" v-bind:class=\"{'nothing': activeGridList.length == 0}\">\n        <tbody>\n          <tr>\n            <th v-if=\"rule.hide_flag != true\" v-for=\"rule in curQueryInfo.display_rules\" v-bind:class=\"rule.class\">\n              <span v-text=\"rule.label\"></span>\n              <a class=\"icon-sortBy\" v-on:click=\"chgSort(rule.id)\">\n                <i class=\"icon-asc\" :class=\"{active: (order_by == rule.id && order == 'asc')}\"></i>\n                <i class=\"icon-desc\" :class=\"{active: (order_by == rule.id && order == 'desc')}\"></i>\n              </a>\n            </th>\n          </tr>\n        </tbody>\n        <tbody>\n          <tr v-for=\"row in activeGridList\" v-show=\"checkShow(row)\" v-bind:class=\"{'sub_order': row.is_sub, 'display_multi': row.web_showChildren}\">\n            <td @click=\"doRowClick(row)\" v-if=\"rule.hide_flag != true\" v-for=\"rule in curQueryInfo.display_rules\" v-bind:class=\"rule.class\">\n              <span v-bind:class=\"displayClass(row, rule)\" v-text=\"displayValue(row, rule)\"></span>\n            </td>\n          </tr>\n          <tr v-if=\"1 == checked_count\">\n            <td v-bind:class=\"rule.class\" v-if=\"rule.hide_flag != true\" v-for=\"(rule, index) in curQueryInfo.display_rules\">\n              <span v-if=\"0 == index\" style=\"color: #999;\">当前持仓汇总</span>\n              <span v-if=\"rule.showTotal\" v-bind:class=\"displayClass(totalData, rule)\" v-text=\"displayValue(totalData, rule)\"></span>\n            </td>\n            <td class=\"cell-right\">\n\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </section>\n  `,\n  data: function () {\n    return {\n      title: '当前持仓',\n      // rulesData: positionData,\n      // gridHead: {\n      //   web_checked: false\n      // },\n      // showProductList: []\n\n      order: '',\n      order_by: '',\n      gridData: [],\n      curActive: 'position',\n\n      orginfo_theme: 1, //机构版\n\n      positionGrid: [],\n      product_list: [],\n      checked_count: 0,\n      totalData: [],\n\n      query_arr: position_query_arr,\n      loadingNum: 0\n    }\n  },\n  computed: {\n    curQueryInfo: function(){\n      var _this = this;\n      var rtn = {};\n      this.query_arr.forEach(function(e){\n        if (e.id == _this.curActive) {\n          rtn = e;\n        }\n      });\n      return rtn;\n    },\n    activeGridList: function(){\n      let _this = this;\n      var rtn = [];\n      // return [];\n\n      this.product_list.forEach(function(ele){\n        if (true == ele.web_checked) {\n          _this['positionGrid'] && _this['positionGrid'].forEach(function(e){\n            if (e.product.id == ele.product_id){\n              var obj = {};\n\n              // 证券名称\n              obj.stock_id = e.stock_id;\n              // 证券代码\n              obj.stock_name = e.stock_name;\n              // 持仓策略\n              obj.product_name = e.product ? e.product.name : '';\n              // 成本价\n              obj.cost_price = e.cost_price;\n              // 最新价\n              obj.latest_price = e.latest_price;\n              // 持仓数量\n              obj.total_amount = e.total_amount;\n              // 可卖数量\n              obj.enable_sell_volume = e.enable_sell_volume;\n              // 市值\n              obj.market_value = e.market_value;\n              // 当日盈亏\n              obj.today_earning = e.today_earning;\n              // 浮动盈亏\n              obj.earning = e.earning;\n              // 浮盈率\n              obj.earning_ratio = e.earning_ratio;\n              // 所占仓位\n              obj.weight = e.weight;\n              // 证券市场\n              obj.exchange_text = e.exchange_text\n\n              rtn.push(obj);\n            }\n          });\n        }\n      });\n\n      // 步骤2，根据排序逻辑进行排序\n      rtn = VUECOMPONENT.sort(rtn, _this.order, _this.order_by);\n\n      var rtn2 = {};\n      rtn2.market_value = 0;\n      rtn2.earning = 0;\n      rtn2.weight = 0;\n      if (1 == this.checked_count) {\n        rtn.forEach(function(e){\n          rtn2.market_value += parseFloat(e.market_value);\n          rtn2.earning += parseFloat(e.earning);\n          rtn2.weight += parseFloat(e.weight);\n        })\n      }\n      this.totalData = rtn2;\n\n      $(window).trigger({type:'product:position:updated',position:rtn});\n\n      return rtn;\n    }\n  },\n  methods: {\n    setChecked: function(obj){\n      this.product_list = obj.checkedProductList;\n    },\n    chgSort: function(id){\n      if (id == this.order_by) {\n        if (this.order == 'asc') {\n          this.order = 'desc';\n        }else if(this.order == 'desc'){\n          this.order = '';\n        }else{\n          this.order = 'asc'\n        }\n      }else{\n        this.order_by = id;\n        this.order = 'asc';\n      }\n      // // 用户切换排序命令，需要保存新的排序\n      // let obj = {};\n      // obj.field_sort = this.display_rules.map(function(e){\n      //   return e.id\n      // });\n      // obj.order_by = this.order_by;\n      // obj.order = this.order;\n\n      // this.$emit('order', {order: this.order,\n      //   order_by: this.order_by,\n      //   typeStr: this.typeStr,\n      //   display_rules: this.display_rules\n      // });\n      // common_storage.setItem(this.typeStr, obj);\n    },\n    // 行点击\n    doRowClick: function(row){\n      $(window).trigger({\n        type:'order_create:by_stock',\n        stock:{\n          stock_code: row.stock_id,\n          stock_name: row.stock_name,\n          direction: 'sell'\n        }\n      });\n    },\n    // 添加自选股\n    doFollow: function(row){\n      $(window).trigger({\n        type: 'stock:add_follow',\n        stock: row\n      });\n    },\n    // 买入卖出按钮\n    doTrade: function(row, direction){\n      $(window).trigger({\n        type:'order_create:by_stock',\n        stock:{\n          stock_code: row.stock_id,\n          stock_name: row.stock_name,\n          direction: direction\n        }\n      });\n    },\n    checkShow: function(row){\n      if (row.do_hide) {\n        return false;\n      }\n\n      return true;\n    },\n    numeralNumber: function(arg, num){\n      if ('--' == arg || '' === arg || undefined == arg) {\n        return '--'\n      }\n      if (undefined != num) {\n        var str = '0.'\n        for (let i = num - 1; i >= 0; i--) {\n          str += '0';\n        }\n        if(0 == num){\n          str = '0';\n        }\n        return numeral(arg).format( '0,' + str );\n      }\n      return numeral(arg).format( '0,0.00' );\n    },\n    numeralPercent: function(arg){\n      return numeral(arg).format( '0.00%' );\n    },\n    signNumeralNumber: function(arg, num){\n      if('-' == arg || '--' == arg){\n        return arg;\n      }\n\n      var noSign = +(arg||0).toString().replace(/^(\\-|\\+)/,'');\n      return (arg<0 ? '-' : '+') + this.numeralNumber(noSign, num);\n    },\n    signNumeralPercent: function(arg, num){\n      if('-' == arg || '--' == arg){\n        return arg;\n      }\n\n      var noSign = +(arg||0).toString().replace(/^(\\-|\\+)/,'');\n      return (arg<0 ? '-' : '+') + this.numeralPercent(noSign, num);\n    },\n    // row是行数据，name是比较的那个属性名，middle是比较的标尺数据，默认为0\n    rgColor: function(row, name, middle){\n      var num = row[name];\n      return num<(middle||0) ? 'green' : 'red';\n    },\n    displayValue: function(sub_value, rule){\n      var value = sub_value[rule.id];\n      if ((rule.format != '') && (rule.format instanceof Array) && (this[rule.format[0]] instanceof Function)) {\n        // value = this[rule.format].call(this, value, )\n        var args = [value].concat(rule.format.slice(1))\n        value = this[rule.format[0]].apply(this, args);\n\n      }\n      if (rule.unit) {\n        return value + rule.unit;\n      }else{\n        return value;\n      }\n    },\n    displayClass: function(sub_value, rule){\n      // 注意这里是把sub_value整个传给了函数处理\n      var value = sub_value;\n      var rtn = '';\n      if ((rule.classFormat != '') && (rule.classFormat instanceof Array) && (this[rule.classFormat[0]] instanceof Function)) {\n        // value = this[rule.classFormat].call(this, value, )\n        var args = [value].concat(rule.classFormat.slice(1))\n        rtn = this[rule.classFormat[0]].apply(this, args);\n      }\n      return rtn;\n    },\n    // 读取三个接口的数据\n    loadOrderList: function(){\n      let _this = this;\n\n      //######################### 风控增补数据 risk_check js 用到 ########################\n      $.get((window.REQUEST_PREFIX||'')+'/oms/helper/risk_position',{product_id:product_ids}, function(res){\n        if (0 == res.code) {\n          window.risk_position = res.data;\n        }\n      });\n      //######################### 风控增补数据 risk_check js 用到 ########################\n\n      if (0 != this.loadingNum) {\n        return;\n      }\n\n      // this.last_loading_timestamp = new Date().valueOf();\n      this.query_arr.forEach(function(e){\n        var last_loading_timestamp = new Date().valueOf();\n        _this[e.gridDataStr].last_loading_timestamp = last_loading_timestamp;\n\n        _this[e.gridDataStr].loadingStatus = 'loading';\n        _this.loadingNum += 1;\n        $.getJSON(e.uri, {product_id: product_ids}).done(function(res){\n          if( _this[e.gridDataStr].last_loading_timestamp != last_loading_timestamp ){return;}\n\n          if(res.code==0){\n            // window.position_realtime = res.data;\n            var position_realtime = [];\n\n            var needRefresh = false;\n            product_list.forEach(function(product){\n              var id = product.id;\n              var positions = $.pullValue(res,'data.'+id+'.data',[]);\n\n              // product.position_realtime = positions;\n              positions.forEach(function(position){\n                  position.product = product;\n              });\n\n              // id是组合id，positions是实时持仓数据 在此计算出“今日盈亏”和“今日盈亏率”修改到window.PRODUCTS 的对应组合的runtime中\n              // product.today_earning;\n              var profit_of_today = 0;\n              positions.forEach(function(position){\n                  profit_of_today += position.today_earning;\n              });\n              window.PRODUCTS.forEach(function(e){\n                if (e.id == id) {\n                  if (e.runtime && Object.keys(e.runtime).length > 0) {\n                    needRefresh = true;\n                    var profit_of_today_v2 = profit_of_today - e.runtime.redeem_fee - e.runtime.manage_fee - e.runtime.other_fee;\n                    e.runtime.profit_of_today_v2 = profit_of_today_v2;\n                    if (0 == e.runtime.total_assets) {\n                      e.runtime.profit_rate_of_day_v2 = 0;\n                    }else{\n                      e.runtime.profit_rate_of_day_v2 = profit_of_today_v2 / e.runtime.total_assets;\n                    }\n                  }\n                }\n              });\n\n              position_realtime.push.apply(position_realtime,positions);\n            });\n            if (needRefresh == true) {\n              $(window).trigger({\n                type: 'position:runtime:refresh'\n              });\n            }\n\n            window.position_realtime = position_realtime;\n\n            _this[e.gridDataStr] = position_realtime;\n            _this[e.gridDataStr]['list_num'] = position_realtime.length;\n            _this[e.gridDataStr]['last_updated_timestamp'] = res.timestamp;\n            // _this.getGridList(e.gridDataStr);\n          }else{\n            _this[e.gridDataStr] = [];\n            _this[e.gridDataStr]['list_num'] = 0;\n            // _this.getGridList(e.gridDataStr);\n          }\n        }).always(function(){\n          _this.loadingNum -= 1;\n          _this[e.gridDataStr].loadingStatus = '';\n        });\n      });\n\n\n    }\n  }\n})\n\n// 指令管理表格\nVue.component('vue-instruction-manage', {\n  mixins: [numberMixin],\n  template: `\n    <div class=\"instruction-manage\">\n      <div class=\"instruction-manage__header\" style=\"padding: 10px 30px 10px;display: flex;\">\n        <h2 style=\"display: inline-block;margin-right: 20px;\">{{title}}</h2>\n        <label style=\"padding-top: 5px;margin-right:8px;\"><input type=\"checkbox\" v-model=\"showUnfinished\" />未完成指令</label>\n        <label style=\"padding-top: 5px;margin-right:8px;\"><input type=\"checkbox\" v-model=\"showFinished\" />已结束指令</label>\n        <div style=\"flex:1\"></div>\n        <a @click=\"multiCancel()\" class=\"bem-ui-btn\" style=\"height: 32px;line-height: 32px;padding-top: 0;padding-bottom: 0;width: 80px;margin-right:20px;\">一键撤销</a>\n        <a @click=\"loadManageList()\" class=\"bem-ui-btn bem-ui-btn__refresh-btn\" v-bind:class=\"{'loading': 'loading' == loadingStatus}\"><i></i>刷新</a>\n      </div>\n      <table class=\"instruction-manage__body newweb-common-grid oms-nothing-table\" v-bind:class=\"{'nothing': showManageList.length == 0}\">\n        <thead>\n          <tr>\n            <vue-common-grid-th v-for=\"rule in rulesData.display_rules\" :rule=\"rule\" :row=\"gridHead\" @change=\"chgAll($event)\"></vue-common-grid-th>\n          </tr>\n        </thead>\n        <tbody>\n          <template v-for=\"row in showManageList\" v-if=\"checkDisplay(row)\">\n            <tr>\n              <vue-common-grid-td v-for=\"rule in rulesData.display_rules\" v-model=\"row[rule.id]\" :rule=\"rule\" :row=\"row\"></vue-common-grid-td>\n            </tr>\n            <template v-if=\"row.children && 0 < row.children.length && row.showChildren\">\n              <tr v-for=\"sub_row in row.children\">\n                <vue-common-grid-td v-for=\"rule in rulesData.display_rules\" :rule=\"rule\" :row=\"sub_row\"></vue-common-grid-td>\n              </tr>\n            </template>\n          </template>\n        </tbody>\n      </table>\n    </div>\n  `,\n  data: function(){\n    return {\n      title: '指令提交',\n      showUnfinished: true,\n      showFinished: true,\n      ajax_manage_list: [],\n      rulesData: instructionManageData,\n      showAborted: true,\n      showFinished: true,\n      loadingStatus: '',// loading\n      gridHead: {\n        web_checked: false\n      },\n      showManageList: [],\n    }\n  },\n  watch: {\n    ajax_manage_list: function(){\n      this.readyShowList();\n    },\n    showManageList: {\n      handler: function(){\n        if (this.showManageList.every(e => {\n          if (e.disabled) {\n            return true;\n          }else{\n            return true === e.web_checked;\n          }\n        }) && this.showManageList.length > 0) {\n          this.gridHead.web_checked = true;\n        }else{\n          this.gridHead.web_checked = false;\n        }\n      },\n      deep: true\n    }\n  },\n  beforeMount: function(){\n    this.loadManageList();\n  },\n  methods: {\n    checkDisplay: function(row){\n      if (this.showFinished && (-1 == row.status || 4 == row.status)) {\n        return true;\n      }\n\n      if (this.showUnfinished && (2 == row.status || 3 == row.status)) {\n        return true;\n      }\n\n      return false;\n    },\n    multiCancel: function(){\n      let arr = [];\n      this.showManageList.forEach(function(e){\n        if (e.web_checked && 4 != e.status && -1 != e.status) {\n          arr.push(e.ins_id);\n        }\n      });\n\n      $.ajax({\n        type: 'post',\n        url: window.REQUEST_PREFIX + '/sync/instruction/manage_cancel',\n        data: {\n          ins_id_arr: arr,\n        },\n        success: function({code, msg, data}){\n          if (0 == code) {\n            $.omsAlert('撤销成功')\n          }else{\n            $.omsAlert(msg)\n          }\n        },\n        error: function(err){\n          $.omsAlert('网络异常')\n        }\n      })\n    },\n    loadManageList: function(){\n      let _this = this;\n      this.loadingStatus = 'loading';\n      $.ajax({\n        url: window.REQUEST_PREFIX + '/sync/instruction/search_list',\n        data: {\n          count: 9999,\n          type: 'manage',\n          ins_status_arr: [-1, 2, 3, 4]\n        },\n        success: function(res){\n          _this.loadingStatus = '';\n          if (0 == res.code) {\n            _this.ajax_manage_list = res.data.list || [];\n          }else{\n            $.omsAlert(res.msg);\n          }\n        },\n        error: function(){\n          _this.loadingStatus = '';\n          $.omsAlert('网络异常');\n        }\n      })\n    },\n    chgAll: function(event){\n      this.$nextTick(() => {\n        this.showManageList.forEach(function(e){\n          if (!e.disabled) {\n            e.web_checked = event;\n          }\n        });\n        // let list = this.showManageList;\n        // let len = this.showManageList.length;\n        // for(let i = 0; i<len;i++){\n        //   if (!list[i].disabled) {\n        //     list[i].web_checked = event;\n        //   }\n        // }\n        this.showManageList.filter(function(e){\n\n        });\n      });\n    },\n    readyShowList: function(){\n      let tmpShowArr = [];\n      let tmpCheckedArr = [];\n      this.showManageList.forEach(e => {\n        if (e.showChildren) {\n          tmpShowArr.push(e.ins_id);\n        }\n\n        if (e.web_checked) {\n          tmpCheckedArr.push(e.ins_id);\n        }\n      })\n\n\n      let arr = [];\n      this.ajax_manage_list.forEach((e) => {\n        let obj = {};\n        obj.ins_id = e.instruction.id;\n        obj.web_checked = false;\n        if (tmpCheckedArr.some(el => el == obj.ins_id)) {\n          obj.web_checked = true;\n        }\n\n        // 股票代码\n        obj.stock_id = e.stock.stock_id;\n        // 股票名称\n        obj.stock_name = e.stock.stock_name;\n        // 产品名称\n        obj.product_name = e.gathering.product_name_list.join('，');\n\n        // 交易方向、买卖标志\n        obj.deal_direction_name = e.gathering.deal_direction_name;\n        // 指令价格\n        obj.price = e.gathering.price;\n        if (1 == e.instruction.quote_type) {\n          obj.price_str = this.numeralNumber(obj.price, 3);\n        }else{\n          obj.price_str = '市价';\n        }\n        // 指令数量\n        obj.ins_volume = e.gathering.ins_volume;\n        // 目标仓位\n        if (1 == e.instruction.add_ins_method) {\n          obj.target_position = e.gathering.target_position;\n        }else{\n          obj.target_position = '--';\n        }\n        // obj.target_position = e.gathering.target_position;\n\n        // 总资产比例\n        // if (2 == e.instruction.add_ins_method) {\n        //   obj.current_adjust_position = e.gathering.current_adjust_position;\n        // }else{\n        //   obj.current_adjust_position = '--';\n        // }\n        // obj.current_adjust_position = e.gathering.current_adjust_position;\n\n        // 总资产比例\n        if (2 == e.instruction.add_ins_method) {\n          obj.total_asset_ratio = e.gathering.total_asset_ratio;\n        }else{\n          obj.total_asset_ratio = '--';\n        }\n        // obj.total_asset_ratio = e.gathering.total_asset_ratio;\n        // 最新价\n        obj.latest_price = e.stock.latest_price;\n        // 当前持仓\n        obj.current_position = e.gathering.current_position;\n        // 当前持仓数量\n        obj.current_volume = e.gathering.current_volume;\n        // 当前持仓成本价\n        obj.current_cost_price = e.gathering.current_cost_price;\n        // 完成进度百分比\n        obj.progress = e.gathering.progress;\n        // 创建日期\n        obj.created_at = e.instruction.created_at;\n        // 创建人\n        obj.creator_name = e.instruction.creator_name;\n        // 基金经理\n        obj.fund_manager_name = e.instruction.fund_manager_name;\n        // 指令状态\n        obj.status_name = e.instruction.status_name;\n        obj.status = e.instruction.status; //(2提交成功，3正在执行，4执行完毕，-1终止执行)\n        if (4 == obj.status || -1 == obj.status) {\n          obj.disabled = true;\n        }else{\n          obj.disabled = false;\n        }\n        // 操作\n        obj.operation = '撤销';\n        obj.showChildren = false;\n        if (tmpShowArr.some(el => el == obj.ins_id)) {\n          obj.showChildren = true;\n        }\n\n        // 产品账户购买子列表 // 结构与gathering一致\n        if (e.sub_list.length > 1) {\n          obj.children = e.sub_list;\n          obj.children.forEach(function(e){\n            e.isChild = true;\n          })\n        }else{\n          obj.children = [];\n        }\n\n        arr.push(obj);\n      });\n\n      this.showManageList = arr;\n    }\n  }\n});\n\n// 产品账户表格\nVue.component('vue-product-list', {\n  props: ['ajax_product_list'],\n  template: `\n    <div class=\"instruction-manage\">\n      <div class=\"instruction-manage__header\" style=\"padding: 10px 30px 0;\">\n        <h2>{{title}}</h2>\n      </div>\n      <table class=\"instruction-manage__body newweb-common-grid\">\n        <thead>\n          <tr>\n            <vue-common-grid-th v-for=\"rule in rulesData.display_rules\" :rule=\"rule\" :row=\"gridHead\" @change=\"chgAll($event)\"></vue-common-grid-th>\n          </tr>\n        </thead>\n        <tbody>\n          <template v-for=\"row in showProductList\">\n            <tr>\n              <vue-common-grid-td v-for=\"rule in rulesData.display_rules\" v-model=\"row[rule.id]\" :rule=\"rule\" :row=\"row\"></vue-common-grid-td>\n            </tr>\n            <template v-if=\"row.children && 0 < row.children.length && row.showChildren\">\n              <tr v-for=\"sub_row in row.children\">\n                <vue-common-grid-td v-for=\"rule in rulesData.display_rules\" :rule=\"rule\" :row=\"sub_row\"></vue-common-grid-td>\n              </tr>\n            </template>\n          </template>\n        </tbody>\n      </table>\n    </div>\n  `,\n  data: function(){\n    return {\n      title: 3 == orginfo_theme ? '产品账户' : '交易单元',\n      rulesData: productListData,\n      showAborted: true,\n      showFinished: true,\n      gridHead: {\n        web_checked: false\n      },\n      // checkedAll: false,\n      // ajaxManageList: [],\n      showProductList: [],\n    }\n  },\n  watch: {\n    ajax_product_list: {\n      handler:function(){\n        this.readyShowList();\n      },\n      deep: true\n    },\n    showProductList: {\n      handler: function(){\n        // var tmp = new Map();\n        // this.showProductList.forEach(function(e){\n        //   if (true === e.web_checked) {\n        //     tmp.set(e.operator_uid, true);\n        //   }\n        // });\n\n        // if (1 == tmp.size || 0 == tmp.size) {\n          if (this.showProductList.every(e => true === e.web_checked)) {\n            this.gridHead.web_checked = true;\n          }else{\n            this.gridHead.web_checked = false;\n          }\n\n          let arr = this.showProductList.filter(function(e){\n            return true == e.web_checked;\n          });\n          tradeFlow.chgCheckedProduct(arr);\n\n        // }else{\n\n        //   $.omsAlert('请勾选同一名基金经理的产品账户！')\n        // }\n\n        // if (this.showProductList.every(e => true === e.web_checked)) {\n        //   this.gridHead.web_checked = true;\n        // }else{\n        //   this.gridHead.web_checked = false;\n        // }\n\n        // let arr = this.showProductList.filter(function(e){\n        //   return true == e.web_checked;\n        // });\n        // tradeFlow.chgCheckedProduct(arr);\n      },\n      deep: true\n    }\n  },\n  methods: {\n    chgAll: function(event){\n      this.$nextTick(() => {\n        // 借用map来记录是否勾选了同一名基金经理的产品账户\n        // var tmp = new Map();\n        // this.showProductList.forEach(function(e){\n        //   tmp.set(e.operator_uid, true);\n        // });\n        // if (1 == tmp.size || 0 == tmp.size) {\n          this.showProductList.forEach(function(e){\n            e.web_checked = event;\n          });\n          this.showProductList.filter(function(e){\n\n          });\n        // }else{\n        //   $.omsAlert('请勾选同一名基金经理的产品账户！')\n        // }\n      });\n    },\n    readyShowList: function(){\n      let arr = [];\n      this.ajax_product_list.forEach(e => {\n        let obj = {};\n        // obj.web_checked = e.web_checked || false;\n        obj.web_checked = this.showProductList.some(function(el){\n          if (el.product_id == e.product_id) {\n            return el.web_checked;\n          }\n          return false;\n        })\n\n        // 额外传递runtime\n        // obj.runtime = e.runtime || {};\n        obj.runtime = $.extend({}, e.runtime || {});\n        $.extend(obj.runtime, $.pullValue(window.runtime, e.product_id + '.data'));\n\n        // 3.11版本修改，机构版将net_assets赋值到total_assets,为了解决含义变化的问题\n        if (3 != orginfo_theme) {\n          e.runtime.total_assets = e.runtime.net_assets;\n        }\n        // if (obj.runtime.estimate) {\n        //   obj.runtime.net_value = obj.runtime.estimate.net_value;\n        //   obj.runtime.net_assets = obj.runtime.estimate.net_assets;\n        //   obj.runtime.position = obj.runtime.estimate.position;\n        //   obj.runtime.total_assets = obj.runtime.estimate.total_assets;\n        // }\n\n        // 证券名称\n        obj.name = e.name;\n        obj.product_id = e.product_id;\n        obj.operator_uid = e.operator_uid;\n        obj.operator_name = e.operator_name;\n        // 当日净值\n        obj.net_value = obj.runtime ? obj.runtime.net_value : '--';\n        // 仓位\n        obj.position = obj.runtime ? obj.runtime.position : '--';\n        // 总盈亏\n        obj.net_profite = obj.runtime ? obj.runtime.net_profite : '--';\n        // 总盈亏率\n        obj.profit_rate = obj.runtime ? obj.runtime.profit_rate : '--';\n        // 资产总值\n        obj.total_assets = obj.runtime ? obj.runtime.total_assets : '--';\n        // 持仓市值\n        obj.security = obj.runtime ? obj.runtime.security : '--';\n        // 资金余额\n        obj.balance_amount = obj.runtime ? obj.runtime.balance_amount : '--';\n        // 可用资金\n        obj.enable_cash = obj.runtime ? obj.runtime.enable_cash : '--';\n\n        arr.push(obj);\n      });\n      this.showProductList = arr;\n    }\n  }\n});\n\nlet instructionManagePage = new Vue({\n  el: '#instruction-manage',\n  data: {\n    // ajaxManageList: [],\n    ajaxProductList: [],\n  },\n  methods: {\n    doCancel: function(row, rule){\n      let _this = this;\n      let value = row[rule.id];\n      if (4 == value || -1 == value) {\n        return false;\n      }\n      $.ajax({\n        type: 'post',\n        url: window.REQUEST_PREFIX + '/sync/instruction/manage_cancel',\n        data: {\n          ins_id_arr: [row[rule.btnId]],\n        },\n        success: function({code, msg, data}){\n          if (0 == code) {\n            $.omsAlert('撤销成功');\n\n            _this.$refs['instruction-manage'].loadManageList();\n          }else{\n            $.omsAlert(msg)\n          }\n        },\n        error: function(err){\n          $.omsAlert('网络异常')\n        }\n      })\n    },\n    loadList: function(product_list){\n      // this.ajaxManageList = window.instructionList;\n      this.ajaxProductList = product_list;\n      // this.$refs['product-list'].readyShowList();\n      // this.readyShowList();\n\n\n    },\n  }\n});\n// instructionManagePage.loadList();\n\n// 页面底部交易部分，基于原来的逻辑实现\n// var board = $('#order_create_id').find('>.body>.right-board');\nVue.component('vue-trade-menu', {\n  props: [],\n  template: `\n  <div class=\"left-nav\">\n    <div class=\"trade-nav\" style=\"overflow: visible;\">\n      <div v-if=\"3 != org_info_theme && false\" class=\"trade-nav__market\" @click=\"chgCurMarket('marketA')\" v-bind:class=\"{'active': 'marketA' == curMarket}\">沪深交易A</div>\n      <div v-if=\"3 != org_info_theme && false\" class=\"trade-nav__market\" @click=\"chgCurMarket('marketH')\" v-bind:class=\"{'active': 'marketH' == curMarket}\" style=\"margin-right: 55px;\">沪港通交易H</div>\n\n      <span class=\"trade-nav__item single-buy\" v-bind:class=\"{'active': 'single-buy' == curActive}\" @click=\"chgActive('single-buy')\">提交买入指令</span>\n      <span class=\"trade-nav__item single-sell\" v-bind:class=\"{'active': 'single-sell' == curActive}\" @click=\"chgActive('single-sell')\">提交卖出指令</span>\n\n      <div style=\"flex: 1;\"></div>\n      <a class=\"trade-nav__toggle\" @click=\"chgShowBoard()\">\n        <i class=\"nav-bar-show-icon\" v-bind:class=\"{'icon-collapse': showBoard, 'icon-spread': !showBoard}\"></i>\n      </a>\n    </div>\n  </div>\n  `,\n  data: function(){\n    return {\n      org_info_theme: window.LOGIN_INFO.org_info.theme,\n      curMarket: 'marketA',\n      curActive: 'single-buy',\n      displayRevertNum: 0,\n      showBoard: true,\n      product_list: [],\n      checked_count: 0\n    }\n  },\n  watch: {\n    checked_count: function(){\n      if (1 == this.checked_count) {\n        $('.disabled-mask').hide();\n      }else{\n        $('.disabled-mask').show();\n      }\n    },\n  },\n  methods: {\n    chgShowBoard: function(){\n      this.showBoard = !this.showBoard;\n      this.$emit('menu', {\n        curActive: this.curActive,\n        curMarket: this.curMarket,\n        showBoard: this.showBoard\n      });\n    },\n    chgCurMarket: function(curMarket){\n      // 判断是否修改，如果被修改，清空股票及价格\n      if(curMarket !== this.curMarket){\n        $('#stock_code').val('').change();\n        $(\"#val_price\").val('');\n\n        $('[click-active=\".trade_number_method-by_volume\"]').click()\n        $('#val_volume').val('');\n        if ('marketA' == curMarket) {\n          $('.order_model_limit_price').click();\n          $(\"#val_volume\").attr('placeholder', '每手100股');\n          $(\"#vale_current_volum\").attr('placeholder', '每手100股');\n        }else if ('marketH' == curMarket) {\n          $(\"#val_volume\").attr('placeholder', '');\n          $(\"#vale_current_volum\").attr('placeholder', '');\n        }\n      }\n\n      this.curMarket = curMarket;\n      this.showBoard = true;\n\n      this.$emit('menu', {\n        curActive: this.curActive,\n        curMarket: this.curMarket,\n        showBoard: this.showBoard\n      });\n    },\n    chgActive: function(val){\n      if (1 != this.checked_count && ('multi-buy' == val || 'multi-sell' == val)) {\n        $.omsAlert('多策略暂时无法使用批量下单功能！',false,1000);\n        return;\n      }\n      this.curActive = val;\n      this.showBoard = true;\n\n      var index = 0;\n      if ('single-sell' == this.curActive) {\n        index = 1;\n      }\n      $.omsUpdateLocalJsonData('etc','order_create_nav_index', index);\n\n      this.$emit('menu', {\n        curActive: this.curActive,\n        curMarket: this.curMarket,\n        showBoard: this.showBoard\n      });\n\n      tradeFlow.chgCurActive(this.curActive);\n    }\n  }\n});\n\n// 交易表单组件\nVue.component('vue-trade-form', {\n  props: ['cur_active'],\n  template:`\n  <form class=\"vue-trade-form\">\n    <div class=\"vue-trade-form__line\" v-bind:class=\"'single-buy' == cur_active ? 'buy-color-cls' : 'sell-color-cls'\">\n      <label class=\"vue-trade-form__label\">股票代码</label>\n      <div class=\"vue-trade-form__content\">\n        <vue-stock-search assets_class=\"e,f\" :custom_cls=\"'trade-custom-tmp-class'\" :stock_input_id=\"stock_input_type_id\" :placeholder=\"'请输入股票代码'\" v-on:stock_id=\"chgStockId($event)\" v-on:stock_input=\"stock_input_type_id = $event\"></vue-stock-search>\n      </div>\n    </div>\n    <div class=\"vue-trade-form__line\" v-bind:class=\"'single-buy' == cur_active ? 'buy-color-cls' : 'sell-color-cls'\">\n      <label class=\"vue-trade-form__label\">报价方式</label>\n      <div class=\"vue-trade-form__content\">\n        <div class=\"vue-trade-form__content--radio\">\n          <label @click=\"chgTradeMode(1)\" class=\"vue-trade-form__content--radio-label\" v-bind:class=\"{'active': 1 == trade_model}\">\n            限价\n            <i class=\"right-icon\"></i>\n          </label>\n          <label style=\"width: 10px;\"></label>\n          <label @click=\"chgTradeMode(2)\" class=\"vue-trade-form__content--radio-label\" v-bind:class=\"{'active': 2 == trade_model}\">\n            市价\n            <i class=\"right-icon\"></i>\n          </label>\n        </div>\n      </div>\n    </div>\n    <div class=\"vue-trade-form__line\" v-bind:class=\"'single-buy' == cur_active ? 'buy-color-cls' : 'sell-color-cls'\">\n      <label class=\"vue-trade-form__label\">价格</label>\n      <div class=\"vue-trade-form__content\">\n        <input v-if=\"1 == trade_model\" v-model=\"trade_price\" @change=\"chgTradePrice()\" class=\"vue-trade-form__content--input\" placeholder=\"请输入指令价格\" />\n        <input v-if=\"2 == trade_model\" disabled=\"disabled\" :value=\"'市价'\" @change=\"chgTradePrice()\" class=\"vue-trade-form__content--input\" placeholder=\"请输入指令价格\" />\n      </div>\n    </div>\n    <div class=\"vue-trade-form__line\" v-bind:class=\"'single-buy' == cur_active ? 'buy-color-cls' : 'sell-color-cls'\">\n      <label class=\"vue-trade-form__label\">下单方式</label>\n      <div class=\"vue-trade-form__content\" style=\"display: flex;\">\n        <select class=\"vue-trade-form__content--select\" v-model=\"add_ins_method\" @change=\"chgInsMethod()\" :disabled=\"lockStatus\">\n          <option value=\"3\">按指令数量</option>\n          <option value=\"1\">按目标仓位</option>\n          <option value=\"2\">按总资产比例</option>\n        </select>\n        <a v-if=\"false\" class=\"icon-lock\" :class=\"[{'unlocked' : !lockStatus}, {'locked' : lockStatus}]\" style=\"margin-right: 15px;\" @click=\"chgLockStatus()\"><i></i></a>\n      </div>\n    </div>\n  </form>\n  `,\n  data: function(){\n    return {\n      stock_id: '',\n      stock_input_type_id: '',\n      lockStatus: false,\n      trade_model: 1,\n      trade_price: '',\n      add_ins_method: 3, // 1按目标仓位 2按总资产比例 3按指令数量\n    }\n  },\n  mounted: function(){\n    let _this = this;\n    // 接收从五档行情触发的事件\n    $(window).on('trade-5__priceClick', (event) => {\n      this.trade_price = event.price;\n      this.chgTradePrice();\n    });\n\n    $(window).on('trade-5__firstTime_price', event => {\n      if ('single-buy' == this.cur_active) {\n        this.trade_price = event.ask1_price;\n      }else if('single-sell' == this.cur_active){\n        this.trade_price = event.bid1_price;\n      }\n      this.chgTradePrice();\n    });\n\n    // 获取锁定 状态\n    common_storage.getItem('lock__ins_trade_number_method' + window.LOGIN_INFO.user_id, function(rtn){\n      if (0 == rtn.code) {\n        if ('true' == rtn.data) {\n          _this.lockStatus = true;\n          common_storage.getItem('lock__ins_trade_number_method__value' + window.LOGIN_INFO.user_id, function(rtn){\n            if (0 == rtn.code) {\n              _this.add_ins_method = rtn.data;\n            }\n          })\n\n          // $('.icon-lock').addClass('locked');\n          // $('.trade_number_method').attr('disabled', true);\n          // common_storage.getItem('lock__ins_trade_number_method__value' + window.LOGIN_INFO.user_id, function(rtn){\n          //   if (0 == rtn.code) {\n          //     $('.trade_number_method').val(rtn.data).change();\n          //   }\n          // })\n        }else{\n          _this.lockStatus = false;\n          // $('.icon-lock').addClass('unlocked');\n          // $('.trade_number_method').attr('disabled', false);\n        }\n      }else{\n        $('.icon-lock').addClass('unlocked');\n      }\n    });\n  },\n  methods: {\n    chgLockStatus: function(){\n      let dstValue = !this.lockStatus;\n      if (true == dstValue) {\n        common_storage.setItem('lock__ins_trade_number_method' + window.LOGIN_INFO.user_id, 'true');\n        common_storage.setItem('lock__ins_trade_number_method__value' + window.LOGIN_INFO.user_id, this.add_ins_method);\n      }else{\n        common_storage.setItem('lock__ins_trade_number_method' + window.LOGIN_INFO.user_id, 'false');\n        \n      }\n      this.lockStatus = dstValue;\n    },\n    chgStockId: function(event){\n      this.stock_id = event;\n      this.$emit('stock_id', this.stock_id);\n      tradeFlow.chgStockId(this.stock_id);\n    },\n    chgTradeMode: function(val){\n      this.trade_model = val;\n      tradeFlow.chgTradeMode(this.trade_model);\n    },\n    chgTradePrice: function(){\n      tradeFlow.chgTradePrice(this.trade_price);\n    },\n    chgInsMethod: function(){\n      tradeFlow.chgInsMethod(this.add_ins_method);\n    }\n  }\n});\n\nVue.component('vue-trade-5', {\n  mixins: [numberMixin, colorMixin],\n  props: ['stock_id', 'cur_active'],\n  template: `\n    <div class=\"vue-trade-5\">\n      <div class=\"vue-trade-5__high-low\">\n        <h1 class=\"loading-loading\" :class=\"{'trade-loading': true == is_loading}\" style=\"position:relative;\">\n          <span class=\"code\">{{ajaxStockDetail.stock_code}}</span><br/>\n          <span>{{ajaxStockDetail.stock_name}}</span>\n        </h1>\n        <div class=\"loading-loading vue-trade-5__main-info\">\n          <b @click=\"priceClick(ajaxStockDetail.last_price)\" style=\"cursor: pointer;\" class=\"vue-trade-5__main-info--last-price\" v-bind:class=\"rmgColor(ajaxStockDetail.last_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.last_price, 3)}}</b>\n          <span class=\"vue-trade-5__main-info--span\" v-bind:class=\"rmgColor(ajaxStockDetail.change, '0')\">{{numeralNumber(ajaxStockDetail.change, 3)}}</span>\n          <span class=\"vue-trade-5__main-info--span\" v-bind:class=\"rmgColor(ajaxStockDetail.change_ratio, '0')\">{{numeralPercent(ajaxStockDetail.change_ratio, 3)}}</span>\n        </div>\n        <div class=\"vue-trade-5__bd\">\n          <p>\n            今开：<span @click=\"priceClick(ajaxStockDetail.open_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.open_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.open_price, 3)}}</span><br/>\n            昨收：<span @click=\"priceClick(ajaxStockDetail.prev_close_price)\" style=\"cursor: pointer;\">{{numeralNumber(ajaxStockDetail.prev_close_price, 3)}}</span>\n          </p>\n          <p>\n            最高：<span @click=\"priceClick(ajaxStockDetail.high_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.high_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.high_price, 3)}}</span><br/>\n            最低：<span @click=\"priceClick(ajaxStockDetail.low_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.low_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.low_price, 3)}}</span>\n          </p>\n          <p>\n            涨停：<span @click=\"priceClick(ajaxStockDetail.stop_top)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.stop_top, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.stop_top, 3)}}</span><br/>\n            跌停：<span @click=\"priceClick(ajaxStockDetail.stop_down)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.stop_down, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.stop_down, 3)}}</span>\n          </p>\n        </div>\n      </div>\n      <div class=\"vue-trade-5__ask-bid\">\n        <div class=\"ask-bid__trade-tip\" v-bind:class=\"{'hide': !showTipFlag || 0 == Object.keys(ajaxStockDetail).length}\" v-bind:style=\"getStyle()\">\n          {{getTipStr()}}\n        </div>\n        <table style=\"width: 100%;\">\n          <tbody>\n            <tr @mouseover=\"showTip('forSell', 5)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-buy' == cur_active && index >= 5 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>卖5</td>\n              <td @click=\"priceClick(ajaxStockDetail.ask5_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.ask5_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.ask5_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.ask5_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forSell', 4)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-buy' == cur_active && index >= 4 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>卖4</td>\n              <td @click=\"priceClick(ajaxStockDetail.ask4_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.ask4_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.ask4_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.ask4_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forSell', 3)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-buy' == cur_active && index >= 3 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>卖3</td>\n              <td @click=\"priceClick(ajaxStockDetail.ask3_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.ask3_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.ask3_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.ask3_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forSell', 2)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-buy' == cur_active && index >= 2 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>卖2</td>\n              <td @click=\"priceClick(ajaxStockDetail.ask2_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.ask2_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.ask2_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.ask2_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forSell', 1)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-buy' == cur_active && index >= 1 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>卖1</td>\n              <td @click=\"priceClick(ajaxStockDetail.ask1_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.ask1_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.ask1_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.ask1_volume, 0)}}</td>\n            </tr>\n            <tr class=\"blank-tr\" style=\"height: 2px;line-height: 2px;\"><td>&nbsp;</td></tr>\n          </tbody>\n          <tbody><tr class=\"hr-tr\" style=\"height: 2px!important;line-height: 2px!important;border-top: 1px solid #f2f2f2;\"><td colspan=\"3\" class=\"hr\"></td></tr></tbody>\n          <tbody>\n            <tr @mouseover=\"showTip('forBuy', 1)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-sell' == cur_active && index >= 1 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>买1</td>\n              <td @click=\"priceClick(ajaxStockDetail.bid1_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.bid1_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.bid1_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.bid1_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forBuy', 2)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-sell' == cur_active && index >= 2 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>买2</td>\n              <td @click=\"priceClick(ajaxStockDetail.bid2_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.bid2_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.bid2_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.bid2_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forBuy', 3)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-sell' == cur_active && index >= 3 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>买3</td>\n              <td @click=\"priceClick(ajaxStockDetail.bid3_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.bid3_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.bid3_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.bid3_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forBuy', 4)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-sell' == cur_active && index >= 4 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>买4</td>\n              <td @click=\"priceClick(ajaxStockDetail.bid4_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.bid4_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.bid4_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.bid4_volume, 0)}}</td>\n            </tr>\n            <tr @mouseover=\"showTip('forBuy', 5)\" @mouseout=\"hideTip()\" v-bind:class=\"{'mouseover': 'single-sell' == cur_active && index >= 5 && showTipFlag && 0 != Object.keys(ajaxStockDetail).length}\">\n              <td>买5</td>\n              <td @click=\"priceClick(ajaxStockDetail.bid5_price)\" style=\"cursor: pointer;\" v-bind:class=\"rmgColor(ajaxStockDetail.bid5_price, ajaxStockDetail.prev_close_price)\">{{numeralNumber(ajaxStockDetail.bid5_price, 3)}}</td>\n              <td>{{numeralNumber(ajaxStockDetail.bid5_volume, 0)}}</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  `,\n  data: function(){\n    return {\n      ajaxStockDetail: {},\n      showTipFlag: false,\n      index: 1,\n      tag: '',\n      price: '0.00',\n      volume: 100,\n      ajaxTimes: 0,\n      loadInterval: '',\n      is_loading: false //添加查询状态\n    }\n  },\n  watch: {\n    stock_id: function(){\n      let _this = this;\n      this.ajaxTimes = 0;\n      this.loadData();\n      clearInterval(this.loadInterval);\n      this.loadInterval = setInterval(function(){\n        _this.loadData();\n      }, 5000)\n    }\n  },\n  methods: {\n    getTipStr: function(){\n      let index = this.index;\n      let indexCopy = index;\n      if ('single-buy' == this.cur_active) {\n        let price = Number(this.numeralNumber(this.ajaxStockDetail['ask'+ index +'_price'], 3));\n        let volume = 0;\n        while(indexCopy > 0){\n          volume += Number(this.ajaxStockDetail['ask'+ indexCopy +'_volume']);\n          indexCopy -= 1;\n        }\n        return `点击卖${index}则自动将价格设置为卖${index}价${price}，本次委买数量设为${volume}股(卖1-${index}的总挂单量）`;\n      }\n      if ('single-sell' == this.cur_active) {\n        let price = Number(this.numeralNumber(this.ajaxStockDetail['bid'+ index +'_price'], 3));\n        let volume = 0;\n        while(indexCopy > 0){\n          volume += Number(this.ajaxStockDetail['bid'+ indexCopy +'_volume']);\n          indexCopy -= 1;\n        }\n        return `点击买${index}则自动将价格设置为买${index}价${price}，本次委卖数量设为${volume}股(买1-${index}的总挂单量）`;\n      }\n    },\n    getStyle: function(){\n      if ('forSell' == this.tag) {\n        return 'top: ' + (80 - 10 * (this.index - 1)) + 'px;';\n      }else if('forBuy' == this.tag){\n        return 'top: ' + (100 + 10 * (this.index - 1)) + 'px;';\n      }\n      return '';\n    },\n    showTip: function(tag, index){\n      return false;//指令提交页面，不要扫单的功能\n      this.tag = tag;\n\n      if ('forSell' == this.tag && 'single-buy' == this.cur_active) {\n        this.index = index;\n        this.showTipFlag = true;\n      }else if('forBuy' == this.tag && 'single-sell' == this.cur_active){\n        this.index = index;\n        this.showTipFlag = true;\n      }else{\n        this.showTipFlag = false;\n      }\n\n    },\n    hideTip: function(){\n      this.showTipFlag = false;\n    },\n    priceClick: function(val){\n      // 触发事件，修改表单的价格\n      $(window).trigger({\n        type: 'trade-5__priceClick',\n        price: val\n      })\n    },\n    loadData: function(){\n      let _this = this;\n      if ('' == this.stock_id) {\n        _this.ajaxStockDetail = {};\n        return;\n      }\n      var tmpStockId = this.stock_id;\n      this.is_loading = true;\n      commonAjax( (window.REQUEST_PREFIX||'')+\"/oms/helper/stock_detail?stock_id=\"+ this.stock_id ).then(function({code, msg, data}){\n        if (0 == code) {\n          if (tmpStockId != _this.stock_id) {\n            return;\n          }\n          _this.ajaxTimes++;\n\n          _this.ajaxStockDetail = data[0];\n          tradeFlow.shgStockDetail(_this.ajaxStockDetail);\n\n          if (1 == _this.ajaxTimes) {\n            $(window).trigger({\n              type: 'trade-5__firstTime_price',\n              ask1_price: _this.ajaxStockDetail.ask1_price,\n              bid1_price: _this.ajaxStockDetail.bid1_price,\n            })\n          }\n        }else if(1 == code){\n          // 旧的逻辑，错误码为1，不提示。\n        }else{\n          $.omsAlert(msg);\n        }\n        _this.is_loading = false;\n      }).catch(function(err){\n        $.omsAlert(err);\n      });\n    }\n  }\n})\n\n// 菜单底部显示行情组件\nVue.component('vue-trade-foot', {\n  mixins: [numberMixin],\n  props: ['whole_width'],\n  template: `\n  <div class=\"foot\" :style=\"'width:' + whole_width + 'px;'\">\n    <span class=\"indexs\">\n      <span class=\"index\">\n        上证指数\n        <span v-bind:class=\"rgColor(code_000001, 'change')\">\n          <span>{{numeralNumber(code_000001.last_price, 2)}}</span>\n          <span>{{numeralNumber(code_000001.change, 2)}}</span>\n          <span>{{numeralPercent(code_000001.change_ratio)}}</span>\n        </span>\n      </span>\n      <span class=\"index\">\n        深证指数\n        <span v-bind:class=\"rgColor(code_399001, 'change')\">\n          <span>{{numeralNumber(code_399001.last_price, 2)}}</span>\n          <span>{{numeralNumber(code_399001.change, 2)}}</span>\n          <span>{{numeralPercent(code_399001.change_ratio)}}</span>\n        </span>\n      </span>\n      <span class=\"index\">\n        创业板指\n        <span v-bind:class=\"rgColor(code_399006, 'change')\">\n          <span>{{numeralNumber(code_399006.last_price, 2)}}</span>\n          <span>{{numeralNumber(code_399006.change, 2)}}</span>\n          <span>{{numeralPercent(code_399006.change_ratio)}}</span>\n        </span>\n      </span>\n    </span>\n    <span class=\"time\">{{time}}</span>\n  </div>\n  `,\n  data: function(){\n    return {\n      time: '',\n      code_000001: {},\n      code_399001: {},\n      code_399006: {}\n    }\n  },\n  methods: {\n    // row是行数据，name是比较的那个属性名，middle是比较的标尺数据，默认为0\n    rgColor: function(row, name, middle){\n      var num = row[name];\n      return num<(middle||0) ? 'green' : 'red';\n    },\n    loadData: function(){\n      let _this = this;\n      var indexs = [\n        '000001.SH', // 上证指数\n        '399001.SZ', // 深证指数\n        '399006.SZ'  // 创业板指\n      ];\n      var url = (window.REQUEST_PREFIX||'')+\"/oms/helper/stock_brief?stock_id=\"+indexs.join(',');\n      var loadStockIndexs = function(){\n        commonAjax(url).then(function({code, msg, data}){\n          if (0 == code) {\n            var res_data = data || [];\n            res_data.forEach && res_data.forEach(function(index_stock){\n                _this['code_' + index_stock.stock_code] = index_stock\n            });\n            _this.time = moment().format('YYYY/MM/DD HH:mm:ss');\n          }else{\n            $.omsAlert(msg);\n          }\n        }).catch(function(err){\n          $.omsAlert(err);\n        });\n      };\n\n      $(loadStockIndexs);\n      setInterval(function(){\n        _this.time = moment().format('YYYY/MM/DD HH:mm:ss');\n      });\n      setInterval(loadStockIndexs,6000);\n    }\n  }\n});\n\n// 菜单预览显示组件\nVue.component('vue-trade-preview', {\n  mixins: [numberMixin],\n  props: ['cur_active'],\n  template: `\n    <div v-if=\"showOrHide()\" class=\"vue-trade-preview\">\n      <div class=\"vue-trade-preview__content\">\n        <table class=\"oms-preview-table loading-loading nothing-nothing\" style=\"width: 100%;\">\n          <thead>\n            <tr class=\"hd\">\n              <th class=\"oms-preview-table__content--left oms-preview-table__max-width-130\">{{3 == orginfo_theme ? '产品名称' : '交易单元'}}</th>\n              <th class=\"oms-preview-table__content--right\">当前持仓</th>\n              <th v-show=\"1 == add_ins_method\" class=\"oms-preview-table__content--right\">目标持仓</th>\n              <th v-show=\"2 == add_ins_method\" class=\"oms-preview-table__content--right\">总资产比例</th>\n              <th v-show=\"3 == add_ins_method\" class=\"oms-preview-table__content--right\">指令数量</th>\n              <th v-show=\"1 == add_ins_method || 2 == add_ins_method\" class=\"oms-preview-table__content--right\">指令数量</th>\n            </tr>\n          </thead>\n          <tbody class=\"loading-hide\" style=\"line-height: 30px;\">\n            <tr v-for=\"row in display_arr\" style=\"border-bottom: 1px solid #E2E2E2;\" v-bind:class=\"[{'error-line': row.riskRtn && row.riskRtn.code != 0}]\">\n              <td class=\"oms-preview-table__content--left oms-preview-table__max-width-130\" v-text=\"row.name\"></td>\n              <td class=\"oms-preview-table__content--right\">\n                {{numeralPercent(row.the_stock_position)}}\n              </td>\n              <td v-show=\"1 == add_ins_method\" class=\"oms-preview-table__content--right\">\n                <div style=\"position:relative;padding-right: 5px;\">\n                  <input style=\"padding-left: 5px;\" placeholder=\"请输入比例\" v-model=\"row.dst_position\" @blur=\"chgRowDstPosition(row)\" @keydown=\"checkKeyDown($event, /^\\\\d{1,4}\\\\.?\\\\d{0,2}$/, row.dst_position)\" />\n                  <span style=\"position: absolute;right: 10px;color:#ccc;top: 2px;\">%</span>\n                </div>\n              </td>\n              <td v-show=\"2 == add_ins_method\" class=\"oms-preview-table__content--right\">\n                <div style=\"position:relative;padding-right: 5px;\">\n                  <input style=\"padding-left: 5px;\" placeholder=\"请输入比例\" v-model=\"row.chg_position\" @blur=\"chgRowChgPosition(row)\" @keydown=\"checkKeyDown($event, /^\\\\d{1,4}\\\\.?\\\\d{0,2}$/, row.chg_position)\" />\n                  <span style=\"position: absolute;right: 10px;color:#ccc;top: 2px;\">%</span>\n                </div>\n              </td>\n              <td v-show=\"3 == add_ins_method\" class=\"oms-preview-table__content--right\">\n                <div style=\"position:relative;padding-right: 5px;\">\n                  <input style=\"padding-left: 5px;\" placeholder=\"请输入数量\" v-model=\"row.chg_amount\" @blur=\"chgRowChgAmount(row)\" @keydown=\"checkKeyDown($event, /^\\\\d{1,8}$/, row.chg_amount)\" />\n                  <prompt-language v-if=\"row.riskRtn && 0 != row.riskRtn.code\" :language_val=\"row.riskRtn && row.riskRtn.msg\"></prompt-language>\n                </div>\n              </td>\n              <td v-show=\"1 == add_ins_method || 2 == add_ins_method\" class=\"oms-preview-table__content--right\">\n                <div style=\"position:relative;padding-right: 5px;\">\n                  <span>{{row.chg_amount || 0}}</span>\n                  <prompt-language v-if=\"row.riskRtn && 0 != row.riskRtn.code\" :language_val=\"row.riskRtn && row.riskRtn.msg\"></prompt-language>\n                </div>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class=\"vue-trade-preview__controller\">\n        <label v-show=\"1 == add_ins_method\">\n          批量设置\n          <div style=\"display: inline-block;position:relative;\">\n            <input placeholder=\"请输入比例\" v-model=\"multi_num\" @blur=\"chgMultiNum()\" @keydown=\"checkKeyDown($event, /^\\\\d{1,4}\\\\.?\\\\d{0,2}$/, multi_num)\">\n            <span style=\"position: absolute;right: 10px;color:#ccc;top: 2px;\">%</span>\n          </div>\n        </label>\n        <label v-show=\"2 == add_ins_method\">\n          批量设置\n          <div style=\"display: inline-block;position:relative;\">\n            <input placeholder=\"请输入比例\" v-model=\"multi_num\" @blur=\"chgMultiNum()\" @keydown=\"checkKeyDown($event, /^\\\\d{1,4}\\\\.?\\\\d{0,2}$/, multi_num)\">\n            <span style=\"position: absolute;right: 10px;color:#ccc;top: 2px;\">%</span>\n          </div>\n        </label>\n        <label v-show=\"3 == add_ins_method\">\n          批量设置\n          <div style=\"display: inline-block;position:relative;\">\n            <input placeholder=\"请输入数量\" v-model=\"multi_num\" @blur=\"chgMultiNum()\" @keydown=\"checkKeyDown($event, /^\\\\d{1,8}$/, multi_num)\">\n          </div>\n        </label>\n\n        <a v-on:click=\"multiProductsSubmit()\" class=\"bem-ui-btn\" v-bind:class=\"{'disabled': checkSubmitDisabled()}\">\n          <span>提交指令</span>\n        </a>\n      </div>\n    </div>\n  `,\n  data: function(){\n    return {\n      trading_unit: '100',\n      // 产品列表预算后通过事件传过来的数据。\n      detail_arr: [],\n      trade_number_method: '',\n      orginfo_theme: orginfo_theme,\n      buy_or_sell: '',\n      // visibility: true,\n      display_arr: [],\n\n      // 选中的产品信息\n      checkedProductList: [],\n      trade_direction: 1,  // 1买入 2卖出\n      // 股票id，示例：“601288.SH”\n      stock_id: '',\n      // 五档行情\n      stock_detail: {},\n      // form_data: {},\n      // 交易模式 市价: 2; 限价: 1\n      trade_mode: '',\n      // 交易价格\n      trade_price: '',\n      // // 交易方式，仅展示用\n      // trade_user_type: 1,\n      // 下单方式\n      add_ins_method: 3, //1按目标仓位 2按总资产比例 3按指令数量\n\n      // 批量交易数量\n      multi_num: '',\n\n      // 按同等目标仓位的输入值\n      allDstPosition: '',\n      // 按同等总资产比例的输入值\n      allChgPosition: '',\n    }\n  },\n  watch: {\n    cur_active: function(){\n      if ('single-buy' == this.cur_active) {\n        this.trade_direction = 1;\n      }else if('single-sell' == this.cur_active){\n        this.trade_direction = 2;\n      }\n\n      // 额外，清空该预览框的交易数量\n      this.resetAllNum()\n    },\n    add_ins_method: function(){\n      this.multi_num = '';\n      this.resetAllNum();\n    }\n  },\n  methods: {\n    checkKeyDown: function(e, reg, value){\n      // reg = /^\\d{1,4}\\.?\\d{0,2}$/;\n      if (undefined == value) {\n        value = '';\n      }\n      if (8 == e.keyCode) {\n        return;\n      }\n\n      if (/\\S/.test(e.key)) {\n        if (reg.test(value + e.key)) {\n          // value = value + e.key;\n          return true;\n        }\n        e.preventDefault();\n        return false;\n      }\n      e.preventDefault();\n      return false;\n    },\n    resetAllNum: function(){\n      this.multi_num = '';\n      this.display_arr.forEach((e) => {\n        e.chg_amount = '';\n        e.dst_position = '';\n        e.chg_position = '';\n      });\n      this.refreshDisplay();\n    },\n    checkSubmitDisabled: function(){\n      let flag = false;\n      let _this = this;\n      this.display_arr.forEach(e => {\n        if (undefined == e.chg_amount || '' == e.chg_amount || 0 == e.chg_amount) {\n          flag = true;\n        }\n        if (1 == _this.trade_mode && (undefined == _this.trade_price || '' == _this.trade_price || 0 == _this.trade_price)) {\n          flag = true;\n        }\n        if (!e.riskRtn) {\n          flag = true;\n        }else if (0 != e.riskRtn.code) {\n          flag = true;\n        }\n      });\n\n      return flag;\n    },\n    // 决定该组件是否显示\n    showOrHide: function(){\n      // 选中产品为空，则隐藏\n      if (0 == this.display_arr.length) {\n        return false;\n      }\n\n      // 股票id为空，则隐藏\n      if ('' == this.stock_id) {\n        return false;\n      }\n\n      // 限价的情况下，价格为空，则隐藏\n      if (1 == this.trade_mode) {\n        if ('' == this.trade_price) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n    multiProductsSubmit: function(){\n      if (this.checkSubmitDisabled()) {\n        return false;\n      }\n      var _this = this;\n      let htmlArr = [];\n      let typeStr1 = '';\n      let typeStr2 = '';\n      let ins_price = 0;\n      if (1 == this.trade_direction) {\n        typeStr1 = '<span style=\"color:#F44336;\">买入</span>';\n        ins_price = this.stock_detail.stop_top;\n      }else{\n        typeStr1 = '<span style=\"color:#2196F3\">卖出</span>';\n        ins_price = this.stock_detail.stop_down;\n      }\n      if (1 == this.trade_mode) {\n        // typeStr2 = '限价';\n        typeStr2 = this.trade_price;\n        ins_price = this.trade_price;\n      }else{\n        typeStr2 = '市价';\n      }\n\n      let totalAmount = 0;\n      let totalMoney = 0;\n      this.display_arr.forEach(function(e){\n        htmlArr.push('<tr style=\"border-bottom: 1px solid #E2E2E2;\"><td class=\"cell-left\">'+ e.name + '</td>'+\n          '<td class=\"cell-left\">'+ typeStr1 +'</td>'+\n          '<td class=\"cell-right\">'+ typeStr2 +'</td>'+\n          // '<td class=\"cell-right\" style=\"max-width:190px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"'+ priceStr +'\">'+ priceStr +'</td>'+\n          '<td class=\"cell-right\">'+ e.chg_amount +'</td>'+\n          '<td class=\"cell-right\">'+ Number((e.chg_amount * ins_price).toFixed(2)) +'</td></tr>');\n        totalAmount += Number(e.chg_amount);\n        totalMoney += e.chg_amount * ins_price;\n      });\n      totalMoney = Number(totalMoney.toFixed(2));\n\n      var html = htmlArr.join('');\n      var confirmHtml = '<table class=\"custom_confirm\"><tbody style=\"width:100%;display: inline-table;\"><tr><th class=\"cell-left\">'+ (3 == orginfo_theme ? '产品单元' : '交易单元') +'</th>'+\n        '<th class=\"cell-left\">买卖标志</th>'+\n        // '<th class=\"cell-left\">报价方式</th>'+\n        '<th class=\"cell-right\">指令价格</th>'+\n        '<th class=\"cell-right\">交易数量(股)</th>'+\n        '<th class=\"cell-right\">交易金额(元)</th></tr>'+html+'</tbody></table>'+\n        '<div class=\"custom_total\"><span style=\"color:#999999;font-size:13px;\">总计</span><span>'+totalAmount+'</span><span>'+totalMoney+'</span></div>';\n      if (0 == window.is_trade_day) {//0是休市时间，也就是非交易日或者是交易日的15点之后 1为非休市时间\n          confirmHtml += '<div style=\"color:#F44336;font-size: 14px;padding-bottom: 3px;\">*当前为休市时间，指令将提交至下一交易日</div>'\n      }\n      if (location.search.includes(\"permission=special\")) {\n          confirmHtml += '<label><input class=\"is_auto_order\" style=\"margin-right: 10px;\" type=\"checkbox\" />自动审核</label>'\n      }\n\n      $.confirm({\n        title: '指令确认 <span style=\"margin-left:10px;font-size: 14px;font-weight: normal;\">股票：'+ this.stock_id + ' ' + this.stock_detail.stock_name +'</span>',\n        content: confirmHtml,\n        keyboardEnabled: true,\n        closeIcon: true,\n        confirmButton: '确定',\n        cancelButton: false,\n        confirm: function(){\n          if($.isLoading()){return;}\n          $.startLoading('正在提交订单...');\n          // form_data.batch_no = $.randomNo(LOGIN_INFO.user_id,30);\n\n          // // // 数组打乱排序\n          // // checked_rows.sort(function(a, b){\n          // //     return Math.random() - 0.5;\n          // // });\n\n          let product_id_arr = [];\n          let sub_list = {};\n          _this.display_arr.forEach(function(e){\n            product_id_arr.push(e.product_id);\n            sub_list[e.product_id] = {};\n            sub_list[e.product_id]['target_position'] = e.dst_position / 100;\n            sub_list[e.product_id]['total_asset_ratio'] = e.chg_position / 100;\n            sub_list[e.product_id]['ins_volume'] = e.chg_amount;\n\n          });\n          $.post((window.REQUEST_PREFIX||'')+'/sync/instruction/manage_add',{\n            stock_id: _this.stock_id,\n            quote_type: _this.trade_mode,\n            quote_price: _this.trade_price,\n            direction: _this.trade_direction,\n            add_ins_method: _this.add_ins_method,\n            product_id: product_id_arr,\n            sub_list: sub_list,\n            ignore_tips:0,\n          }).done(function(res){\n              // if (0 == res.code) {\n              //   // $.omsAlert('提交成功');\n                checkResults(res, _this.display_arr,sub_list,product_id_arr)\n              // }else{\n              //   $.omsAlert(res.msg);\n              // }\n              $.clearLoading();\n          }).fail(function(){\n              tradeControllor.$refs['trade-preview'] && tradeControllor.$refs['trade-preview'].resetAllNum();\n              $.omsAlert('网络错误！');\n              $.clearLoading();\n          }).always(function(){\n               // checkResults(res, _this.display_arr,sub_list)\n               \n          });\n          function checkResults( result, display_arr ,sub_list,product_id_arr){\n\n                //新版二次确认框\n                //包括处理结果和继续购买按钮\n            // result  = {\n            //   \"code\": 0, //非0表示该接口有错误，错误内容见msg字段\n            //   \"msg\": \"\",\n            //   \"data\": {\n            //     \"101259\":{ //产品id\n            //     \"000001.SZ\": {\n            //       \"code\": 5022111,  //5022111 触发风控或者异常信息\n            //       \"msg\": \"\",  //若该字段不为空，则展示该信息，表示异常信息\n            //       \"data\": {\n            //         \"msg\":[\"已触发风控:全部股票禁止买入\"],//触发内容数组\n            //         \"limit_action\": 0  //0表示预警，1表示禁止\n            //          }\n            //       }\n            //     },\n            //     \"101232\":{ //产品id\n            //     \"000001.SZ\": {\n            //       \"code\": 5022111,  //5022111 触发风控或者异常信息\n            //       \"msg\": \"\",  //若该字段不为空，则展示该信息，表示异常信息\n            //       \"data\": {\n            //         \"msg\":[\"已触发风控:全部股票禁止买入\"],//触发内容数组\n            //         \"limit_action\": 0  //0表示预警，1表示禁止\n            //          }\n            //       }\n            //     },\n            //   }\n            // }\n            if(result.code == 5022111){\n              instructionManagePage.$refs['instruction-manage'].loadManageList();\n              instructionManagePage.$refs['product-position'].loadOrderList();\n              setTimeout(function(){\n                instructionManagePage.$refs['product-position'].loadOrderList();\n              },5000);\n\n              display_arr.forEach(function(row){\n                row.ins_volume  = sub_list[row.product_id].ins_volume;\n                if( !result.data[row.product_id]){\n                  row.btnType =  false;\n                  row.msg = [\"未触发风控\"];\n                  row.entrustStatus = \"pass\";\n                  row.style = {}\n\n                }else{\n                    let temp  = result.data[row.product_id][_this.stock_id];\n                    if(temp.code == 0){\n                        //没问题\n                        row.btnType =  false;\n                        row.msg = [\"未触发风控\"];\n                        row.entrustStatus = \"pass\";\n                        row.style = {\n                        }\n                    }else if(temp.code == 5022111){\n                        //提示性风控\n                        if(temp.msg==\"\"){\n                            if(temp.data.limit_action == 0){\n                                //alert\n                                row.btnType =  true;\n                                row.msg = temp.data.msg;\n                                row.entrustStatus = \"alert\";\n                                row.style = {\n                                color:\"#FAA11F\"\n                                }\n                            }else{\n                                //购买失败\n                                row.btnType = false;\n                                row.entrustStatus = \"fail\";\n                                row.style = {\n                                    color:\"red\"\n                                }\n                                if(temp.msg ==\"\"){\n                                    row.msg = temp.data.msg;\n                                }else{\n                                    row.msg = [temp.msg];\n                                }\n                            }\n                        }else{\n                            //购买失败\n                            row.btnType = false;\n                            row.entrustStatus = \"fail\";\n                            row.style = {\n                                color:\"red\"\n                            }\n                            if(temp.msg ==\"\"){\n                                row.msg = []\n                            }else{\n                                row.msg = [temp.msg];\n                            }\n                        }\n                    }else if(temp.code == 5022110){\n                        row.btnType =  false;\n                        row.msg = [temp.msg];\n                        row.entrustStatus = \"fail\";\n                        row.style = {\n                            color:\"red\"\n                        }\n                    } else{\n                        //禁止性风控\n                        row.btnType =  false;\n                        row.msg = temp.data.msg;\n                        row.entrustStatus = \"fail\";\n                        row.style = {\n                            color:\"red\"\n                        }\n                    }\n                }\n              })\n            }else if(result.code == 0){\n              $.omsAlert(\"指令提交成功\");\n              tradeControllor.$refs['trade-preview'] && tradeControllor.$refs['trade-preview'].resetAllNum();\n              instructionManagePage.$refs['instruction-manage'].loadManageList();\n              instructionManagePage.$refs['product-position'].loadOrderList();\n              setTimeout(function(){\n                instructionManagePage.$refs['product-position'].loadOrderList();\n              },5000);\n              return\n            }else{\n              $.omsAlert(result.msg);\n              return\n            }\n            let contentChild = Vue.extend({\n              data() {\n                let stock_name = $('.client-stockInput__unit').html();\n                let stock_code = $('.client-stockInput__input').val();\n                this.$nextTick(function(){\n                  tradeControllor.$refs['trade-preview'] && tradeControllor.$refs['trade-preview'].resetAllNum();\n                })\n                return {\n                  tableData: display_arr,\n                  orginfo_theme: orginfo_theme,\n                  stock_name: stock_name,\n                  entrust_price: _this.trade_price,\n                  stock_code:stock_code,\n                  status:false,\n                  status_text:'',\n                  trade_mode:_this.trade_mode,\n                  sub_list:sub_list,\n                  product_id_arr:product_id_arr,\n                  isLoading:false,\n                }\n              },\n              template: `\n                    <div style=\"position:relative;margin-top: 20px;\">\n                    <span style=\"position: absolute;top: -44px;font-size: 20px;\">{{status_text}}</span>\n                    <span style=\"position: absolute;top: -36px;left: 91px;font-size:12px;\">股票：{{stock_code}}&nbsp;&nbsp;{{stock_name}}&nbsp;&nbsp;价格：{{trade_mode==2?'市价' : entrust_price}}</span>\n                    <div class=\"vue-form-confirmation\">\n                        <table style=\"width: 600px;\">\n                            <thead>\n                                <tr style=\"border-bottom: 1px solid rgba(0,0,0,0.05);\">\n                                    <th class=\"vue-form-confirmation__text-align-left\" style=\"color:rgba(74,74,74,0.5);\">{{3 == orginfo_theme ? '产品账户' : '交易单元'}}</th>\n                                    <th class=\"vue-form-confirmation__text-align-left\" style=\"color:rgba(74,74,74,0.5);\">数量</th>\n                                    <th class=\"vue-form-confirmation__text-align-left\" style=\"color:rgba(74,74,74,0.5);\">备注</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr  v-for=\"row in tableData\" style=\"border-bottom: 1px solid rgba(0,0,0,0.05);\">\n                                    <td class=\"vue-form-confirmation__text-align-left\">{{row.name}}</td>\n                                    <td class=\"vue-form-confirmation__text-align-left\">{{row.ins_volume}}</td>\n                                    <td class=\"vue-form-confirmation__text-align-left vue-form-confirmation__span-center\" >\n                                        <div>\n                                            <span :style=row.style>\n                                                <template v-for=\"msg in row.msg\">\n                                                    {{msg}}</br>\n                                                </template>\n                                            </span>\n\n                                        </div>\n\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                        <div class=\"buttons\" v-if=status style=\"margin-top: 40px;\">\n                            <button type=\"button\" class=\"vue-confirm__btns--cancel\"  @click=btn_submit style=\"background-color:red\">确定</button>\n                            <button type=\"button\" class=\"vue-confirm__btns--submit\"  @click=btn_cancel>取消</button>\n\n                        </div>\n                      </div>\n                      </div>\n                    `,\n              methods: {\n                btn_submit() {\n                  if(this.isLoading){\n                    return\n                  }\n                  this.isLoading = true;\n                  let self = this;\n                  let product_id_arr = [];\n                  let sub_list = {};\n                  // this.tableData.forEach(function(e){\n                  //   product_id_arr.push(e.product_id);\n                  //   sub_list[e.product_id] = {};\n                  //   sub_list[e.product_id]['target_position'] = e.dst_position / 100;\n                  //   sub_list[e.product_id]['total_asset_ratio'] = e.chg_position / 100;\n                  //   sub_list[e.product_id]['ins_volume'] = e.chg_amount;\n\n                  // });\n                  $.post((window.REQUEST_PREFIX||'')+'/sync/instruction/manage_add',{\n                    stock_id: _this.stock_id,\n                    quote_type: _this.trade_mode,\n                    quote_price: _this.trade_price,\n                    direction: _this.trade_direction,\n                    add_ins_method: _this.add_ins_method,\n                    product_id: self.product_id_arr,\n                    sub_list: self.sub_list,\n                    ignore_tips:1,\n                  }).done(function(res){\n                      if (0 == res.code) {\n                        $.omsAlert('提交成功');\n                        //checkResults(res, self.tableData,sub_list)\n                        instructionManagePage.$refs['instruction-manage'].loadManageList();\n                        instructionManagePage.$refs['product-position'].loadOrderList();\n                        setTimeout(function(){\n                          instructionManagePage.$refs['product-position'].loadOrderList();\n                        },5000);\n                      }else{\n                        $.omsAlert(res.msg);\n                      }\n                      $.clearLoading();\n                  }).fail(function(){\n                      // product.add_hand_order_res = {code:110,msg:'网络错误！'};\n                      $.omsAlert('网络错误！');\n                      $.clearLoading();\n                  }).always(function(){\n\n                      //清除二次确认框\n                      setTimeout(function(){\n                        self.isLoading = false;\n                        self.$parent.close();\n                      },1000)\n                  });\n\n                },\n                btn_cancel(){\n                   this.$parent.close();\n                }\n              },\n              mounted() {\n                $.clearLoading();\n              },\n              mounted(){\n                for(let i = 0 ;i<this.tableData.length;i++){\n                  if(this.tableData[i].entrustStatus == \"fail\"){\n                    this.status = false;\n                    this.status_text = \"提交失败\"\n                    return\n                  }\n                }\n                this.status_text = \"提交确认\"\n                this.status = true;\n              }\n            });\n\n            Vue.prototype.$confirm({\n              title: '  ',\n              content: contentChild,\n              closeIcon: true,\n            });\n          }\n        }\n      });\n    },\n    chgMultiNum: function(){\n      if ('' == this.multi_num) {\n        return;\n      }\n      if (1 == this.add_ins_method) {\n        this.chgAllDstPosition(this.multi_num);\n      }\n      if (2 == this.add_ins_method) {\n        this.chgAllChgPosition(this.multi_num);\n      }\n      if (3 == this.add_ins_method) {\n        this.display_arr.forEach((e) => {\n          e.chg_amount = this.multi_num;\n        });\n        this.refreshDisplay();\n      }\n    },\n    chgAllDstPosition: function(position){\n      this.display_arr.forEach((e) => {\n        e.dst_position = position;\n        this.chgRowDstPosition(e);\n      });\n    },\n    chgAllChgPosition: function(position){\n      this.display_arr.forEach((e) => {\n        e.chg_position = position;\n        this.chgRowChgPosition(e);\n      });\n    },\n    // 强制刷新页面\n    refreshDisplay: function(){\n      let _this = this;\n      if ('' == this.stock_id || undefined == this.stock_id || undefined == _this.stock_detail || 0 == Object.keys(_this.stock_detail)) {\n        return false;\n      }\n      // 过风控\n      this.display_arr.forEach(function(e){\n        let total_amount = 0;\n        let market_value = 0;\n        let all_market_value = 0;\n\n        var stock_position_num = 0; //该产品已持仓该股票数量\n        var stock_entrust_num = 0; //该产品已委托该股票数量\n        var stock_total_share = _this.stock_detail.total_share_capital; //该股票总股票数量，即总股本\n        var stock_all_position_num = 0; //所有的持仓汇总该股票数量\n        var stock_all_entrust_num = 0; //所有的委托汇总该股票数量\n        var stock_entrust_buy_num = 0; //该产品已委托买入数量\n        var stock_entrust_sell_num = 0; //该产品已委托卖出数量\n        var stock_all_entrust_buy_num = 0; //所有的产品已委托买入数量\n        var stock_all_entrust_sell_num = 0; //所有的产品已委托卖出数量\n\n        window.risk_position[e.product_id].data.forEach(function(el){\n          if (el.stock_id == _this.stock_id) {\n            total_amount = el.total_amount;\n            market_value = el.market_value;\n          }\n          all_market_value += el.market_value - 0;//强制转数字\n        });\n\n        var enable_sell_volume = 0;\n        // window.position_realtime[e.product_id].data.forEach(function(el){\n        //   if (el.stock_id === _this.stock_id && el.product_id == e.product_id) {\n        //     enable_sell_volume = e.enable_sell_volume;\n        //   }\n        // });\n        window.position_realtime.forEach(function(el){\n          if ( el.stock_id === _this.stock_id && el.product_id == e.product_id) {\n            enable_sell_volume = el.enable_sell_volume;\n\n            stock_position_num += Number(e.total_amount); // 得到该产品已持仓该股票数量\n\n            // 联合风控需要遍历所有的组合\n            if (e.stock_id === _this.stock_id) {\n                stock_all_position_num += Number(e.total_amount);\n            }\n          }\n        });\n\n        window.entrust_info.forEach(function(el){\n          if (el.stock.code == _this.stock_id && el.product_id == e.product_id &&\n              (![4, 5, 7, 8, 9].some(function(ele){\n                  return el.status == ele;\n              }) || (el.status == 4 && !/1|2/.test( el.cancel_status )))\n          ) {\n              if (1 == el.entrust.type) {\n                  stock_entrust_num += el.entrust.amount - el.deal.amount; // 得到该产品已委托该股票数量\n                  stock_entrust_buy_num = el.entrust.amount - el.deal.amount; // 得到该产品已委托买入数量\n              }else if (2 == el.entrust.type){\n                  stock_entrust_sell_num = el.entrust.amount - el.deal.amount; // 得到该产品已委托卖出数量\n              }\n          }\n\n          // 联合风控需要遍历所有的组合\n          if (el.stock.code == _this.stock_id &&\n              (![4, 5, 7, 8, 9].some(function(ele){\n                  return el.status == ele;\n              }) || (el.status == 4 && !/1|2/.test( el.cancel_status )))\n          ) {\n              if (1 == el.entrust.type) {\n                  stock_all_entrust_num += el.entrust.amount - el.deal.amount; // 得到所有产品已委托该股票数量\n\n                  stock_all_entrust_buy_num += el.entrust.amount - el.deal.amount; // 所有的产品已委托买入数量\n              }else if(2 == el.entrust.type){\n                  stock_all_entrust_sell_num += el.entrust.amount - el.deal.amount; // 所有的产品已委托卖出数量\n              }\n          }\n        })\n\n        var obj = riskCheck.checkRules({\n          trading_unit: _this.stock_detail.trading_unit,\n          product_id: e.product_id,                           // 产品id， id\n          // 交易数据 form_data\n          trade_direction: _this.trade_direction,             // 交易方向，1买入 2卖出 trade_direction\n          trade_mode: _this.trade_mode,                       // 1限价／2市价  trade_mode\n          volume: e.chg_amount || 0,                               // 交易数量\n          price: +_this.trade_price||0,                       // 限价金额\n          surged_limit: _this.stock_detail.stop_top,          // 涨停价\n          decline_limit: _this.stock_detail.stop_down,        // 跌停价\n          stock_code: _this.stock_id,                         // 股票code，包含“.SZ”,比较的时候最好都进行小写转换\n          stock_name: _this.stock_detail.stock_name,          // 股票名称，用于判断st股票\n          // 产品的数据 product\n          total_assets: e.runtime.total_assets,               // 资产总值 runtime.total_assets\n          enable_cash: e.runtime.enable_cash,                 // 可用资金 runtime.enable_cash\n          security: all_market_value,                         // 持仓市值 runtime.security 改为 all_market_value\n          net_value: e.runtime.net_value,                     // 当日净值 runtime.net_value\n          // 持仓数据\n          market_value: market_value,                         // 本股票持仓市值 //window.position_realtime里面有\n          total_amount: total_amount,                         // 该股票当前持仓数\n          enable_sell_volume: enable_sell_volume,              // 该股票能卖的数量\n\n          // 举牌\n          stock_position_num: stock_position_num, //该产品已持仓该股票数量\n          stock_entrust_num: 0, //该产品已委托该股票数量\n          stock_total_share: stock_total_share, //该股票总股票数量，即总股本\n\n          // 联合风控：举牌\n          stock_all_position_num: stock_all_position_num, //所有的持仓汇总该股票数量\n          stock_all_entrust_num: stock_all_entrust_num, //所有的委托汇总该股票数量\n\n          // 对敲\n          stock_entrust_buy_num: stock_entrust_buy_num,//0, //该产品已委托买入数量\n          stock_entrust_sell_num: stock_entrust_sell_num,//0, //该产品已委托卖出数量\n\n          // 联合风控：对敲\n          stock_all_entrust_buy_num: stock_all_entrust_buy_num,//0, //所有的产品已委托买入数量\n          stock_all_entrust_sell_num: stock_all_entrust_sell_num,//0, //所有的产品已委托卖出数量\n        });\n        e.riskRtn = obj;\n      });\n\n      // 强制刷新\n      this.display_arr = this.display_arr.filter(function(e){\n        return true;\n      });\n    },\n    // 修改了本行的目标仓位\n    chgRowDstPosition: function(row){\n      if ('' == this.stock_id || '' == this.trade_price || 0 == this.trade_price) {\n        return;\n      }\n\n      if ('single-buy' == this.cur_active) {\n        // 指令数量 = （目标仓位 - 当前仓位）* 总资产／ 指令价格。再进行手数取整\n        var gap_position = Math.max(row.dst_position / 100 - row.the_stock_position, 0);\n        row.chg_amount = Math.floor(gap_position * row.total_assets / this.trade_price / this.stock_detail.trading_unit) * this.stock_detail.trading_unit;\n      }else{\n        // 指令数量 = （当前仓位 - 目标仓位）* 总资产／ 最新价格。再进行手数取整\n        var gap_position = Math.max(row.the_stock_position - row.dst_position / 100, 0);\n        // 卖出时。向上取整，然后与持仓数量比较取较小值\n        row.chg_amount = Math.ceil(gap_position * row.total_assets / this.stock_detail.last_price / this.stock_detail.trading_unit) * this.stock_detail.trading_unit;\n        row.chg_amount = Math.min(row.chg_amount, row.real_position_total_amount);\n      }\n\n      this.refreshDisplay();\n    },\n    chgRowChgPosition: function(row){\n      if ('' == this.stock_id || '' == this.trade_price || 0 == this.trade_price) {\n        return;\n      }\n\n      if ('single-buy' == this.cur_active) {\n        // 指令数量 = 总资产比例／ 指令价格。再进行手数取整\n        row.chg_amount = Math.floor(row.chg_position / 100 * row.total_assets / this.trade_price / this.stock_detail.trading_unit) * this.stock_detail.trading_unit;\n      }else{\n        // 指令数量 = 总资产比例／ 最新价格。再进行手数取整\n        row.chg_amount = Math.ceil(row.chg_position / 100 * row.total_assets / this.stock_detail.last_price / this.stock_detail.trading_unit) * this.stock_detail.trading_unit;\n        row.chg_amount = Math.min(row.chg_amount, row.real_position_total_amount);\n      }\n\n      this.refreshDisplay();\n    },\n    chgRowChgAmount: function(row){\n      if ('' == this.stock_id || '' == this.trade_price || 0 == this.trade_price) {\n        return;\n      }\n      if ('single-buy' == this.cur_active) {\n\n        // Begin: 需求更改，删除修改后修改目标仓位和总资产比例的操作。\n        // // 总资产比例 = 指令数量 * 指令价格 ／ 总资产\n        // row.chg_position = row.chg_amount * this.trade_price / row.total_assets;\n        // // 目标仓位 = 当前仓位 + 总资产比例\n        // row.dst_position = row.position + row.chg_position;\n        // row.chg_position = this.numeralNumber(row.chg_position * 100);\n        // row.dst_position = this.numeralNumber(row.dst_position * 100);\n        // End: 需求更改，删除修改后修改目标仓位和总资产比例的操作。\n      }else{\n\n      }\n\n      this.refreshDisplay();\n    },\n    display_title: function(){\n      if ('single-sell' == this.cur_active) {\n        return '卖出';\n      }else if('single-buy' == this.cur_active){\n        return '买入';\n      }\n    },\n    setSubmitData: function(obj){\n      var _this = this;\n      if ('' == obj.stock_id || '' == obj.trade_price || 0 == obj.trade_price) {\n        return;\n      }\n      if (this.stock_id != obj.stock_id) {\n        // 额外，清空该预览框的交易数量\n        this.multi_num = '';\n        this.chgMultiNum()\n      }\n      this.checkedProductList = obj.checkedProductList;\n      this.stock_id = obj.stock_id;\n      this.stock_detail = obj.stock_detail;\n      this.trade_mode = obj.trade_mode;\n      if (1 == obj.trade_mode) {\n        this.trade_price = obj.trade_price;\n      }else if(2 == obj.trade_mode){\n        if ('single-buy' == this.cur_active) {\n          this.trade_price = obj.stock_detail.stop_top;\n        }else if('single-sell' == this.cur_active){\n          this.trade_price = obj.stock_detail.stop_down;\n        }\n      }\n      // this.trade_price = obj.trade_price;\n      this.add_ins_method = obj.add_ins_method;\n\n      // 将多余的display_arr元素去除（即已经存在了display_arr但是obj中又没有的）\n      this.display_arr = this.display_arr.filter(function(e){\n        if (obj.checkedProductList.some(el => el.product_id == e.product_id)) {\n          return true;\n        }else{\n          return false;\n        }\n      });\n\n      // 针对已经记录的display_arr，采取修改内部元素的方式。\n      this.display_arr.forEach(function(e){\n        // 数量信息不修改，只修改股票、行情等\n        obj.checkedProductList.forEach(function(el){\n          if(e.product_id == el.product_id){\n            // 资产总值\n            e.total_assets = el.total_assets;\n            // 当前持仓\n            e.position = el.position;\n\n            // TODO\n          }\n        })\n\n\n      });\n\n      // 判断以前display_arr没有存的数据，push进去\n      obj.checkedProductList.forEach(function(e){\n        if (_this.display_arr.some(function(el){\n          return el.product_id == e.product_id;\n        })) {\n          ;\n        }else{\n          _this.display_arr.push(e);\n        }\n      });\n\n      this.display_arr.forEach((e) => {\n        let total_amount = 0;\n        let market_value = 0;\n        let all_market_value = 0;\n        window.risk_position[e.product_id].data.forEach((el) => {\n          if (el.stock_id == this.stock_id) {\n            total_amount = el.total_amount;\n            market_value = el.market_value;\n          }\n          all_market_value += el.market_value - 0;//强制转数字\n        });\n\n        let the_stock_position = 0;\n        window.position_realtime.forEach(el => {\n          if (this.stock_id == el.stock_id && el.product_id == e.product_id) {\n            the_stock_position = el.weight;\n            e.real_position_total_amount = el.total_amount;\n          }\n        })\n        e.the_stock_position = the_stock_position;\n\n        e.market_value = market_value;\n        e.total_amount = total_amount;\n\n      });\n\n      // 数据修改之后，重新计算数量，例如价格修改之后，按比例的话，数量是要跟着变化的\n      if (1 == this.add_ins_method) {\n        this.display_arr.forEach((e) => {\n          if ('' == e.dst_position) {\n            e.chg_amount = 0;\n          }else{\n            this.chgRowDstPosition(e);\n          }\n        });\n      }\n      if (2 == this.add_ins_method) {\n        this.display_arr.forEach((e) => {\n          if ('' == e.chg_position) {\n            e.chg_amount = 0;\n          }else{\n            this.chgRowChgPosition(e);\n          }\n        });\n      }\n\n      this.refreshDisplay();\n    }\n  }\n});\n\n\nvar tradeControllor = new Vue({\n  el: '#trade-controllor',\n  data: {\n    // 市场类型\n    curMarket: 'marketA',\n    // 页签类型\n    curActive: 'single-buy',   //'single-buy','single-sell','multi-buy','multi-sell','revert'\n    // 是否隐藏\n    showBoard: true,\n    leftWidth: 0,\n    wholeWidth: 0,\n    stock_id: '',\n  },\n  // watch: {\n  //   stock_id: {\n  //     handle: function(){\n  //       tradeFLow.chgStockId(this.stock_id);\n  //     },\n  //     deep: true\n  //   }\n  // },\n  methods: {\n    chgStockId: function(event){\n      this.stock_id = event;\n    },\n    chgMenu: function(event){\n      this.curMarket = event.curMarket;\n      this.curActive = event.curActive;\n      this.showBoard = event.showBoard;\n    },\n    setWidth: function(leftWidth, wholeWidth){\n      this.leftWidth = leftWidth;\n      this.wholeWidth = wholeWidth;\n    }\n  }\n});\n\nvar product_list;\nvar product_ids;\n$(window).on('multi_load',function(event){\n  product_list = event.product_list;\n  product_ids = event.product_ids;\n\n  var intervalMap = new Map();\n  // 获取风控规则\n  var loadRiskRulesInfo = new Promise(function(resolve, reject){\n    riskCheck.getRulesData(product_ids, function(){\n      resolve();\n    });\n    setInterval(function(){\n      riskCheck.getRulesData(product_ids, function(){\n        ;\n      });\n    }, 6000 + parseInt(Math.random() * 1000));\n  });\n  // 获取股票池\n  var loadStockPoolInfo = new Promise(function(resolve, reject){\n    riskCheck.getStockPoolData(function(){\n      resolve();\n    });\n    setInterval(function(){\n      riskCheck.getStockPoolData(function(){\n        ;\n      });\n    }, 6000 + parseInt(Math.random() * 1000));\n  });\n  // 获取费用规则\n  var loadFeeRulesInfo = new Promise(function(resolve, reject){\n    riskCheck.getFeeData(product_ids, function(){\n      resolve();\n    });\n    setInterval(function(){\n      riskCheck.getFeeData(product_ids, function(){\n        ;\n      });\n    }, 6000 + parseInt(Math.random() * 1000));\n  });\n  // 获取指令数据\n  var loadInsInfo = new Promise(function(resolve, reject){\n    resolve();\n    setInterval(function(){\n      if(!product_ids.length){return;}\n      instructionManagePage.$refs['instruction-manage'].loadManageList();\n    }, 6000 + parseInt(Math.random() * 1000));\n    // // riskCheck.getRulesData(product_ids, function(){\n    // //   resolve();\n    // // });\n    // $.ajax({\n    //   url: window.REQUEST_PREFIX + '/sync/instruction/search_list',\n    //   data: {\n    //     count: 9999,\n    //     type: 'manage',\n    //     ins_status_arr: [-1, 2, 3, 4]\n    //   },\n    //   success: function(res){\n    //     if (0 == res.code) {\n    //       window.instructionList = res.data.list || [];\n    //       resolve();\n    //     }else{\n    //       reject(res.msg);\n    //     }\n    //   },\n    //   error: function(){\n    //     reject('网络异常');\n    //   }\n    // })\n  });\n\n  // 获取运行时数据\n  var loadRuntimeFn = function(resolve){\n    var url = (window.REQUEST_PREFIX||'')+'/oms/api/get_multi_settlement_info';\n\n    if (true == intervalMap.get('loadRuntimeFn')) {\n      return;\n    }\n    intervalMap.set('loadRuntimeFn', true);\n\n    $.get(url,{\n      product_id: product_ids,\n      unuse_cache: 1,\n    }).done(function(res){\n      if(res.code==0){\n        window.runtime = res.data;\n        // //合并数据\n        // product_list.forEach(function(product){\n        //   product.runtime = product.runtime || {};\n        //   //采用合并老数据的方式，防止没有数据导致整行空白的问题\n        //   $.extend(product.runtime, $.pullValue(res,'data.'+product.id+'.data'));\n        // });\n\n        //合并数据\n        product_list.forEach(function(product){\n          product.runtime = product.runtime || {};\n          //采用合并老数据的方式，防止没有数据导致整行空白的问题\n          $.extend(product.runtime, $.pullValue(res,'data.'+product.id+'.data'));\n        });\n\n        // 数据为什么会不更新呢？因为product_list一直都是“multi_load”拿过来的那个对象，所以使用变异方法来使得vue得知此次变化。\n        // JSON.parse(JSON.stringify())\n        instructionManagePage.ajaxProductList = JSON.parse(JSON.stringify(product_list));\n        // instructionManagePage.ajaxProductList = product_list.filter(function(){\n        //   return true;\n        // });\n\n        intervalMap.set('loadRuntimeFn', false);\n\n        if ('[object Function]' == Object.prototype.toString.call(resolve)) {\n          resolve();\n        }\n      }else{\n        $.omsAlert(res.msg);\n      }\n    }).fail($.failNotice.bind(null,url,'网络异常')).always(function(){\n    });\n  };\n  var loadRuntimeInfo = new Promise(function(resolve, reject){\n    loadRuntimeFn(resolve);\n    setInterval(function(){\n      if(!product_ids.length){return;}\n      loadRuntimeFn();\n    }, 6000 + parseInt(Math.random() * 1000));\n  });\n\n  // 获取委托单数据\n  var loadEntrustFn = function(resolve){\n    var url = (window.REQUEST_PREFIX||'') + '/oms/order/get_entrust_list?permission_type=product&type=all';\n\n    if (true == intervalMap.get('loadEntrustFn')) {\n      return;\n    }\n    intervalMap.set('loadEntrustFn', true);\n\n    $.get(url,{\n      product_id: product_ids,\n      // unuse_cache: 1,\n    }).done(function(res){\n      if(res.code==0){\n        entrust_last_updated_timestamp = res.timestamp;\n        window.entrust_info = res.data.list || [];\n\n        intervalMap.set('loadEntrustFn', false);\n\n        if ('[object Function]' == Object.prototype.toString.call(resolve)) {\n          resolve();\n        }\n      }else{\n        // window.entrust_info = [];\n        $.omsAlert(res.msg);\n      }\n\n    }).fail($.failNotice.bind(null,url,'网络异常')).always(function(){\n    });\n  };\n  var loadEntrustInfo = new Promise(function(resolve, reject){\n    loadEntrustFn(resolve);\n    // 委托信息不走定时刷新的机制，而是使用last_updated机制\n    // setInterval(function(){\n    //   if(!product_ids.length){return;}\n    //   loadEntrustFn();\n    // }, 6000 + parseInt(Math.random() * 1000));\n  });\n\n  Promise.all([loadRiskRulesInfo, loadStockPoolInfo, loadFeeRulesInfo, loadInsInfo, loadRuntimeInfo, loadEntrustInfo]).then(function(){\n    // console.log('此时才获取了交易所需要的基本数据。');\n    // 此时获取了交易所需要的基本数据之后，根据product_list来绘制组件\n    instructionManagePage.loadList(product_list);\n  }).catch(function(err){\n    $.omsAlert(err);\n  })\n\n\n  tradeControllor.$refs['trade-foot'].loadData();\n\n  var last_order_create_nav_index = $.omsGetLocalJsonData('etc','order_create_nav_index',0);\n  if (1 == last_order_create_nav_index) {\n    tradeControllor.$refs['trade-menu'].chgActive('single-sell');\n  }else{\n    tradeControllor.$refs['trade-menu'].chgActive('single-buy');\n  }\n\n  (function(){\n    //根据交易时段显示／收缩底部菜单栏\n    var url = (window.REQUEST_PREFIX||'')+\"/oms/helper/is_trade_day\";\n    $.get(url).done(function(res){\n      if (0 == res.code) {\n        if (1 == res.data.is) {\n          window.is_trade_day = true;\n          tradeControllor.do_hide = false;\n        }else{\n          window.is_trade_day = false;\n          tradeControllor.do_hide = true;\n        }\n      }\n    });\n  })();\n\n  /** Begin: 委托／指令创建部分布局照抄以前的方式 代码来自于multi/product/main.blade.php */\n  var me = $(this);\n  $('html').css('background','#fff');\n  $(function(){\n    var section_height = 271;\n    var section = $('html').find('section.create-order').first();\n\n    if(/mobile/i.test(navigator.userAgent)){return section.find('>.head').hide();}\n\n    $('html').addClass('black-turnoff');//全局使用 黑色主题\n    $('section.create-order').first().addClass('fixed transition');\n\n    var container = me.closest('.main-container');\n    var side_nav = $('html').find('.side-nav').first();\n    var scroll_reable_transition;\n\n    strategy_scrollbar_full();\n\n    function strategy_scrollbar_full(){\n      var ghost_section = $('<div>').appendTo(container);\n      $(window).on('table:rendered order_create:nav:change side_nav_status:changed resize scroll',resize);\n\n      resize({type:null});\n      function resize(event){\n        if(event.type=='scroll'){\n          clearTimeout(scroll_reable_transition);\n          section.removeClass('transition');\n          scroll_reable_transition = setTimeout(function(){\n              event.type == 'scroll' && section.addClass('transition');\n          });\n        }\n\n        var side_nav_status = side_nav.is('.open') ? 'open' : 'close';\n        var left = side_nav_status=='close' ? 60 : (side_nav.width()||255);\n        var side_nav_width = side_nav_status=='close' ? 60 : (side_nav.width()||255);\n        // var left = 60;\n        left -= window.scrollX;\n        var tmpWidth = container.outerWidth();\n        section.css({\n          'left': left\n        });\n        ghost_section.height(section.height());\n\n        // 修改底部宽度\n        let leftWidth = Math.max($('.container-fluid').outerWidth() + window.scrollX - side_nav_width, 1080);\n        tradeControllor.setWidth(leftWidth, $('.main-container').outerWidth());\n      }\n    }\n  });\n  /** End: 委托／指令创建部分布局照抄以前的方式 */\n\n  // 持仓数据更新\n  instructionManagePage.$refs['product-position'].loadOrderList();\n  // 持仓数据定时刷新的机制\n  setInterval(function(){\n    instructionManagePage.$refs['product-position'].loadOrderList();\n  },5000);\n\n  // last_updated刷新机制\n\n  $(window).on('position_update_updated', function(event){\n    var flag = false;\n    instructionManagePage.$refs['product-position'] && instructionManagePage.$refs['product-position'].query_arr && instructionManagePage.$refs['product-position'].query_arr.forEach(function(e){\n      if (e.last_updated_timestamp < event.updated_timestamp) {\n        flag = true;\n      }\n    });\n\n    if( flag ){\n      instructionManagePage.$refs['product-position'].loadOrderList();\n    }\n  });\n\n  $(window).on('entrust_update_updated', function(event){\n    if (entrust_last_updated_timestamp < event.updated_timestamp) {\n      loadEntrustFn();\n    }\n  });\n})\n"]}