{"version":3,"sources":["product/user_setting.js"],"names":["JS_user_setting","prefix","selectize","managerArr","initProductHeader","productMenu","Vue","el","data","active","permission","FD","disabled","fee_mode","methods","goto","e","li","$","currentTarget","hasClass","location","href","attr","product_id","userSetting","editPermission","user_id","role_id","permissions","usersInfo","rolePermissions","displayPermissionsStr","v","rtn","Object","keys","forEach","hasPermission","some","getUserSetting","callBack","_this","ajax","url","success","code","msg","splice","lists","push","prototype","toString","call","omsAlert","error","failNotice","doEdit","user_info","ele","per","value","name","sort","a","b","length","console","log","doDelete","html","confirm","title","content","closeIcon","columnClass","confirmButton","startLoading","type","clearLoading","getRoleUsers","cancelButton","saveEdit","permissionsArr","find","each","val","permission_ids","join","cancelEdit","rolesArr","label","add_user_name","valueField","labelField","create","placeholder","searchField","onChange","changeUserName","render","item","escape","option","tmpArr","add_user_roles","clearOptions","addOption","setValue","delimiter","maxItems","plugins","max_user","user_num","role","info","nick_name","document","on","createUser","tmpManager","getValue","test","search"],"mappings":"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","file":"user_setting.js","sourcesContent":["/**\n * author: liuzeyafzy\n * 人员分配页面\n */\nfunction JS_user_setting(prefix){\n  let selectize = {};\n  let managerArr = [];\n\n  initProductHeader(prefix);\n\n  // FD.org_info\n  let productMenu = new Vue({\n    el: '#productMenu',\n    data: {\n      active: 'user_setting',\n      permission: FD.permission,\n      disabled: (FD.fee_mode == 1) ? 'fee_setting' : ''\n    },\n    methods: {\n      goto: function goto(e) {\n        var li = $(e.currentTarget);\n        if (!li.hasClass('active') && !li.hasClass('disabled')) {\n          location.href = prefix + '/product/' + li.attr('data-str') + '?product_id=' + FD.product_id;\n        }\n      }\n    }\n  });\n\n  let userSetting = new Vue({\n    el: '#user_setting',\n    data: {\n      editPermission: {\n        user_id: '',\n        role_id: '',\n        permissions: []\n      },\n      usersInfo: FD.usersInfo,\n      rolePermissions: FD.rolePermissions\n    },\n    methods: {\n      displayPermissionsStr: function(v){\n        let rtn = '';\n        Object.keys(v).forEach(function(e){\n          rtn += v[e] + '；';\n        });\n        return rtn;\n      },\n      hasPermission: function(permissions, v){\n        return Object.keys(permissions).some(function(e){\n          return v == e;\n        })\n      },\n      getUserSetting: function(callBack){\n        var _this = this;\n        $.ajax({\n          url: prefix + '/product/user_setting?format=json&product_id=' + FD.product_id,\n          success: function({code, msg, data}){\n            if (0 == code) {\n              _this.usersInfo.splice(0);\n              data.lists.forEach(function(e){\n                _this.usersInfo.push(e);\n              });\n\n              if (Object.prototype.toString.call(callBack) === '[object Function]') {\n                callBack(data);\n              }\n            }else{\n              $.omsAlert(msg);\n            }\n\n          },\n          error: function(){\n            $.failNotice();\n          }\n        })\n      },\n      doEdit: function(v){\n        var _this = this;\n        // 取出匹配到的用户id和角色枚举值\n        this.usersInfo.forEach(function(e){\n          if (e.user_info.user_id == v) {\n            _this.editPermission.user_id = e.user_info.user_id;\n            _this.editPermission.role_id = e.user_info.role_id;\n          }\n        });\n\n        // 根据枚举值填充权限颗粒\n        let permissions = [];\n        if (v == _this.editPermission.user_id) {\n          Object.keys(_this.rolePermissions).forEach(function (e) {\n            if ( _this.editPermission.role_id.some(function(v){ return v == e }) ) {\n              _this.rolePermissions[e].forEach(function(el){\n                Object.keys(el.permissions).forEach(function (ele) {\n                  // 需要去重，value值已经存在，则不需要添加\n                  if (!permissions.some(function(per){\n                    return per.value == ele;\n                  })) {\n                    permissions.push({\n                      name: el.permissions[ele],\n                      value: ele\n                    });\n                  }\n                });\n              });\n            }\n          });\n        }\n\n        permissions.sort(function(a, b){\n          return a.value - b.value;\n        });\n\n        if (permissions.length === 0) {\n          console.log('用户id为' + v + '的用户拥有错误的角色枚举值');\n        }\n\n        _this.editPermission.permissions = permissions;\n      },\n      doDelete: function(user_id){\n        var html = `<div style=\"text-align: center;height: 150px;line-height: 150px;\"><i class=\"warn-icon\"></i>删除后该用户不再有权限操作此账户，确定删除？</div>`;\n        $.confirm({\n          title: '删除确认',\n          content: html,\n          closeIcon: true,\n          columnClass: 'custom-window-width',\n          confirmButton: '确定',\n          confirm: function(){\n            $.startLoading('正在删除...');\n            $.ajax({\n              url: prefix + '/product/del_user',\n              type: 'post',\n              data: {\n                product_id: FD.product_id,\n                user_id: user_id\n              },\n              success: function({code, msg, data}){\n                $.clearLoading();\n                if (0 == code) {\n                  $.omsAlert('用户删除成功');\n\n                  // 删除成功后，要更新已添加人员信息\n                  userSetting.getUserSetting(function(){\n                    // 删除成功后，要更新底部的用户数据，以便被删除的用户显示在列表中\n                    getRoleUsers();\n                  });\n                }else{\n                  $.omsAlert('用户删除失败，请重试');\n                }\n              },\n              error: function(){\n                $.clearLoading();\n                $.failNotice('网络异常，用户删除失败，请重试')\n              }\n            })\n          },\n          cancelButton: false\n        });\n      },\n      saveEdit: function(user_id){\n        var _this = this;\n        var permissionsArr = [];\n        $('.editTd').find('input:checked').each(function(){\n          // console.log($(this).val())\n          permissionsArr.push($(this).val());\n        });\n        $.startLoading('正在修改...');\n        $.ajax({\n          url: prefix + '/user/set_product_permissions',\n          type: 'post',\n          data: {\n            product_id: FD.product_id,\n            user_id: user_id,\n            permission_ids: permissionsArr.join(',')\n          },\n          success: function({code, msg, data}){\n            $.clearLoading();\n            if (0 == code) {\n              $.omsAlert('权限修改成功')\n            }else{\n              $.omsAlert(msg);\n            }\n            _this.getUserSetting();\n            _this.cancelEdit();\n          },\n          error: function(){\n            $.clearLoading();\n            $.failNotice('权限修改失败，请重试')\n          }\n        })\n\n      },\n      cancelEdit: function(){\n        this.editPermission = {\n          user_id: '',\n          role_id: '',\n          permissions: []\n        };\n      }\n    }\n  });\n\n  var rolesArr = [{\n    label: '管理员',\n    value: 1\n  },{\n    label: '基金经理',\n    value: 11\n  },{\n    label: '交易员',\n    value: 12\n  },{\n    label: '风控员',\n    value: 13\n  }];\n  selectize.add_user_name = $('.add_user_name').selectize({\n    valueField: 'value',\n    labelField: 'label',\n    // delimiter: ',',\n    // maxItems: 1,\n    // plugins: ['remove_button'],\n    create: false,\n    placeholder: '输入用户名搜索',\n    searchField: 'label',\n    onChange: function(value){\n      changeUserName(value);\n\n    },\n    render: {\n      item: function(item, escape){\n        return '<div class=\"item\" data-role-id=\"'+ item.role_id +'\" data-value=\"'+ item.value +'\" title=\"'+ item.label +'\">' + escape(item.label) + '</div>';\n      },\n      option: function(item, escape){\n        var label = item.value;\n        return '<div class=\"option\" title=\"'+ item.label +'\">' + escape(item.label) + '</div>';\n      }\n    }\n  })[0].selectize;\n\n  function changeUserName(value){\n    var tmpArr = [];\n    managerArr.forEach(function(e){\n      if (e.value == value) {\n        e.role_id.forEach(function(el){\n          rolesArr.forEach(function(ele){\n            if (ele.value == el) {\n              tmpArr.push({\n                label: ele.label,\n                value: ele.value\n              })\n            }\n          })\n        });\n      }\n    })\n    selectize.add_user_roles.clearOptions();\n    selectize.add_user_roles.addOption(tmpArr);\n\n    if (tmpArr.length === 1) {\n      selectize.add_user_roles.setValue(tmpArr[0].value);\n    }\n  }\n\n  selectize.add_user_roles = $('.add_user_roles').selectize({\n    valueField: 'value',\n    labelField: 'label',\n    delimiter: ',',\n    maxItems: 10,\n    plugins: ['remove_button'],\n    create: false,\n    placeholder: '请选择用户角色',\n    searchField: 'label',\n    render: {\n      item: function(item, escape){\n        return '<div class=\"item\" data-value=\"'+ item.value +'\" title=\"'+ item.label +'\">' + escape(item.label) + '</div>';\n      },\n      option: function(item, escape){\n        var label = item.value;\n        return '<div class=\"option\" title=\"'+ item.label +'\">' + escape(item.label) +\n        '</div>';\n      }\n    }\n  })[0].selectize;\n\n  let max_user = 0;\n  let user_num = 0;\n  getRoleUsers();\n  function getRoleUsers(){\n    $.ajax({\n      type: 'get',\n      url: '/bms-pub/user/org_info',\n      success: function({code, msg, data}){\n        if (0 == code) {\n          max_user = data.max_user;\n          user_num = data.user_num;\n\n          $.ajax({\n            type: 'get',\n            url: '/bms-pub/user/all_users',\n            success: function({code, msg, data}){\n              if (0 == code) {\n                managerArr = [];\n                selectize.add_user_name.clearOptions();\n                data.forEach(function(e){\n                  if ( e.role_id.some(function(role){\n                    return role == 1;//管理员身份不显示\n                  }) ) {\n                    ;\n                  }else{\n                    if ( !userSetting.usersInfo.some(function(info){\n                      return info.user_info.user_id == e.user_id;\n                    })) {\n                      managerArr.push({\n                        label: e.nick_name,\n                        value: e.user_id,\n                        role_id: e.role_id\n                      });\n                    }\n                  }\n\n                });\n                selectize.add_user_name.addOption(managerArr);\n              }else{\n                $.omsAlert(msg);\n              }\n            },\n            error: function(){\n              $.failNotice();\n            }\n          });\n        }\n      },\n      error: function(){\n        $.failNotice();\n      }\n    });\n  }\n\n  $(document).on('click', '.doCreateUser', function(){\n    if (user_num >= max_user) {\n      $.confirm({\n        title: '已达上限',\n        content: '<div style=\"text-align: center;height: 150px;line-height: 150px;\"><i class=\"warn-icon\"></i>当前用户数已达上限'+ max_user +'，如需增加，请联系我们。</div>',\n        closeIcon: true,\n        confirmButton: false,\n        cancelButton: ' 确定 '\n      });\n    }else{\n      createUser(function(data){\n        var tmpManager = {\n          label: data.nick_name,\n          value: data.user_id,\n          role_id: data.role_id\n        };\n\n        managerArr.push(tmpManager);\n        selectize.add_user_name.addOption(tmpManager);\n        selectize.add_user_name.setValue(data.user_id);\n      });\n    }\n\n  });\n  $(document).on('click', '.doAddUser', function(){\n    let user_id = selectize.add_user_name.getValue();\n    let product_id = FD.product_id;\n    let role_id = selectize.add_user_roles.getValue();\n    if ('' == user_id) {\n      $.omsAlert('请选择用户');\n      return;\n    }\n    if (role_id.length == 0) {\n      $.omsAlert('请选择用户角色');\n      return;\n    }\n    $.startLoading('正在添加...');\n    $.ajax({\n      url: prefix + '/user/set_role_permissions',\n      type: 'post',\n      data: {\n        user_id: user_id,\n        product_id: product_id,\n        role_id: role_id.join(',')\n      },\n      success: function({code, msg, data}){\n        $.clearLoading();\n        if (code == 0) {\n          $.omsAlert('添加成功');\n          // 添加成功后，要更新已添加人员信息\n          userSetting.getUserSetting(function(){\n            // 添加成功后，要更新底部的用户数据，以便被删除的用户显示在列表中\n            getRoleUsers();\n          });\n\n          // 添加成功后，要清空添加人员时填充的数据\n          selectize.add_user_name.setValue('');\n          selectize.add_user_roles.setValue('');\n\n        }else{\n          $.omsAlert(msg);\n        }\n      },\n      error: function(){\n        $.clearLoading();\n      }\n    });\n  });\n  $(document).on('click', '.doCancel', function(){\n    location.href = prefix + '/product/base_lists';\n  });\n\n  if (/showTip=true/.test(location.search)) {\n    $.omsAlert(`新建策略成功！<br />您可以继续完成其它相关设置！`);\n  }\n\n}\n"]}